<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Basil Okola">
<meta name="dcterms.date" content="2026-01-12">
<meta name="description" content="A simulation approach to adaptive clinical trial designs">

<title>Adaptive Methods for Clinical Trials</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-223d728f8d4ae8f037e471e842545cb2.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="../../site_libs/tabwid-1.1.3/tabwid.css" rel="stylesheet">
<script src="../../site_libs/tabwid-1.1.3/tabwid.js"></script>


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Adaptive Methods for Clinical Trials">
<meta property="og:description" content="A simulation approach to adaptive clinical trial designs">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">Portfolio</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resources.html"> 
<span class="menu-text">resources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html"> 
<span class="menu-text">posts</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page-left">
      <h1 class="title">Adaptive Methods for Clinical Trials</h1>
                  <div>
        <div class="description">
          A simulation approach to adaptive clinical trial designs
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">biostatistics</div>
                <div class="quarto-category">adaptive designs</div>
                <div class="quarto-category">interim analysis</div>
                <div class="quarto-category">simulations</div>
              </div>
                  </div>
  </div>
    
  <div class="quarto-title-meta-author column-page-left">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author"><a href="https://bokola.github.io/">Basil Okola</a> </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              <a href="https://ucsb-meds.github.io/">
              Master of Statistics and Data Science @ Hasselt University
              </a>
            </p>
        </div>
    </div>

  <div class="quarto-title-meta column-page-left">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 12, 2026</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#adaptive-trials-a-study-reproducibility-simulation-approach-jayawardana2025practical" id="toc-adaptive-trials-a-study-reproducibility-simulation-approach-jayawardana2025practical" class="nav-link active" data-scroll-target="#adaptive-trials-a-study-reproducibility-simulation-approach-jayawardana2025practical">Adaptive trials: A study reproducibility simulation approach <span class="citation" data-cites="jayawardana2025practical">(Jayawardana et al. 2025)</span></a>
  <ul class="collapse">
  <li><a href="#randomisation" id="toc-randomisation" class="nav-link" data-scroll-target="#randomisation">Randomisation</a></li>
  <li><a href="#participant-accrual" id="toc-participant-accrual" class="nav-link" data-scroll-target="#participant-accrual">Participant accrual</a></li>
  <li><a href="#generate-participant-outcomes" id="toc-generate-participant-outcomes" class="nav-link" data-scroll-target="#generate-participant-outcomes">Generate participant outcomes</a></li>
  <li><a href="#identify-data-available-at-interim-analysis" id="toc-identify-data-available-at-interim-analysis" class="nav-link" data-scroll-target="#identify-data-available-at-interim-analysis">Identify data available at interim analysis</a></li>
  <li><a href="#analyze-trial-data" id="toc-analyze-trial-data" class="nav-link" data-scroll-target="#analyze-trial-data">Analyze trial data</a></li>
  <li><a href="#simulate-a-single-trial" id="toc-simulate-a-single-trial" class="nav-link" data-scroll-target="#simulate-a-single-trial">Simulate a single trial</a></li>
  <li><a href="#simulate-multiple-trials" id="toc-simulate-multiple-trials" class="nav-link" data-scroll-target="#simulate-multiple-trials">Simulate multiple trials</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block column-page-left" id="quarto-document-content">





<section id="adaptive-trials-a-study-reproducibility-simulation-approach-jayawardana2025practical" class="level1">
<h1>Adaptive trials: A study reproducibility simulation approach <span class="citation" data-cites="jayawardana2025practical">(<a href="#ref-jayawardana2025practical" role="doc-biblioref">Jayawardana et al. 2025</a>)</span></h1>
<p>Adaptive trials allow for modifications along the course of the trials. Common modifications include sample size adjustment, dropping an arm (if futile), or even adjusting allocation probabilities. Group sequential design is one of the most utilized forms of adaptive designs allowing for multiple planned interim analyses with pre-specified rules for early stopping. Here, we take a simulation approach to understand adaptive designs.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(flextable, dplyr, future.apply, progressr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="randomisation" class="level2">
<h2 class="anchored" data-anchor-id="randomisation">Randomisation</h2>
<p>For simplicity, we use 1:1 treatment allocation ratio using block randomisation of size 4. Uniform random numbers are used to to order treatment allocations thereby producing a sequential list of treatment allocations for consecutively recruited participants.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Randomize participants to treatment arms</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param n sample size</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param blocks randomisation blocks</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' @returns a dataframe</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>simRandomisation <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n=</span><span class="dv">584</span>, <span class="at">blocks =</span> <span class="dv">4</span>){</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># blocking sequnce</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  block <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span>n), <span class="at">each =</span> blocks, <span class="at">length.out =</span> n)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># treatment sequence</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  trt <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">length.out =</span> n)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># a random number on a unit interval</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="fu">as.numeric</span>(<span class="fu">Sys.Date</span>()))</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  random <span class="ot">&lt;-</span> <span class="fu">runif</span>(n)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(block, trt, random)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df[<span class="fu">order</span>(df<span class="sc">$</span>block, df<span class="sc">$</span>random),]</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>obs <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>n</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df[, <span class="fu">c</span>(<span class="st">"obs"</span>, <span class="st">"trt"</span>)]</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>If we wanted to adjust allocation ratios:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Randomize participants to treatment arms</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param n sample size</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param blocks randomisation blocks</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param ratio randomization ratio</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' @returns a dataframe</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>simRandomisation <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n =</span> <span class="dv">584</span>, <span class="at">blocks =</span> <span class="dv">4</span>, <span class="at">ratio =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>)) {</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1. Define the possible treatment groups (0, 1, 2...) based on ratio length</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  trts <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span>(<span class="fu">length</span>(ratio) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2. Create the sequence by sampling within each block</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We use 'replicate' to generate each block independently</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  num_blocks <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(n <span class="sc">/</span> blocks)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">replicate</span>(num_blocks, {</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sample</span>(trts, <span class="at">size =</span> blocks, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> ratio)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 3. Flatten the matrix into a vector and trim to length n</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  trt_vector <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(result)[<span class="dv">1</span><span class="sc">:</span>n]</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 4. Return as a clean data frame</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">data.frame</span>(<span class="at">obs =</span> <span class="dv">1</span><span class="sc">:</span>n, <span class="at">trt =</span> trt_vector))</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="participant-accrual" class="level2">
<h2 class="anchored" data-anchor-id="participant-accrual">Participant accrual</h2>
<p>We assume participant accrual is constant over time and would take 928 days.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Simulate participant accrual</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param n sample size</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param recruit_period accrual period in days</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' @returns a vector</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>simAccrual <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n =</span> <span class="dv">584</span>, <span class="at">recruit_period =</span> <span class="dv">928</span>){</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># simulate trial times that patient enters the trial</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># adding 0.5 to ensure recruitment times &gt; day 1 when rounded</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  accrual_time <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">runif</span>(n) <span class="sc">*</span> recruit_period <span class="sc">+</span> <span class="fl">0.5</span>)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  accrual_time <span class="ot">&lt;-</span> <span class="fu">sort</span>(accrual_time)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(accrual_time)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>If patient accrual was not constant over time, weâ€™d consider a beta distribution</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Simulate participant accrual</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param n sample size</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param recruit_period accrual period (days)</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param alpha alpha shape parameter</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param beta beta shape parameter</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">#' @returnsa vector</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>simAccrual <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n =</span> <span class="dv">584</span>, <span class="at">recruit_period =</span> <span class="dv">928</span>, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">beta =</span> <span class="dv">1</span>) {</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1. Generate random numbers using a Beta distribution</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rbeta(n, shape1, beta) returns values between 0 and 1</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># alpha= beta = 1 is equivalent to runif (constant accrual)</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># alpha= 2, beta = 1 creates a "late peak" (accelerating accrual)</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># alpha= 1, beta = 2 creates an "early peak" (decelerating accrual)</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># alpha= 2, beta = 2 creates a "bell curve" (peak in middle)</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  accrual_proportions <span class="ot">&lt;-</span> <span class="fu">rbeta</span>(n, alpha, beta)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2. Scale the 0-1 values to the actual recruit_period</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>  accrual_time <span class="ot">&lt;-</span> <span class="fu">round</span>(accrual_proportions <span class="sc">*</span> recruit_period <span class="sc">+</span> <span class="fl">0.5</span>)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 3. Sort to represent chronological entry</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>  accrual_time <span class="ot">&lt;-</span> <span class="fu">sort</span>(accrual_time)</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(accrual_time)</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="generate-participant-outcomes" class="level2">
<h2 class="anchored" data-anchor-id="generate-participant-outcomes">Generate participant outcomes</h2>
<p>Choice of probability distribution depends on the outcome variable. You could use the binomial distribution for a binary outcome, normal distribution for a continuous outcome, or Weibull/exponential for time-to-event outcome.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Simulate trial data with outcome variable</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param n sample size</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param recruit_period recruitment period (days)</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param p vactor of event probabilities</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' @returns a dataframe</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>simTrialData <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n =</span> <span class="dv">584</span>, <span class="at">recruit_period =</span> <span class="dv">928</span>, p){</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># simulate random allocations</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">simRandomisation</span>()</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># simulate accrual</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>accrual <span class="ot">&lt;-</span> <span class="fu">simAccrual</span>()</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># simulate events from binomial dist</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>event <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, p[data<span class="sc">$</span>trt<span class="sc">+</span><span class="dv">1</span>])</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(data)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="identify-data-available-at-interim-analysis" class="level2">
<h2 class="anchored" data-anchor-id="identify-data-available-at-interim-analysis">Identify data available at interim analysis</h2>
<p>We assume outcome to be available immediately after recruitment and the time of interim analysis to be when a pre-determined number of events to be 20. As the data is ordered by accrual time, we can calculate cumulative number of events <code>cum_events</code> with <code>cum_events=20</code> indicating the planned time of the interim analysis. Since we assume no time lag between recruitment and outcome assessment, the outcome at the interim (<code>event_iterim: 0,1</code>) would be the same as the outcome at final time point (<code>event</code>) for participants included in the interim analysis (i.e., for observations where <code>obs &lt;= interim_ind</code>)</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Identify interim data  </span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param data a dataframe</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param events_at_interim number of events at interim</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' @returns a dataframe</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>simInterimData <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">events_at_interim =</span> <span class="dv">20</span>){</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cumulative events</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>cum_events <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(data<span class="sc">$</span>event)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># when does interim occur</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>interim_ind <span class="ot">&lt;-</span> data<span class="sc">$</span>obs[<span class="fu">min</span>(<span class="fu">which</span>(data<span class="sc">$</span>cum_events <span class="sc">==</span> events_at_interim))]</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># events at interim</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>event_interim <span class="ot">&lt;-</span> <span class="fu">with</span>(data, <span class="fu">ifelse</span>(obs <span class="sc">&lt;=</span> interim_ind, event, <span class="cn">NA</span>))</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(data)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="analyze-trial-data" class="level2">
<h2 class="anchored" data-anchor-id="analyze-trial-data">Analyze trial data</h2>
<p>During interim analysis we seek to find out:</p>
<ul>
<li>if trial would have stopped before maximum recruitment</li>
<li>point estimates and their CIs for treatment effect</li>
<li>sample size at the point of stopping the trial</li>
<li>if the study would have found evidence of clinically relevant treatment effect or if it was a futile trial</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Analyze trial data</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param data trial dataframe</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param alpha_interim alpha spend at interim analysis</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param alpha_final alpha spend at final analysis</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' @returns a dataframe</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>analyseData <span class="ot">&lt;-</span> <span class="cf">function</span>(data, alpha_interim, alpha_final){</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  nevents0 <span class="ot">&lt;-</span> <span class="fu">sum</span>(data<span class="sc">$</span>event[data<span class="sc">$</span>trt <span class="sc">==</span> <span class="dv">0</span>])</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  nevents1 <span class="ot">&lt;-</span> <span class="fu">sum</span>(data<span class="sc">$</span>event[data<span class="sc">$</span>trt <span class="sc">==</span> <span class="dv">1</span>])</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  pevents0 <span class="ot">&lt;-</span> nevents0<span class="sc">/</span><span class="fu">sum</span>(data<span class="sc">$</span>trt <span class="sc">==</span><span class="dv">0</span>)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  pevents1 <span class="ot">&lt;-</span> nevents1<span class="sc">/</span><span class="fu">sum</span>(data<span class="sc">$</span>trt <span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># logistic reg at interim</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>event_interim <span class="ot">&lt;-</span> <span class="fu">factor</span>(data<span class="sc">$</span>event_interim)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  logit_interim <span class="ot">&lt;-</span> <span class="fu">glm</span>(event_interim <span class="sc">~</span> trt, <span class="at">data =</span> data, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  conf_int <span class="ot">&lt;-</span> <span class="fu">confint</span>(logit_interim)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># results at interim</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  interim_or <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">coef</span>(logit_interim)[<span class="st">"trt"</span>])</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  interim_lci <span class="ot">&lt;-</span> <span class="fu">exp</span>(conf_int[<span class="st">"trt"</span>, <span class="st">"2.5 %"</span>])</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  interim_uci <span class="ot">&lt;-</span> <span class="fu">exp</span>(conf_int[<span class="st">"trt"</span>, <span class="st">"97.5 %"</span>])</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  interim_p <span class="ot">&lt;-</span> <span class="fu">coef</span>(<span class="fu">summary</span>(logit_interim))[<span class="st">"trt"</span>, <span class="st">"Pr(&gt;|z|)"</span>]</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># stop for trial success at interim</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>  interim_stop <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(interim_p <span class="sc">&lt;</span> alpha_interim, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the proportion of events if the trial stopped at interim</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(interim_stop <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>    nevents0 <span class="ot">&lt;-</span> <span class="fu">sum</span>(data<span class="sc">$</span>event[data<span class="sc">$</span>trt <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(data<span class="sc">$</span>event_interim)])</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>    nevents1 <span class="ot">&lt;-</span> <span class="fu">sum</span>(data<span class="sc">$</span>event[data<span class="sc">$</span>trt <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(data<span class="sc">$</span>event_interim)])</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>    pevents0 <span class="ot">&lt;-</span> nevents0<span class="sc">/</span><span class="fu">sum</span>(data<span class="sc">$</span>trt <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(data<span class="sc">$</span>event_interim))</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>    pevents1 <span class="ot">&lt;-</span> nevents1<span class="sc">/</span><span class="fu">sum</span>(data<span class="sc">$</span>trt <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(data<span class="sc">$</span>event_interim))</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># final analysis</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>event <span class="ot">&lt;-</span> <span class="fu">factor</span>(data<span class="sc">$</span>event)</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>  logit <span class="ot">&lt;-</span> <span class="fu">glm</span>(event <span class="sc">~</span> trt, <span class="at">data =</span> data, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>  conf <span class="ot">&lt;-</span> <span class="fu">confint</span>(logit)</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># results at final analysis</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>  final_or <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">coef</span>(logit)[<span class="st">"trt"</span>])</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>  final_lci <span class="ot">&lt;-</span> <span class="fu">exp</span>(conf[<span class="st">"trt"</span>, <span class="st">"2.5 %"</span>])</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>  final_uci <span class="ot">&lt;-</span> <span class="fu">exp</span>(conf[<span class="st">"trt"</span>, <span class="st">"97.5 %"</span>])</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>  final_p <span class="ot">&lt;-</span> <span class="fu">coef</span>(<span class="fu">summary</span>(logit))[<span class="st">"trt"</span>, <span class="st">"Pr(&gt;|z|)"</span>]</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>  final_stop <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(final_p <span class="sc">&lt;</span> alpha_final, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>  <span class="co"># is the trial conclusive?</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>  stop <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(interim_stop <span class="sc">==</span> <span class="dv">1</span>, interim_stop, final_stop)</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sample size (used to determine average sample size)</span></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(interim_stop <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>    sample_size <span class="ot">&lt;-</span> <span class="fu">unique</span>(data<span class="sc">$</span>interim_ind)</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>    sample_size <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data)</span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>  <span class="co"># determine trial flip-flop probability</span></span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>  flipflop <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(interim_stop <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> final_stop <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>    nevents0, nevents1, pevents0, pevents1, sample_size,</span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">interim_time =</span> <span class="fu">unique</span>(data<span class="sc">$</span>interim_ind),</span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>    interim_or, interim_lci, interim_uci, interim_p, interim_stop,</span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>    final_or, final_lci, final_uci, final_p, final_stop, stop, flipflop</span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results)</span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Avoid in model.matrix.default(mt, mf, contrasts) : variable 1 has no levels errors</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Analyze trial data</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param data trial dataframe</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param alpha_interim alpha spend at interim analysis</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param alpha_final alpha spend at final analysis</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' @returns a dataframe</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>analyseData <span class="ot">&lt;-</span> <span class="cf">function</span>(data, alpha_interim, alpha_final){</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Helper to check if GLM can run (needs variation in both Y and X)</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  is_estimable <span class="ot">&lt;-</span> <span class="cf">function</span>(df, outcome_col) {</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(df) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="cn">FALSE</span>)</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    has_outcome_var <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(df[[outcome_col]])) <span class="sc">&gt;</span> <span class="dv">1</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    has_trt_var     <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(df<span class="sc">$</span>trt)) <span class="sc">&gt;</span> <span class="dv">1</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(has_outcome_var <span class="sc">&amp;&amp;</span> has_trt_var)</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- Initial Calculations (Total Trial potential) ---</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>  nevents0 <span class="ot">&lt;-</span> <span class="fu">sum</span>(data<span class="sc">$</span>event[data<span class="sc">$</span>trt <span class="sc">==</span> <span class="dv">0</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  nevents1 <span class="ot">&lt;-</span> <span class="fu">sum</span>(data<span class="sc">$</span>event[data<span class="sc">$</span>trt <span class="sc">==</span> <span class="dv">1</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>  pevents0 <span class="ot">&lt;-</span> nevents0 <span class="sc">/</span> <span class="fu">sum</span>(data<span class="sc">$</span>trt <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>  pevents1 <span class="ot">&lt;-</span> nevents1 <span class="sc">/</span> <span class="fu">sum</span>(data<span class="sc">$</span>trt <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- Interim Analysis ---</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter data to only those available at interim for the model</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>  interim_data <span class="ot">&lt;-</span> data[<span class="sc">!</span><span class="fu">is.na</span>(data<span class="sc">$</span>event_interim), ]</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>  interim_estimable <span class="ot">&lt;-</span> <span class="fu">is_estimable</span>(interim_data, <span class="st">"event_interim"</span>)</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(interim_estimable){</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>    logit_interim <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="fu">factor</span>(event_interim) <span class="sc">~</span> trt, <span class="at">data =</span> interim_data, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>    interim_p     <span class="ot">&lt;-</span> <span class="fu">coef</span>(<span class="fu">summary</span>(logit_interim))[<span class="st">"trt"</span>, <span class="st">"Pr(&gt;|z|)"</span>]</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>    conf_int      <span class="ot">&lt;-</span> <span class="fu">confint.default</span>(logit_interim) </span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>    interim_or    <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">coef</span>(logit_interim)[<span class="st">"trt"</span>])</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>    interim_lci   <span class="ot">&lt;-</span> <span class="fu">exp</span>(conf_int[<span class="st">"trt"</span>, <span class="dv">1</span>])</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>    interim_uci   <span class="ot">&lt;-</span> <span class="fu">exp</span>(conf_int[<span class="st">"trt"</span>, <span class="dv">2</span>])</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>    interim_p <span class="ot">&lt;-</span> interim_or <span class="ot">&lt;-</span> interim_lci <span class="ot">&lt;-</span> interim_uci <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Stop for trial success at interim</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>  interim_stop <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(interim_p) <span class="sc">&amp;&amp;</span> interim_p <span class="sc">&lt;</span> alpha_interim, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Update event stats if the trial stopped at interim</span></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(interim_stop <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>    nevents0 <span class="ot">&lt;-</span> <span class="fu">sum</span>(interim_data<span class="sc">$</span>event[interim_data<span class="sc">$</span>trt <span class="sc">==</span> <span class="dv">0</span>])</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>    nevents1 <span class="ot">&lt;-</span> <span class="fu">sum</span>(interim_data<span class="sc">$</span>event[interim_data<span class="sc">$</span>trt <span class="sc">==</span> <span class="dv">1</span>])</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>    pevents0 <span class="ot">&lt;-</span> nevents0 <span class="sc">/</span> <span class="fu">sum</span>(interim_data<span class="sc">$</span>trt <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>    pevents1 <span class="ot">&lt;-</span> nevents1 <span class="sc">/</span> <span class="fu">sum</span>(interim_data<span class="sc">$</span>trt <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>    sample_size <span class="ot">&lt;-</span> <span class="fu">nrow</span>(interim_data)</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>    sample_size <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data)</span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- Final Analysis ---</span></span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>  final_estimable <span class="ot">&lt;-</span> <span class="fu">is_estimable</span>(data, <span class="st">"event"</span>)</span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(final_estimable){</span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>    logit    <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="fu">factor</span>(event) <span class="sc">~</span> trt, <span class="at">data =</span> data, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>    final_p  <span class="ot">&lt;-</span> <span class="fu">coef</span>(<span class="fu">summary</span>(logit))[<span class="st">"trt"</span>, <span class="st">"Pr(&gt;|z|)"</span>]</span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>    conf     <span class="ot">&lt;-</span> <span class="fu">confint.default</span>(logit)</span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>    final_or  <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">coef</span>(logit)[<span class="st">"trt"</span>])</span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>    final_lci <span class="ot">&lt;-</span> <span class="fu">exp</span>(conf[<span class="st">"trt"</span>, <span class="dv">1</span>])</span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>    final_uci <span class="ot">&lt;-</span> <span class="fu">exp</span>(conf[<span class="st">"trt"</span>, <span class="dv">2</span>])</span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>    final_p <span class="ot">&lt;-</span> final_or <span class="ot">&lt;-</span> final_lci <span class="ot">&lt;-</span> final_uci <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>  final_stop <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(final_p) <span class="sc">&amp;&amp;</span> final_p <span class="sc">&lt;</span> alpha_final, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- Logic Summary ---</span></span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>  stop     <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(interim_stop <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, final_stop)</span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>  flipflop <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(interim_stop <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> final_stop <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Build the final data frame</span></span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a>    nevents0, </span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a>    nevents1, </span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a>    pevents0, </span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>    pevents1, </span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a>    sample_size,</span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>    <span class="at">interim_time =</span> <span class="fu">max</span>(data<span class="sc">$</span>interim_ind, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="co"># Assuming this is a time-point or ID</span></span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a>    interim_or, </span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a>    interim_lci, </span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a>    interim_uci, </span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a>    interim_p, </span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a>    interim_stop,</span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a>    final_or, </span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a>    final_lci, </span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a>    final_uci, </span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a>    final_p, </span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a>    final_stop, </span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a>    stop, </span>
<span id="cb9-99"><a href="#cb9-99" aria-hidden="true" tabindex="-1"></a>    flipflop</span>
<span id="cb9-100"><a href="#cb9-100" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-101"><a href="#cb9-101" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-102"><a href="#cb9-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results)</span>
<span id="cb9-103"><a href="#cb9-103" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="simulate-a-single-trial" class="level2">
<h2 class="anchored" data-anchor-id="simulate-a-single-trial">Simulate a single trial</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Run a single experiment</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param n sample size</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param recruit_period accrual period</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param p vector of treatment success probability</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param events_at_interim number of events at interim</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param alpha_interim interim alpha spend</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param alpha_final final alpha spend</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co">#' @returns a dataframe</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>runTrial <span class="ot">&lt;-</span> <span class="cf">function</span>(n, recruit_period, p, events_at_interim, alpha_interim, alpha_final){</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#1. simulate trial data</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">simTrialData</span>(n, recruit_period, p)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#2. create interim data</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">simInterimData</span>(df, events_at_interim)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#3. Analyze data</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">analyseData</span>(df, alpha_interim, alpha_final)</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">data =</span> df, <span class="at">results =</span> results))</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># inputs</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>inputs <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="fu">as.numeric</span>(<span class="fu">Sys.Date</span>()),</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># recruitment period = Days in 2.5 years   </span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#584/690 is the target/total possible = efficiency ratio</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">recruit_period =</span> <span class="fl">365.25</span> <span class="sc">*</span> <span class="dv">3</span> <span class="sc">*</span> <span class="dv">584</span><span class="sc">/</span> <span class="dv">690</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">584</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">events_at_interim =</span> <span class="dv">20</span>,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">p0 =</span> <span class="fl">0.10</span>,</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">p1 =</span> <span class="fl">0.04</span>,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># p = c(p0, p1)</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">alpha_final =</span> <span class="fl">0.045</span>,</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">alpha_interim =</span> <span class="fl">0.005</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">c</span>(inputs<span class="sc">$</span>p0, inputs<span class="sc">$</span>p1)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>dict <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">variable =</span> <span class="fu">c</span>(</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">'nevents0'</span>,<span class="st">'nevents1'</span>, <span class="st">'pevents0'</span>, <span class="st">'pevents1'</span>, <span class="st">'sample_size'</span>, <span class="st">'interim_time'</span>,</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"interim_or"</span>, <span class="st">"interim_lci"</span>, <span class="st">"interim_uci"</span>, <span class="st">"interim_p"</span>, <span class="st">"interim_stop"</span>,</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"final_or"</span>, <span class="st">"final_lci"</span>, <span class="st">"final_uci"</span>, <span class="st">"final_p"</span>, <span class="st">"final_stop"</span>, <span class="st">"stop"</span>,</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"flipflop"</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">c</span>(</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Number of events in control group"</span>,</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Number of events in experimental group"</span>,</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Proportion of events in control group"</span>,</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Proportion of events in experimental group"</span>,</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Sample size"</span>,</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Time (days) at interim"</span>,</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Odds ratio at interim"</span>,</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Lower CI for OR at interim"</span>,</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Upper CI for OR at interim"</span>,</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">"P-value of any difference in treatments at interim"</span>,</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Whether the trial would have stopped at interim"</span>,</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Odds ratio at final analysis"</span>,</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Lower CI for odds ratio"</span>,</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Upper CI for odds ratio"</span>,</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">"P-value for treatment difference at final analysis"</span>,</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Whether the trial is conclusive at final analysis"</span>,</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Whether the trial was conclusive (at final or interim)"</span>,</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">"The probability of trial flip-flopping"</span></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(inputs<span class="sc">$</span>seed)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>results_singleTrial <span class="ot">&lt;-</span> <span class="fu">runTrial</span>(</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  inputs<span class="sc">$</span>n, inputs<span class="sc">$</span>recruit_period, p, inputs<span class="sc">$</span>events_at_interim,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  inputs<span class="sc">$</span>alpha_interim, inputs<span class="sc">$</span>alpha_final</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> results_singleTrial<span class="sc">$</span>results<span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">3</span>)  <span class="sc">|&gt;</span> <span class="fu">t</span>() <span class="sc">|&gt;</span> <span class="fu">as.data.frame</span>() </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(results)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">"value"</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>results<span class="sc">$</span>variable <span class="ot">&lt;-</span> <span class="fu">rownames</span>(results)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(results) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">left_join</span>(results, dict)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(variable)`</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> results[, <span class="fu">c</span>(<span class="st">"variable"</span>, <span class="st">"label"</span>, <span class="st">"value"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>tab_singleT <span class="ot">&lt;-</span> <span class="fu">flextable</span>(results) <span class="sc">|&gt;</span> <span class="fu">theme_vanilla</span>() </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>tab_singleT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-singleT" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-singleT-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Results from a single simulated trial
</figcaption>
<div aria-describedby="tbl-singleT-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="tabwid"><style>.cl-ec37bde4{}.cl-ec1a9764{font-family:'DejaVu Sans';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-ec1a97a0{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-ec28ac46{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-ec28ac64{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-ec29119a{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ec2911b8{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ec2911cc{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ec2911d6{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ec2911ea{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ec2911f4{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ec2911fe{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ec2911ff{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-ec37bde4"><thead><tr style="overflow-wrap:break-word;"><th class="cl-ec29119a"><p class="cl-ec28ac46"><span class="cl-ec1a9764">variable</span></p></th><th class="cl-ec29119a"><p class="cl-ec28ac46"><span class="cl-ec1a9764">label</span></p></th><th class="cl-ec2911b8"><p class="cl-ec28ac64"><span class="cl-ec1a9764">value</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-ec2911cc"><p class="cl-ec28ac46"><span class="cl-ec1a97a0">nevents0</span></p></td><td class="cl-ec2911cc"><p class="cl-ec28ac46"><span class="cl-ec1a97a0">Number of events in control group</span></p></td><td class="cl-ec2911d6"><p class="cl-ec28ac64"><span class="cl-ec1a97a0">16.000</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ec2911ea"><p class="cl-ec28ac46"><span class="cl-ec1a97a0">nevents1</span></p></td><td class="cl-ec2911ea"><p class="cl-ec28ac46"><span class="cl-ec1a97a0">Number of events in experimental group</span></p></td><td class="cl-ec2911f4"><p class="cl-ec28ac64"><span class="cl-ec1a97a0">4.000</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ec2911ea"><p class="cl-ec28ac46"><span class="cl-ec1a97a0">pevents0</span></p></td><td class="cl-ec2911ea"><p class="cl-ec28ac46"><span class="cl-ec1a97a0">Proportion of events in control group</span></p></td><td class="cl-ec2911f4"><p class="cl-ec28ac64"><span class="cl-ec1a97a0">0.140</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ec2911ea"><p class="cl-ec28ac46"><span class="cl-ec1a97a0">pevents1</span></p></td><td class="cl-ec2911ea"><p class="cl-ec28ac46"><span class="cl-ec1a97a0">Proportion of events in experimental group</span></p></td><td class="cl-ec2911f4"><p class="cl-ec28ac64"><span class="cl-ec1a97a0">0.030</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ec2911ea"><p class="cl-ec28ac46"><span class="cl-ec1a97a0">sample_size</span></p></td><td class="cl-ec2911ea"><p class="cl-ec28ac46"><span class="cl-ec1a97a0">Sample size</span></p></td><td class="cl-ec2911f4"><p class="cl-ec28ac64"><span class="cl-ec1a97a0">249.000</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ec2911ea"><p class="cl-ec28ac46"><span class="cl-ec1a97a0">interim_time</span></p></td><td class="cl-ec2911ea"><p class="cl-ec28ac46"><span class="cl-ec1a97a0">Time (days) at interim</span></p></td><td class="cl-ec2911f4"><p class="cl-ec28ac64"><span class="cl-ec1a97a0">249.000</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ec2911ea"><p class="cl-ec28ac46"><span class="cl-ec1a97a0">interim_or</span></p></td><td class="cl-ec2911ea"><p class="cl-ec28ac46"><span class="cl-ec1a97a0">Odds ratio at interim</span></p></td><td class="cl-ec2911f4"><p class="cl-ec28ac64"><span class="cl-ec1a97a0">0.187</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ec2911ea"><p class="cl-ec28ac46"><span class="cl-ec1a97a0">interim_lci</span></p></td><td class="cl-ec2911ea"><p class="cl-ec28ac46"><span class="cl-ec1a97a0">Lower CI for OR at interim</span></p></td><td class="cl-ec2911f4"><p class="cl-ec28ac64"><span class="cl-ec1a97a0">0.061</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ec2911ea"><p class="cl-ec28ac46"><span class="cl-ec1a97a0">interim_uci</span></p></td><td class="cl-ec2911ea"><p class="cl-ec28ac46"><span class="cl-ec1a97a0">Upper CI for OR at interim</span></p></td><td class="cl-ec2911f4"><p class="cl-ec28ac64"><span class="cl-ec1a97a0">0.577</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ec2911ea"><p class="cl-ec28ac46"><span class="cl-ec1a97a0">interim_p</span></p></td><td class="cl-ec2911ea"><p class="cl-ec28ac46"><span class="cl-ec1a97a0">P-value of any difference in treatments at interim</span></p></td><td class="cl-ec2911f4"><p class="cl-ec28ac64"><span class="cl-ec1a97a0">0.004</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ec2911ea"><p class="cl-ec28ac46"><span class="cl-ec1a97a0">interim_stop</span></p></td><td class="cl-ec2911ea"><p class="cl-ec28ac46"><span class="cl-ec1a97a0">Whether the trial would have stopped at interim</span></p></td><td class="cl-ec2911f4"><p class="cl-ec28ac64"><span class="cl-ec1a97a0">1.000</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ec2911ea"><p class="cl-ec28ac46"><span class="cl-ec1a97a0">final_or</span></p></td><td class="cl-ec2911ea"><p class="cl-ec28ac46"><span class="cl-ec1a97a0">Odds ratio at final analysis</span></p></td><td class="cl-ec2911f4"><p class="cl-ec28ac64"><span class="cl-ec1a97a0">0.305</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ec2911ea"><p class="cl-ec28ac46"><span class="cl-ec1a97a0">final_lci</span></p></td><td class="cl-ec2911ea"><p class="cl-ec28ac46"><span class="cl-ec1a97a0">Lower CI for odds ratio</span></p></td><td class="cl-ec2911f4"><p class="cl-ec28ac64"><span class="cl-ec1a97a0">0.141</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ec2911ea"><p class="cl-ec28ac46"><span class="cl-ec1a97a0">final_uci</span></p></td><td class="cl-ec2911ea"><p class="cl-ec28ac46"><span class="cl-ec1a97a0">Upper CI for odds ratio</span></p></td><td class="cl-ec2911f4"><p class="cl-ec28ac64"><span class="cl-ec1a97a0">0.661</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ec2911ea"><p class="cl-ec28ac46"><span class="cl-ec1a97a0">final_p</span></p></td><td class="cl-ec2911ea"><p class="cl-ec28ac46"><span class="cl-ec1a97a0">P-value for treatment difference at final analysis</span></p></td><td class="cl-ec2911f4"><p class="cl-ec28ac64"><span class="cl-ec1a97a0">0.003</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ec2911ea"><p class="cl-ec28ac46"><span class="cl-ec1a97a0">final_stop</span></p></td><td class="cl-ec2911ea"><p class="cl-ec28ac46"><span class="cl-ec1a97a0">Whether the trial is conclusive at final analysis</span></p></td><td class="cl-ec2911f4"><p class="cl-ec28ac64"><span class="cl-ec1a97a0">1.000</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ec2911ea"><p class="cl-ec28ac46"><span class="cl-ec1a97a0">stop</span></p></td><td class="cl-ec2911ea"><p class="cl-ec28ac46"><span class="cl-ec1a97a0">Whether the trial was conclusive (at final or interim)</span></p></td><td class="cl-ec2911f4"><p class="cl-ec28ac64"><span class="cl-ec1a97a0">1.000</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-ec2911fe"><p class="cl-ec28ac46"><span class="cl-ec1a97a0">flipflop</span></p></td><td class="cl-ec2911fe"><p class="cl-ec28ac46"><span class="cl-ec1a97a0">The probability of trial flip-flopping</span></p></td><td class="cl-ec2911ff"><p class="cl-ec28ac64"><span class="cl-ec1a97a0">0.000</span></p></td></tr></tbody></table></div>
</div>
</div>
</figure>
</div>
</div>
</section>
<section id="simulate-multiple-trials" class="level2">
<h2 class="anchored" data-anchor-id="simulate-multiple-trials">Simulate multiple trials</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>runMultipleTrials <span class="ot">&lt;-</span> <span class="cf">function</span>(nsims, seed, n, recruit_period, p, </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>                              events_at_interim, alpha_interim, alpha_final){</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># random seed</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  seeds <span class="ot">&lt;-</span> seed <span class="sc">+</span> <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span> nsims)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># simulate</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  multiple_trials <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span>nsims, <span class="cf">function</span>(x){</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(seeds[x])</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;-</span> <span class="fu">runTrial</span>(n, recruit_period, p, events_at_interim, alpha_interim,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>                  alpha_final)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(y)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># summarise</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">lapply</span>(multiple_trials, <span class="cf">function</span>(x) <span class="fu">return</span>(x<span class="sc">$</span>results))</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  results_all <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, results)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># saveRDS(multiple_trials, file = "results_multTrials.rds")</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove any trials with non-estimable CIs and calculate summary</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">apply</span>(results_all, <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">any</span>(<span class="fu">is.na</span>(x))))</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    result_summary <span class="ot">&lt;-</span> <span class="fu">apply</span>(results_all[<span class="sc">-</span>x,], <span class="dv">2</span>, summary)</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    result_summary <span class="ot">&lt;-</span> <span class="fu">apply</span>(results_all, <span class="dv">2</span>, summary)</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">results_all =</span> results_all,</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">results_summary =</span> results_summary,</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">seeds =</span> seeds</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Parallelize computations using <code>future.apply}</code></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(future.apply)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(progressr)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>runMultipleTrials_Parallel <span class="ot">&lt;-</span> <span class="cf">function</span>(nsims, seed, n, recruit_period, p_param, </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>                                       events_at_interim, alpha_interim, alpha_final) {</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1. Setup Parallel Backend</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Using 'multisession' is the most stable across Windows/Mac/Linux</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plan</span>(multisession, <span class="at">workers =</span> parallelly<span class="sc">::</span><span class="fu">availableCores</span>() <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ensure cleanup of workers when function finishes or crashes</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">on.exit</span>(<span class="fu">plan</span>(sequential))</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  seeds <span class="ot">&lt;-</span> seed <span class="sc">+</span> <span class="fu">seq_len</span>(nsims)</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2. Access the progressor from the calling environment</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">progressor</span>(<span class="at">steps =</span> nsims)</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 3. Run Simulations</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>  multiple_trials <span class="ot">&lt;-</span> <span class="fu">future_lapply</span>(<span class="dv">1</span><span class="sc">:</span>nsims, <span class="cf">function</span>(i) {</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Increment progress bar</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">p</span>(<span class="at">message =</span> <span class="fu">sprintf</span>(<span class="st">"Simulating trial %g"</span>, i))</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(seeds[i])</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Run the individual trial</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note: I renamed your 'p' to 'p_param' to avoid conflict with progressor 'p'</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;-</span> <span class="fu">runTrial</span>(n, recruit_period, p_param, events_at_interim, alpha_interim, alpha_final)</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(y)</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">future.seed =</span> <span class="cn">TRUE</span>) </span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 4. Summarize Results</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">lapply</span>(multiple_trials, <span class="cf">function</span>(x) x<span class="sc">$</span>results)</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>  results_all <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, results)</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Clean up non-estimable rows (NAs from glm failures)</span></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>  results_clean <span class="ot">&lt;-</span> results_all[<span class="fu">complete.cases</span>(results_all), ]</span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>  result_summary <span class="ot">&lt;-</span> <span class="fu">apply</span>(results_clean, <span class="dv">2</span>, summary)</span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">results_all =</span> results_all,</span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">results_summary =</span> result_summary,</span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">seeds =</span> seeds</span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Print results</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>tab_mulT <span class="ot">&lt;-</span> results_mulT<span class="sc">$</span>results_summary <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">3</span>) <span class="sc">|&gt;</span> <span class="fu">t</span>() <span class="sc">|&gt;</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>tab_mulT<span class="sc">$</span>variable <span class="ot">&lt;-</span> <span class="fu">rownames</span>(tab_mulT)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(tab_mulT) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(tab_mulT) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Minimum"</span>, <span class="st">"Q1"</span>, <span class="st">"Median"</span>, <span class="st">"Mean"</span>, <span class="st">"Q3"</span>, <span class="st">"Maximum"</span>, <span class="st">"variable"</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>tab_mulT <span class="ot">&lt;-</span> <span class="fu">left_join</span>(tab_mulT, dict) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(variable)`</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>tab_mulT <span class="ot">&lt;-</span> tab_mulT <span class="sc">|&gt;</span> <span class="fu">select</span>(variable, label, <span class="fu">everything</span>())</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(tab_mulT) <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_to_sentence</span>(<span class="fu">names</span>(tab_mulT))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>t_mulT <span class="ot">&lt;-</span> <span class="fu">flextable</span>(tab_mulT) <span class="sc">|&gt;</span> <span class="fu">theme_vanilla</span>() </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>t_mulT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-mulT" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-mulT-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Results from a multiple simulated trial
</figcaption>
<div aria-describedby="tbl-mulT-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="tabwid"><style>.cl-089ff906{}.cl-088e9c92{font-family:'DejaVu Sans';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-088e9ca6{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-08950ee2{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-08950ef6{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-08955334{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-08955348{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-08955352{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-08955353{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-0895535c{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-08955366{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-08955367{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-08955370{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-089ff906"><thead><tr style="overflow-wrap:break-word;"><th class="cl-08955334"><p class="cl-08950ee2"><span class="cl-088e9c92">Variable</span></p></th><th class="cl-08955334"><p class="cl-08950ee2"><span class="cl-088e9c92">Label</span></p></th><th class="cl-08955348"><p class="cl-08950ef6"><span class="cl-088e9c92">Minimum</span></p></th><th class="cl-08955348"><p class="cl-08950ef6"><span class="cl-088e9c92">Q1</span></p></th><th class="cl-08955348"><p class="cl-08950ef6"><span class="cl-088e9c92">Median</span></p></th><th class="cl-08955348"><p class="cl-08950ef6"><span class="cl-088e9c92">Mean</span></p></th><th class="cl-08955348"><p class="cl-08950ef6"><span class="cl-088e9c92">Q3</span></p></th><th class="cl-08955348"><p class="cl-08950ef6"><span class="cl-088e9c92">Maximum</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-08955352"><p class="cl-08950ee2"><span class="cl-088e9ca6">nevents0</span></p></td><td class="cl-08955352"><p class="cl-08950ee2"><span class="cl-088e9ca6">Number of events in control group</span></p></td><td class="cl-08955353"><p class="cl-08950ef6"><span class="cl-088e9ca6">12.000</span></p></td><td class="cl-08955353"><p class="cl-08950ef6"><span class="cl-088e9ca6">24.000</span></p></td><td class="cl-08955353"><p class="cl-08950ef6"><span class="cl-088e9ca6">28.000</span></p></td><td class="cl-08955353"><p class="cl-08950ef6"><span class="cl-088e9ca6">27.582</span></p></td><td class="cl-08955353"><p class="cl-08950ef6"><span class="cl-088e9ca6">32.000</span></p></td><td class="cl-08955353"><p class="cl-08950ef6"><span class="cl-088e9ca6">47.000</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-0895535c"><p class="cl-08950ee2"><span class="cl-088e9ca6">nevents1</span></p></td><td class="cl-0895535c"><p class="cl-08950ee2"><span class="cl-088e9ca6">Number of events in experimental group</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">1.000</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">9.000</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">11.000</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">11.037</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">14.000</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">25.000</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-0895535c"><p class="cl-08950ee2"><span class="cl-088e9ca6">pevents0</span></p></td><td class="cl-0895535c"><p class="cl-08950ee2"><span class="cl-088e9ca6">Proportion of events in control group</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.043</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.088</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.099</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.101</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.112</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.254</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-0895535c"><p class="cl-08950ee2"><span class="cl-088e9ca6">pevents1</span></p></td><td class="cl-0895535c"><p class="cl-08950ee2"><span class="cl-088e9ca6">Proportion of events in experimental group</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.005</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.030</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.039</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.039</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.047</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.082</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-0895535c"><p class="cl-08950ee2"><span class="cl-088e9ca6">sample_size</span></p></td><td class="cl-0895535c"><p class="cl-08950ee2"><span class="cl-088e9ca6">Sample size</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">138.000</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">584.000</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">584.000</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">554.664</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">584.000</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">584.000</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-0895535c"><p class="cl-08950ee2"><span class="cl-088e9ca6">interim_time</span></p></td><td class="cl-0895535c"><p class="cl-08950ee2"><span class="cl-088e9ca6">Time (days) at interim</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">116.000</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">243.000</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">281.000</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">286.926</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">327.000</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">565.000</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-0895535c"><p class="cl-08950ee2"><span class="cl-088e9ca6">interim_or</span></p></td><td class="cl-0895535c"><p class="cl-08950ee2"><span class="cl-088e9ca6">Odds ratio at interim</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.000</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.252</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.368</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.408</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.518</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">1.626</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-0895535c"><p class="cl-08950ee2"><span class="cl-088e9ca6">interim_lci</span></p></td><td class="cl-0895535c"><p class="cl-08950ee2"><span class="cl-088e9ca6">Lower CI for OR at interim</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.000</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.083</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.135</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.152</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.201</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.650</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-0895535c"><p class="cl-08950ee2"><span class="cl-088e9ca6">interim_uci</span></p></td><td class="cl-0895535c"><p class="cl-08950ee2"><span class="cl-088e9ca6">Upper CI for OR at interim</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.302</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.760</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">1.009</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">Inf</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">1.340</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">Inf</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-0895535c"><p class="cl-08950ee2"><span class="cl-088e9ca6">interim_p</span></p></td><td class="cl-0895535c"><p class="cl-08950ee2"><span class="cl-088e9ca6">P-value of any difference in treatments at interim</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.000</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.014</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.052</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.141</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.175</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">1.000</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-0895535c"><p class="cl-08950ee2"><span class="cl-088e9ca6">interim_stop</span></p></td><td class="cl-0895535c"><p class="cl-08950ee2"><span class="cl-088e9ca6">Whether the trial would have stopped at interim</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.000</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.000</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.000</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.098</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.000</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">1.000</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-0895535c"><p class="cl-08950ee2"><span class="cl-088e9ca6">final_or</span></p></td><td class="cl-0895535c"><p class="cl-08950ee2"><span class="cl-088e9ca6">Odds ratio at final analysis</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.059</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.286</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.371</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.391</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.473</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">1.304</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-0895535c"><p class="cl-08950ee2"><span class="cl-088e9ca6">final_lci</span></p></td><td class="cl-0895535c"><p class="cl-08950ee2"><span class="cl-088e9ca6">Lower CI for odds ratio</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.014</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.135</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.184</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.194</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.240</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.651</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-0895535c"><p class="cl-08950ee2"><span class="cl-088e9ca6">final_uci</span></p></td><td class="cl-0895535c"><p class="cl-08950ee2"><span class="cl-088e9ca6">Upper CI for odds ratio</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.241</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.606</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.750</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.793</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.937</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">2.653</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-0895535c"><p class="cl-08950ee2"><span class="cl-088e9ca6">final_p</span></p></td><td class="cl-0895535c"><p class="cl-08950ee2"><span class="cl-088e9ca6">P-value for treatment difference at final analysis</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.000</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.001</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.006</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.042</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.032</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.994</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-0895535c"><p class="cl-08950ee2"><span class="cl-088e9ca6">final_stop</span></p></td><td class="cl-0895535c"><p class="cl-08950ee2"><span class="cl-088e9ca6">Whether the trial is conclusive at final analysis</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.000</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">1.000</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">1.000</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.804</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">1.000</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">1.000</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-0895535c"><p class="cl-08950ee2"><span class="cl-088e9ca6">stop</span></p></td><td class="cl-0895535c"><p class="cl-08950ee2"><span class="cl-088e9ca6">Whether the trial was conclusive (at final or interim)</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.000</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">1.000</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">1.000</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.805</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">1.000</span></p></td><td class="cl-08955366"><p class="cl-08950ef6"><span class="cl-088e9ca6">1.000</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-08955367"><p class="cl-08950ee2"><span class="cl-088e9ca6">flipflop</span></p></td><td class="cl-08955367"><p class="cl-08950ee2"><span class="cl-088e9ca6">The probability of trial flip-flopping</span></p></td><td class="cl-08955370"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.000</span></p></td><td class="cl-08955370"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.000</span></p></td><td class="cl-08955370"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.000</span></p></td><td class="cl-08955370"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.001</span></p></td><td class="cl-08955370"><p class="cl-08950ef6"><span class="cl-088e9ca6">0.000</span></p></td><td class="cl-08955370"><p class="cl-08950ef6"><span class="cl-088e9ca6">1.000</span></p></td></tr></tbody></table></div>
</div>
</div>
</figure>
</div>
</div>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-jayawardana2025practical" class="csl-entry" role="listitem">
Jayawardana, Kaushala S, Michael Dymock, Robert K Mahar, Julie A Marsh, and Katherine J Lee. 2025. <span>â€œA Practical Guide to Simulation for an Adaptive Trial Design with a Single Interim Analysis.â€</span> <em>Trials</em> 26 (1): 400.
</div>
</div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{okola2026,
  author = {Okola, Basil},
  title = {Adaptive {Methods} for {Clinical} {Trials}},
  date = {2026-01-12},
  url = {https://bokola.github.io/posts/2026-01-12-Adaptive-designs/},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-okola2026" class="csl-entry quarto-appendix-citeas" role="listitem">
Okola, Basil. 2026. <span>â€œAdaptive Methods for Clinical Trials.â€</span>
January 12, 2026. <a href="https://bokola.github.io/posts/2026-01-12-Adaptive-designs/">https://bokola.github.io/posts/2026-01-12-Adaptive-designs/</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "î§‹";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/bokola\.github\.io\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>