<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Basil Okola">
<meta name="dcterms.date" content="2026-01-21">

<title>Econometrics: R introduction</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-223d728f8d4ae8f037e471e842545cb2.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="../../site_libs/tabwid-1.1.3/tabwid.css" rel="stylesheet">
<script src="../../site_libs/tabwid-1.1.3/tabwid.js"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Econometrics: R introduction">
<meta property="og:description" content="">
<meta property="og:image" content="https://bokola.github.io/posts/2026-01-21-econometrics/index_files/figure-html/fig-ols-1.png">
<meta property="og:image:height" content="960">
<meta property="og:image:width" content="1344">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">Portfolio</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resources.html"> 
<span class="menu-text">resources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html"> 
<span class="menu-text">posts</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page-left">
      <h1 class="title">Econometrics: R introduction</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">econometrics</div>
                <div class="quarto-category">instrumental variables</div>
                <div class="quarto-category">quasi-experiments</div>
                <div class="quarto-category">RCTs</div>
                <div class="quarto-category">R</div>
              </div>
                  </div>
  </div>
    
  <div class="quarto-title-meta-author column-page-left">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author"><a href="https://bokola.github.io/">Basil Okola</a> </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              <a href="https://ucsb-meds.github.io/">
              Master of Statistics and Data Science @ Hasselt University
              </a>
            </p>
        </div>
    </div>

  <div class="quarto-title-meta column-page-left">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 21, 2026</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#multiple-regression" id="toc-multiple-regression" class="nav-link active" data-scroll-target="#multiple-regression">Multiple Regression</a>
  <ul class="collapse">
  <li><a href="#omitted-variables" id="toc-omitted-variables" class="nav-link" data-scroll-target="#omitted-variables">omitted variables</a></li>
  <li><a href="#misspecification-of-the-functional-form-of-a-regression-function" id="toc-misspecification-of-the-functional-form-of-a-regression-function" class="nav-link" data-scroll-target="#misspecification-of-the-functional-form-of-a-regression-function">Misspecification of the functional form of a regression function</a></li>
  <li><a href="#measurement-error-and-errors-in-variable-bias" id="toc-measurement-error-and-errors-in-variable-bias" class="nav-link" data-scroll-target="#measurement-error-and-errors-in-variable-bias">Measurement error and errors-in-variable bias</a></li>
  <li><a href="#missing-data-and-sample-selection" id="toc-missing-data-and-sample-selection" class="nav-link" data-scroll-target="#missing-data-and-sample-selection">Missing data and sample selection</a></li>
  <li><a href="#simultaneous-causality-bias" id="toc-simultaneous-causality-bias" class="nav-link" data-scroll-target="#simultaneous-causality-bias">Simultaneous causality bias</a></li>
  </ul></li>
  <li><a href="#instrumental-variable-regression" id="toc-instrumental-variable-regression" class="nav-link" data-scroll-target="#instrumental-variable-regression">Instrumental variable regression</a>
  <ul class="collapse">
  <li><a href="#simple-instrumental-variable-regression" id="toc-simple-instrumental-variable-regression" class="nav-link" data-scroll-target="#simple-instrumental-variable-regression">Simple instrumental variable regression</a>
  <ul class="collapse">
  <li><a href="#example-demand-for-cigarettes" id="toc-example-demand-for-cigarettes" class="nav-link" data-scroll-target="#example-demand-for-cigarettes">Example: Demand for cigarettes</a></li>
  </ul></li>
  <li><a href="#the-general-iv-regression-model" id="toc-the-general-iv-regression-model" class="nav-link" data-scroll-target="#the-general-iv-regression-model">The general IV regression model</a>
  <ul class="collapse">
  <li><a href="#example-demands-for-cigarettes" id="toc-example-demands-for-cigarettes" class="nav-link" data-scroll-target="#example-demands-for-cigarettes">Example: Demands for cigarettes</a></li>
  </ul></li>
  <li><a href="#checking-instrument-validity" id="toc-checking-instrument-validity" class="nav-link" data-scroll-target="#checking-instrument-validity">Checking instrument validity</a>
  <ul class="collapse">
  <li><a href="#example-demand-for-cigarettes-1" id="toc-example-demand-for-cigarettes-1" class="nav-link" data-scroll-target="#example-demand-for-cigarettes-1">Example: Demand for cigarettes</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#experiments-and-quasi-experiments" id="toc-experiments-and-quasi-experiments" class="nav-link" data-scroll-target="#experiments-and-quasi-experiments">Experiments and Quasi-experiments</a>
  <ul class="collapse">
  <li><a href="#potential-outcomes-causal-effects-and-idealized-experiments" id="toc-potential-outcomes-causal-effects-and-idealized-experiments" class="nav-link" data-scroll-target="#potential-outcomes-causal-effects-and-idealized-experiments">Potential outcomes, causal effects and idealized experiments</a></li>
  <li><a href="#quasi-experiments" id="toc-quasi-experiments" class="nav-link" data-scroll-target="#quasi-experiments">Quasi experiments</a>
  <ul class="collapse">
  <li><a href="#the-difference-in-difference-did-estimator" id="toc-the-difference-in-difference-did-estimator" class="nav-link" data-scroll-target="#the-difference-in-difference-did-estimator">The difference-in-difference (DID) estimator</a></li>
  <li><a href="#regression-discontinuity-estimators" id="toc-regression-discontinuity-estimators" class="nav-link" data-scroll-target="#regression-discontinuity-estimators">Regression discontinuity estimators</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block column-page-left" id="quarto-document-content">





<section id="multiple-regression" class="level1">
<h1>Multiple Regression</h1>
<p>A number of assumptions underlying ordinary least square (OLS) regression come into close scrutiny under multiple linear regressions. Key assumptions include <strong>linearity, independence of residuals, homoscedasticity, normality of residuals</strong>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  AER, tidyverse, mvtnorm, flextable, modelsummary, sandwich, stargazer,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  MASS, rddtools, scales, broom, prettyunits</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"CASchools"</span>, <span class="at">package =</span> <span class="st">"AER"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' Render model coefficients as a flextable</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param x model object</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">#' @returns</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>render_summary <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">%&gt;%</span> broom<span class="sc">::</span><span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">p.value =</span> prettyunits<span class="sc">::</span><span class="fu">pretty_p_value</span>(p.value)) <span class="sc">%&gt;%</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span> <span class="fu">round</span>(., <span class="dv">3</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    flextable<span class="sc">::</span><span class="fu">flextable</span>()</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co">#' Render a list of models as flextable</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param models list object of models</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param robust_se list object of robust standard errors</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co">#' @returns</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>model_tables <span class="ot">&lt;-</span> <span class="cf">function</span>(models, robust_se) {</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">modelsummary</span>(</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    models,</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">vcov =</span> robust_se,</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Applies your robust SEs</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">output =</span> <span class="st">"flextable"</span>,</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Outputs as a flextable object</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">fmt =</span> <span class="dv">3</span>,</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 3 decimal places</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">stars =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Significance stars (optional)</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># gof_map = gm1 # Clean up GOF statistics</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">coef_omit =</span> <span class="st">"^</span><span class="sc">\\</span><span class="st">(Intercept</span><span class="sc">\\</span><span class="st">)$"</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    ,</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">gof_omit =</span> <span class="cn">NULL</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">autofit</span>() <span class="sc">|&gt;</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_vanilla</span>()   <span class="sc">%&gt;%</span>         <span class="co"># Clean academic style</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># This command removes any remaining horizontal lines inside the body</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">border_inner_h</span>(<span class="at">part =</span> <span class="st">"body"</span>, <span class="at">border =</span> officer<span class="sc">::</span><span class="fu">fp_border</span>(<span class="at">width =</span> <span class="dv">0</span>))</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#|fig-height: 18</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(math <span class="sc">~</span> expenditure, <span class="at">data =</span> CASchools)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m, <span class="at">col =</span> <span class="st">"steelblue"</span>, <span class="at">pch =</span> <span class="dv">20</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-ols" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ols-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-ols-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ols-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: OLS assumptions visual diagnostic
</figcaption>
</figure>
</div>
</div>
</div>
<ul>
<li>A plot of residuals vs.&nbsp;fitted values assesses linearity and homoscedasticity assumption. A random (white noise) scatter around 0 suggests the assumptions are met.</li>
<li>A normal quantile-quantile (Q-Q) plot assesses the normality assumption of the residuals with departure from the straight line suggesting departure from normality.</li>
<li>A plot of standardized residuals against fitted values assesses homoscedasticity assumption. Look for white noise around the horizontal line in the scale location plot.</li>
<li>The residual vs.&nbsp;leverage plot assesses for influential outliers. Points far away from the center are considered influential.</li>
</ul>
<p>A number of factors may make multiple OLS regression biased due to a violation of any of the assumptions underlying OLS. Sources of these biases include:</p>
<p><strong>omitted variables, misspecification of the functional form, measurement errors, missing data and sample selection, simultaneous causality bias</strong>.</p>
<section id="omitted-variables" class="level2">
<h2 class="anchored" data-anchor-id="omitted-variables">omitted variables</h2>
<p>There is no easy fix for addressing omitted variables as a source of bias. Available guidelines stress</p>
<ol type="1">
<li>specifying coefficient(s) of interest</li>
<li>Identifying important sources of omitted variable bias using available domain knowledge prior to model fitting so you end up with a a baseline model specification and a questionable list of other regressors</li>
<li>Using different model specification to test whether questionable regressors have effects different from zero</li>
<li>Providing full disclosure of your results such as results of different model specifications in support of your argument</li>
</ol>
<p>The other sources of bias can be assessed via simulations.</p>
</section>
<section id="misspecification-of-the-functional-form-of-a-regression-function" class="level2">
<h2 class="anchored" data-anchor-id="misspecification-of-the-functional-form-of-a-regression-function">Misspecification of the functional form of a regression function</h2>
<p>Assume the underlying function is such that <span class="math inline">\(Y_i = X_i^2\)</span>, but the model is specified in the form <span class="math inline">\(Y_i = \beta_0 + \beta_1X_i + \epsilon_i\)</span>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="fu">as.numeric</span>(<span class="fu">Sys.time</span>()))</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">100</span>, <span class="sc">-</span><span class="dv">5</span>, <span class="dv">5</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> X<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">100</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>ml <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  X,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  Y,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">"Model misspecification"</span>,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">pch =</span> <span class="dv">20</span>,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="st">"steelblue"</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co"># add the regression line</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  ml,</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="st">"grey"</span>,</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwd =</span> <span class="dv">2</span>, </span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">lty =</span> <span class="dv">2</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">"bottomright"</span>,</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">bg =</span> <span class="st">"transparent"</span>,</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">cex =</span> <span class="fl">0.8</span>,</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">lty =</span> <span class="dv">2</span>,</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="st">"grey"</span>,</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend =</span> <span class="st">"OLS line"</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-ms-lm" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ms-lm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-ms-lm-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ms-lm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Model misspecification
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="measurement-error-and-errors-in-variable-bias" class="level2">
<h2 class="anchored" data-anchor-id="measurement-error-and-errors-in-variable-bias">Measurement error and errors-in-variable bias</h2>
<p>Set in due to imprecise measurement of the independent variable and do not disappear not even with a large sample size. Due to imprecise measurements we observe <span class="math inline">\(\overset{\sim}{X}_i\)</span> instead of <span class="math inline">\(X_i\)</span> the model under consideration becomes</p>
<p><span class="math display">\[\begin{align*}
  Y_i =&amp; \, \beta_0 + \beta_1 \overset{\sim}{X}_i + \underbrace{\beta_1 (X_i - \overset{\sim}{X}_i) + u_i}_{=v_i}. \\
  Y_i =&amp; \, \beta_0 + \beta_1 \overset{\sim}{X}_i + v_i.
\end{align*}\]</span></p>
<p>where <span class="math inline">\(\overset{\sim}{X}_i\)</span> and the error term <span class="math inline">\(v_i\)</span> are correlated. The OLS would thus be biased and inconsistent for <span class="math inline">\(B_1\)</span> with the strength of bias dependent on the correlation between the observed regressor <span class="math inline">\(\overset{\sim}{X}_i\)</span> and the measurement error <span class="math inline">\(w_i = X_i - \overset{\sim}{X}_i\)</span>. The classical measurement error model assumes that the measurement error, <span class="math inline">\(w_i\)</span>, has zero mean and that it is uncorrelated with the variable, <span class="math inline">\(X_i\)</span>, and the error term of the population regression model, <span class="math inline">\(u_i\)</span>:</p>
<p><span class="math display">\[\begin{equation}
  \overset{\sim}{X}_i = X_i + w_i, \ \ \rho_{w_i,u_i}=0, \ \ \rho_{w_i,X_i}=0.
\end{equation}\]</span> Then it holds that <span id="eq-cmembias"><span class="math display">\[\begin{equation}
  \widehat{\beta}_1 \xrightarrow{p}{\frac{\sigma_{X}^2}{\sigma_{X}^2 + \sigma_{w}^2}} \beta_1,
\end{equation}
\tag{1}\]</span></span> which implies inconsistency as <span class="math inline">\(\sigma_{X}^2, \sigma_{w}^2 &gt; 0\)</span> such that the fraction in (<a href="#eq-cmembias" class="quarto-xref">Equation&nbsp;1</a>) is smaller than <span class="math inline">\(1\)</span>. Note that there are two extreme cases:</p>
<ol type="1">
<li><p>If there is no measurement error, <span class="math inline">\(\sigma_{w}^2=0\)</span> such that <span class="math inline">\(\widehat{\beta}_1 \xrightarrow{p}{\beta_1}\)</span>.</p></li>
<li><p>If <span class="math inline">\(\sigma_{w}^2 \gg \sigma_{X}^2\)</span> we have <span class="math inline">\(\widehat{\beta}_1 \xrightarrow{p}{0}\)</span>. This is the case if the measurement error is so large that there essentially is no information on <span class="math inline">\(X\)</span> in the data that can be used to estimate <span class="math inline">\(\beta_1\)</span>.</p></li>
</ol>
<p>The most obvious way to deal with errors-in-variables bias is to use an accurately measured <span class="math inline">\(X\)</span>. If this is not possible, instrumental variables regression is an option. One might also deal with the issue by using a mathematical model of the measurement error and adjust the estimates appropriately: if it is plausible that the classical measurement error model applies and if there is information that can be used to estimate the ratio in equation (<a href="#eq-cmembias" class="quarto-xref">Equation&nbsp;1</a>), one could compute an estimate that corrects for the downward bias.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rmvnorm</span>(<span class="dv">1000</span>, <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">100</span>), </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">sigma =</span> <span class="fu">cbind</span>(<span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">5</span>), <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>))))</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># set columns names</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(dat) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"X"</span>, <span class="st">"Y"</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate the model (without measurement error)</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>noerror_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X, <span class="at">data =</span> dat)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate the model (with measurement error in X)</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>X <span class="ot">&lt;-</span> dat<span class="sc">$</span>X <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="at">sd =</span> <span class="fu">sqrt</span>(<span class="dv">10</span>))</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>error_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X, <span class="at">data =</span> dat)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co"># print estimated coefficients to console</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>noerror_mod<span class="sc">$</span>coefficients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)           X 
 74.7383283   0.5046925 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; (Intercept)           X </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  76.3002047   0.4755264</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>error_mod<span class="sc">$</span>coefficients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)           X 
 88.8165365   0.2228252 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; (Intercept)           X </span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   87.276004    0.255212</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   </span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot sample data</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>X, dat<span class="sc">$</span>Y, </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">20</span>, </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"X"</span>,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Y"</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># add population regression function</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">coef =</span> <span class="fu">c</span>(<span class="dv">75</span>, <span class="fl">0.5</span>), </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">"darkgreen"</span>,</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd  =</span> <span class="fl">1.5</span>)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co"># add estimated regression functions</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(noerror_mod, </span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">"purple"</span>,</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd  =</span> <span class="fl">1.5</span>)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(error_mod, </span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">"darkred"</span>,</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd  =</span> <span class="fl">1.5</span>)</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="co"># add legend</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>,</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">bg =</span> <span class="st">"transparent"</span>,</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">cex =</span> <span class="fl">0.8</span>,</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">lty =</span> <span class="dv">1</span>,</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"darkgreen"</span>, <span class="st">"purple"</span>, <span class="st">"darkred"</span>), </span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Population"</span>, <span class="st">"No Errors"</span>, <span class="st">"Errors"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-me" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-me-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-me-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-me-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Measurement error
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="missing-data-and-sample-selection" class="level2">
<h2 class="anchored" data-anchor-id="missing-data-and-sample-selection">Missing data and sample selection</h2>
<p>If data is not missing at random, we are faced with biased estimates.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># randmly select 500 obs</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>, <span class="dv">500</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>dat1 <span class="ot">&lt;-</span> dat[<span class="sc">-</span>id,]</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>dat2 <span class="ot">&lt;-</span> dat[id,]</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>ci_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X, <span class="at">data =</span> dat1)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  dat1<span class="sc">$</span>X,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  dat1<span class="sc">$</span>Y,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">pch =</span> <span class="dv">20</span>,</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">cex =</span> <span class="fl">0.8</span>,</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"X"</span>,</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">"Y"</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  dat2<span class="sc">$</span>X,</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  dat2<span class="sc">$</span>Y,</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">cex =</span> <span class="fl">0.8</span>,</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="st">"grey"</span>,</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">pch =</span> <span class="dv">20</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="co"># add pop reg function</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">coef =</span> <span class="fu">c</span>(<span class="dv">75</span>, <span class="dv">100</span>),</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="st">"darkgreen"</span>,</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwd =</span> <span class="fl">1.5</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a><span class="co"># add full sample model</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(noerror_mod, <span class="at">col =</span> <span class="st">"black"</span>)</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a><span class="co"># add model without a sample of 500</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(ci_mod, <span class="at">col =</span> <span class="st">"purple"</span>)</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>  <span class="st">"bottomright"</span>,</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">lty =</span> <span class="dv">2</span>,</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">bg =</span> <span class="st">"transparent"</span>,</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">cex =</span> <span class="fl">0.8</span>,</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"darkgreen"</span>, <span class="st">"black"</span>, <span class="st">"purple"</span>),</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"population"</span>, <span class="st">"full sample"</span>, <span class="st">"random sample of 500"</span>)</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-mis" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-mis-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-mis-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mis-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Missing data bias
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="simultaneous-causality-bias" class="level2">
<h2 class="anchored" data-anchor-id="simultaneous-causality-bias">Simultaneous causality bias</h2>
<p>Arises when <code>Y</code> influences <code>X</code>. Lets assume that we are interested in estimating the effect of 20% increase in price on cigarette. We get the log of price and use it to model consumption, giving a price elasticity of consumption interpretation. Since it is not demand on the Y-axis, this not an estimate of the demand curve, and is therefore a classic example of reverse (simultaneous) causality.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"CigarettesSW"</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>c1995 <span class="ot">&lt;-</span> <span class="fu">subset</span>(CigarettesSW, year <span class="sc">==</span> <span class="st">"1995"</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate the model</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>cigcon_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(packs) <span class="sc">~</span> <span class="fu">log</span>(price), <span class="at">data =</span> c1995)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>cigcon_mod</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(packs) ~ log(price), data = c1995)

Coefficients:
(Intercept)   log(price)  
     10.850       -1.213  </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the estimated regression line and the data</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">log</span>(c1995<span class="sc">$</span>price), <span class="fu">log</span>(c1995<span class="sc">$</span>packs),</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"ln(Price)"</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"ln(Consumption)"</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Demand for Cigarettes"</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">20</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"steelblue"</span>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(cigcon_mod, </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">"darkred"</span>, </span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="fl">1.5</span>)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co"># add legend</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>,<span class="at">lty=</span><span class="dv">1</span>,<span class="at">col=</span> <span class="st">"darkred"</span>, <span class="st">"Estimated Regression Line"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-revc" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-revc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-revc-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-revc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Reverse causlaity bias
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="instrumental-variable-regression" class="level1">
<h1>Instrumental variable regression</h1>
<section id="simple-instrumental-variable-regression" class="level2">
<h2 class="anchored" data-anchor-id="simple-instrumental-variable-regression">Simple instrumental variable regression</h2>
<p>Instrumental variables (IV) can be used to address possible omitted variable bias. Considering a simple regression model</p>
<p><span id="eq-lm"><span class="math display">\[
\begin{equation}
Y_i = \beta_0 + \beta_1X_i + \epsilon_i, i = 1, \ldots, n
\end{equation}
\tag{2}\]</span></span></p>
<p>in which the error term is correlated with the endogenous regressor <span class="math inline">\(X\)</span> making the OLS estimate inconsistent for <span class="math inline">\(\beta_1\)</span>, we can use a single IV variable <span class="math inline">\(Z\)</span> to obtain a consistent estimator for <span class="math inline">\(\beta_1\)</span>. The IV variable has to meet the</p>
<ol type="1">
<li><strong>relevance condition</strong>: <span class="math inline">\(X\)</span> and its instrument <span class="math inline">\(Z\)</span> must be correlated <span class="math inline">\(\rho_{Z_i, X_i} \ne 0\)</span> or multicollinear for multiple IV regression.</li>
<li><strong>instrument exogeneity condition</strong>: The instrument <span class="math inline">\(Z\)</span> must not be correlated with the error term. <span class="math inline">\(\rho_{Z_i, \epsilon_i} = 0\)</span></li>
</ol>
<p>Estimation is through a two-stage least square (TSLS) estimation. The first stage condenses the variation in the endogenous variable <span class="math inline">\(X\)</span> into a problem-free part that is explained by the IV variable <span class="math inline">\(Z\)</span>, and a problematic component that is correlated to the error term <span class="math inline">\(\epsilon_i\)</span>. In the second stage the problem-free component of the variation in <span class="math inline">\(X\)</span> is used to estimate <span class="math inline">\(\beta_1\)</span>.</p>
<p>The first stage uses the regression model <span class="math inline">\(X_i = \pi_0 + \pi_1Z_i + v_i\)</span>, where <span class="math inline">\(\pi_0 + \pi_1Z_i\)</span> is the component of <span class="math inline">\(X_i\)</span> explained by <span class="math inline">\(Z_i\)</span>, and <span class="math inline">\(v_i\)</span> is the component that can not be explained by <span class="math inline">\(Z_i\)</span> and is correlated with <span class="math inline">\(\epsilon_i\)</span>. We can use OLS estimates <span class="math inline">\(\hat{\pi_0}\)</span> and <span class="math inline">\(\hat{\pi_1}\)</span> to predict <span class="math inline">\(X_i\)</span> giving problem-free <span class="math inline">\(\hat{X_i}\)</span> (<span class="math inline">\(\hat{X_i}\)</span> exogenous in the regression of Y on <span class="math inline">\(\hat{X}\)</span> done on second stage ) if <span class="math inline">\(Z\)</span> is indeed a valid instrument. The second stage produces <span class="math inline">\(\hat{\beta}_0^{TSLS}\)</span>, and <span class="math inline">\(\hat{\beta}_1^{TSLS}\)</span>, which are the TSLS estimates of <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span> respectively. For a single IV it can be shown that the TSLS estimator is but the ratio of sample covariance between <span class="math inline">\(Z\)</span> and <span class="math inline">\(Y\)</span></p>
<p><span id="eq-tsls"><span class="math display">\[
\begin{equation}
\hat{\beta}^{TSLS} = \frac{s_{Z, Y}}{s_{Z, X}} = \frac{\frac{1}{n-1} \sum_{i=1}^n (Y_i - \bar{Y})(Z_i - \bar{Z})}{\frac{1}{n-1}\sum_{i=1}^n (X_i - \bar{X}) (Z_i - \bar{Z})}
\end{equation}
\tag{3}\]</span></span></p>
<section id="example-demand-for-cigarettes" class="level3">
<h3 class="anchored" data-anchor-id="example-demand-for-cigarettes">Example: Demand for cigarettes</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>skimr<span class="sc">::</span><span class="fu">skim</span>(CigarettesSW)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">CigarettesSW</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">96</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">factor</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 17%">
<col style="width: 12%">
<col style="width: 17%">
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 32%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: left;">ordered</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: left;">top_counts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">state</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">48</td>
<td style="text-align: left;">AL: 2, AR: 2, AZ: 2, CA: 2</td>
</tr>
<tr class="even">
<td style="text-align: left;">year</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">198: 48, 199: 48</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 10%">
<col style="width: 7%">
<col style="width: 10%">
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">cpi</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.30</td>
<td style="text-align: right;">0.23</td>
<td style="text-align: right;">1.08</td>
<td style="text-align: right;">1.08</td>
<td style="text-align: right;">1.30</td>
<td style="text-align: right;">1.52000e+00</td>
<td style="text-align: right;">1.52</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">population</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5168866.32</td>
<td style="text-align: right;">5442344.66</td>
<td style="text-align: right;">478447.00</td>
<td style="text-align: right;">1622606.50</td>
<td style="text-align: right;">3697471.50</td>
<td style="text-align: right;">5.90150e+06</td>
<td style="text-align: right;">31493524.00</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">packs</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">109.18</td>
<td style="text-align: right;">25.87</td>
<td style="text-align: right;">49.27</td>
<td style="text-align: right;">92.45</td>
<td style="text-align: right;">110.16</td>
<td style="text-align: right;">1.23520e+02</td>
<td style="text-align: right;">197.99</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">income</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">99878735.74</td>
<td style="text-align: right;">120541138.18</td>
<td style="text-align: right;">6887097.00</td>
<td style="text-align: right;">25520384.00</td>
<td style="text-align: right;">61661644.00</td>
<td style="text-align: right;">1.27314e+08</td>
<td style="text-align: right;">771470144.00</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">tax</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">42.68</td>
<td style="text-align: right;">16.14</td>
<td style="text-align: right;">18.00</td>
<td style="text-align: right;">31.00</td>
<td style="text-align: right;">37.00</td>
<td style="text-align: right;">5.08800e+01</td>
<td style="text-align: right;">99.00</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">price</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">143.45</td>
<td style="text-align: right;">43.89</td>
<td style="text-align: right;">84.97</td>
<td style="text-align: right;">102.71</td>
<td style="text-align: right;">137.72</td>
<td style="text-align: right;">1.76150e+02</td>
<td style="text-align: right;">240.85</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">taxs</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">48.33</td>
<td style="text-align: right;">19.33</td>
<td style="text-align: right;">21.27</td>
<td style="text-align: right;">34.77</td>
<td style="text-align: right;">41.05</td>
<td style="text-align: right;">5.94800e+01</td>
<td style="text-align: right;">112.63</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We wish to estimate <span class="math inline">\(\beta_1\)</span> in</p>
<p><span id="eq-tcigar"><span class="math display">\[
\begin{equation}
log(Q_i) = \beta_0 + \beta_1 log(P_i) + \epsilon_i
\end{equation}
\tag{4}\]</span></span></p>
<p>where <span class="math inline">\(Q_i\)</span> is the number of cigarette packs per capita sold and <span class="math inline">\(P_i\)</span> is the after tax average real price per pack of cigarette in state <span class="math inline">\(i\)</span>. We use sales tax (dollars per pack) to instrument the endogenous regressor <span class="math inline">\(log(P_i)\)</span>. Salestax is considered a relevant instrument as it is included in the after-tax average price per pack.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute real per capita prices</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>CigarettesSW<span class="sc">$</span>rprice <span class="ot">&lt;-</span> <span class="fu">with</span>(CigarettesSW, price <span class="sc">/</span> cpi)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">#  compute the sales tax</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>CigarettesSW<span class="sc">$</span>salestax <span class="ot">&lt;-</span> <span class="fu">with</span>(CigarettesSW, (taxs <span class="sc">-</span> tax) <span class="sc">/</span> cpi)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># check the correlation between sales tax and price</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(CigarettesSW<span class="sc">$</span>salestax, CigarettesSW<span class="sc">$</span>price)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6141228</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.6141228</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># generate a subset for the year 1995</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>c1995 <span class="ot">&lt;-</span> <span class="fu">subset</span>(CigarettesSW, year <span class="sc">==</span> <span class="st">"1995"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The first stage regression is <span class="math inline">\(log(P_i) = \pi_0 + \pi_1SalesTax_i + v_i\)</span>. In the second stage we regress <span class="math inline">\(log(Q_i)\)</span> on <span class="math inline">\(log(P_i)\)</span> to obtain <span class="math inline">\(\hat{\beta_0}^{TSLS}\)</span> <span class="math inline">\(\hat{\beta_1}^{TSLS}\)</span>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># perform the first stage regression</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>cig_s1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(rprice) <span class="sc">~</span> salestax, <span class="at">data =</span> c1995)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(cig_s1, <span class="at">vcov =</span> vcovHC, <span class="at">type =</span> <span class="st">"HC1"</span>) <span class="sc">%&gt;%</span> broom<span class="sc">::</span><span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p.value =</span> prettyunits<span class="sc">::</span><span class="fu">pretty_p_value</span>(p.value)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  flextable<span class="sc">::</span><span class="fu">flextable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="tabwid"><style>.cl-635dd196{}.cl-633379a0{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-6344d696{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-6344d6c8{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-63457146{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6345716e{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-63457182{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-63457196{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-634571a0{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-634571be{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-635dd196"><thead><tr style="overflow-wrap:break-word;"><th class="cl-63457146"><p class="cl-6344d696"><span class="cl-633379a0">term</span></p></th><th class="cl-6345716e"><p class="cl-6344d6c8"><span class="cl-633379a0">estimate</span></p></th><th class="cl-6345716e"><p class="cl-6344d6c8"><span class="cl-633379a0">std.error</span></p></th><th class="cl-6345716e"><p class="cl-6344d6c8"><span class="cl-633379a0">statistic</span></p></th><th class="cl-63457146"><p class="cl-6344d696"><span class="cl-633379a0">p.value</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-63457182"><p class="cl-6344d696"><span class="cl-633379a0">(Intercept)</span></p></td><td class="cl-63457196"><p class="cl-6344d6c8"><span class="cl-633379a0">4.61654632</span></p></td><td class="cl-63457196"><p class="cl-6344d6c8"><span class="cl-633379a0">0.028917686</span></p></td><td class="cl-63457196"><p class="cl-6344d6c8"><span class="cl-633379a0">159.644388</span></p></td><td class="cl-63457182"><p class="cl-6344d696"><span class="cl-633379a0">&lt;0.0001</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-634571a0"><p class="cl-6344d696"><span class="cl-633379a0">salestax</span></p></td><td class="cl-634571be"><p class="cl-6344d6c8"><span class="cl-633379a0">0.03072886</span></p></td><td class="cl-634571be"><p class="cl-6344d6c8"><span class="cl-633379a0">0.004835432</span></p></td><td class="cl-634571be"><p class="cl-6344d6c8"><span class="cl-633379a0">6.354935</span></p></td><td class="cl-634571a0"><p class="cl-6344d696"><span class="cl-633379a0">&lt;0.0001</span></p></td></tr></tbody></table></div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># store the fitted values from first stage</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>lcigp_pred <span class="ot">&lt;-</span> cig_s1<span class="sc">$</span>fitted.values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Run the second stage:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>cig_s2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(c1995<span class="sc">$</span>packs) <span class="sc">~</span> lcigp_pred)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(cig_s2, <span class="at">vcov. =</span> vcovHC) <span class="sc">%&gt;%</span> broom<span class="sc">::</span><span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p.value =</span> prettyunits<span class="sc">::</span><span class="fu">pretty_p_value</span>(p.value)) <span class="sc">%&gt;%</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  flextable<span class="sc">::</span><span class="fu">flextable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="tabwid"><style>.cl-63cb5d4c{}.cl-63a3f25c{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-63b71a8a{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-63b71abc{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-63b7ac20{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-63b7ac52{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-63b7ac66{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-63b7ac70{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-63b7ac8e{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-63b7ac98{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-63cb5d4c"><thead><tr style="overflow-wrap:break-word;"><th class="cl-63b7ac20"><p class="cl-63b71a8a"><span class="cl-63a3f25c">term</span></p></th><th class="cl-63b7ac52"><p class="cl-63b71abc"><span class="cl-63a3f25c">estimate</span></p></th><th class="cl-63b7ac52"><p class="cl-63b71abc"><span class="cl-63a3f25c">std.error</span></p></th><th class="cl-63b7ac52"><p class="cl-63b71abc"><span class="cl-63a3f25c">statistic</span></p></th><th class="cl-63b7ac20"><p class="cl-63b71a8a"><span class="cl-63a3f25c">p.value</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-63b7ac66"><p class="cl-63b71a8a"><span class="cl-63a3f25c">(Intercept)</span></p></td><td class="cl-63b7ac70"><p class="cl-63b71abc"><span class="cl-63a3f25c">9.719877</span></p></td><td class="cl-63b7ac70"><p class="cl-63b71abc"><span class="cl-63a3f25c">1.7030357</span></p></td><td class="cl-63b7ac70"><p class="cl-63b71abc"><span class="cl-63a3f25c">5.707383</span></p></td><td class="cl-63b7ac66"><p class="cl-63b71a8a"><span class="cl-63a3f25c">&lt;0.0001</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-63b7ac8e"><p class="cl-63b71a8a"><span class="cl-63a3f25c">lcigp_pred</span></p></td><td class="cl-63b7ac98"><p class="cl-63b71abc"><span class="cl-63a3f25c">-1.083587</span></p></td><td class="cl-63b7ac98"><p class="cl-63b71abc"><span class="cl-63a3f25c">0.3556347</span></p></td><td class="cl-63b7ac98"><p class="cl-63b71abc"><span class="cl-63a3f25c">-3.046910</span></p></td><td class="cl-63b7ac8e"><p class="cl-63b71a8a"><span class="cl-63a3f25c">0.0038</span></p></td></tr></tbody></table></div>
</div>
</div>
<p>Thus estimating the model (<a href="#eq-tcigar" class="quarto-xref">Equation&nbsp;4</a>) using TSLS yields</p>
<p><span id="eq-ecigstsls"><span class="math display">\[
\begin{equation}
  \widehat{\log(Q_i)} = \underset{(1.70)}{9.72} - \underset{(0.36)}{1.08} \log(P_i)
\end{equation}
\tag{5}\]</span></span></p>
<p>where we write <span class="math inline">\(\log(P_i)\)</span> instead of <span class="math inline">\(\widehat{\log(P_i)}\)</span> for consistency. See <code>AER::ivreg()</code> for automatic IV regression.</p>
</section>
</section>
<section id="the-general-iv-regression-model" class="level2">
<h2 class="anchored" data-anchor-id="the-general-iv-regression-model">The general IV regression model</h2>
<p>An extension of simple IV regression to multiple predictors:</p>
<p><span id="eq-givmodel"><span class="math display">\[
\begin{equation}
  Y_i = \beta_0 + \beta_1 X_{1i} + \dots + \beta_k X_{ki} + \beta_{k+1} W_{1i} + \dots + \beta_{k+r} W_{ri} + \epsilon_i,
\end{equation}
\tag{6}\]</span></span></p>
<p>with <span class="math inline">\(i=1,\dots,n\)</span> is the general instrumental variables regression model where</p>
<ul>
<li><p><span class="math inline">\(Y_i\)</span> is the dependent variable,</p></li>
<li><p><span class="math inline">\(\\beta_0,\dots,\beta_{k+1}\)</span> are <span class="math inline">\(1+k+r\)</span> unknown regression coefficients,</p></li>
<li><p><span class="math inline">\(X_{1i},\dots,X_{ki}\)</span> are <span class="math inline">\(k\)</span> endogenous regressors ,</p></li>
<li><p><span class="math inline">\(W_{1i},\dots,W_{ri}\)</span> are <span class="math inline">\(r\)</span> exogenous regressors which are uncorrelated with <span class="math inline">\(u_i\)</span>,</p></li>
<li><p><span class="math inline">\(\epsilon_i\)</span> is the error term,</p></li>
<li><p><span class="math inline">\(Z_{1i},\dots,Z_{mi}\)</span> are <span class="math inline">\(m\)</span> instrumental variables.</p></li>
</ul>
<p>The coefficients are overidentified if <span class="math inline">\(m&gt;k\)</span>. If <span class="math inline">\(m&lt;k\)</span>, the coefficients are underidentified and when <span class="math inline">\(m=k\)</span> they are exactly identified. For estimation of the IV regression model we require exact identification or overidentification. The computations can be autometed with <code>AER::ivreg()</code> function.</p>
<p>Suppose we wish to estimate the model <span class="math inline">\(Y_i = \beta_0 + \beta_1X_{1i} + \beta_2X_{2i} + W_{1i} + \epsilon_i\)</span>, where <span class="math inline">\(X_{1i}\)</span> and <span class="math inline">\(X_{2i}\)</span> are endogenous variables instrumented by <span class="math inline">\(Z_{1i}\)</span> and <span class="math inline">\(Z_{2i}\)</span> respectively, and <span class="math inline">\(W_{1i}\)</span> is an exogenous variable, a correct model specification involves listing all exogenous variables as instruments too by joining them with <code>+</code>s on the right of the vertical bar <code>|</code>:</p>
<p><code>y ~ X1 + X2 + W1 | W1 + Z1 + Z2</code>. A convenient way of specifying a model is updating a formula using <code>.</code> (which includes all variables except for the outcome). For instance, if we have one exogenous regressor <span class="math inline">\(w1\)</span> and one endogenous regrossor <span class="math inline">\(x1\)</span> with instrument <span class="math inline">\(z1\)</span>, the appropriate formula would be <code>y ~ w1 + x1 | w1 + z1</code> <span class="math inline">\(=\)</span> <code>y ~ w1 + x1 | . ~ x1 + z1</code>.</p>
<p>Some assumptions underlying the IV regression are:</p>
<ol type="1">
<li><span class="math inline">\(E(\epsilon_i|W_{1i}, \dots, W_{ri}) = 0\)</span></li>
<li><span class="math inline">\((X_{1i}, \dots, X_{ki}, W_{1i}, \dots, W_{ri}, Z_{1i}, \dots, Z_{mi})\)</span> are i.i.d draws from their joint distribution</li>
<li>All variables have nonzero finite fourth moment, i.e., outliers are unlikely</li>
<li>The <span class="math inline">\(Z_s\)</span> are valid instruments.</li>
</ol>
<section id="example-demands-for-cigarettes" class="level3">
<h3 class="anchored" data-anchor-id="example-demands-for-cigarettes">Example: Demands for cigarettes</h3>
<p>We update (<a href="#eq-tcigar" class="quarto-xref">Equation&nbsp;4</a>) to include income:</p>
<p><span id="eq-ticigar"><span class="math display">\[
\begin{equation}
log(Q_i) = \beta_0 + \beta_1 log(P_i) + \beta_2 log(income_i) +  \epsilon_i
\end{equation}
\tag{7}\]</span></span></p>
<p>where income is defined as real per capita income.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add rincome to the dataset</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>CigarettesSW<span class="sc">$</span>rincome <span class="ot">&lt;-</span> <span class="fu">with</span>(CigarettesSW, income <span class="sc">/</span> population <span class="sc">/</span> cpi)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>c1995 <span class="ot">&lt;-</span> <span class="fu">subset</span>(CigarettesSW, year <span class="sc">==</span> <span class="st">"1995"</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate the model</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>cig_ivreg2 <span class="ot">&lt;-</span> <span class="fu">ivreg</span>(<span class="fu">log</span>(packs) <span class="sc">~</span> <span class="fu">log</span>(rprice) <span class="sc">+</span> <span class="fu">log</span>(rincome) <span class="sc">|</span> <span class="fu">log</span>(rincome) <span class="sc">+</span> </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>                    salestax, <span class="at">data =</span> c1995)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(cig_ivreg2, <span class="at">vcov =</span> vcovHC, <span class="at">type =</span> <span class="st">"HC1"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  broom<span class="sc">::</span><span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p.value =</span> prettyunits<span class="sc">::</span><span class="fu">pretty_p_value</span>(p.value)) <span class="sc">%&gt;%</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  flextable<span class="sc">::</span><span class="fu">flextable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="tabwid"><style>.cl-642ca480{}.cl-640b2562{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-641aec36{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-641aec68{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-641b9532{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-641b9578{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-641b958c{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-641b9596{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-641b95aa{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-641b95be{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-642ca480"><thead><tr style="overflow-wrap:break-word;"><th class="cl-641b9532"><p class="cl-641aec36"><span class="cl-640b2562">term</span></p></th><th class="cl-641b9578"><p class="cl-641aec68"><span class="cl-640b2562">estimate</span></p></th><th class="cl-641b9578"><p class="cl-641aec68"><span class="cl-640b2562">std.error</span></p></th><th class="cl-641b9578"><p class="cl-641aec68"><span class="cl-640b2562">statistic</span></p></th><th class="cl-641b9532"><p class="cl-641aec36"><span class="cl-640b2562">p.value</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-641b958c"><p class="cl-641aec36"><span class="cl-640b2562">(Intercept)</span></p></td><td class="cl-641b9596"><p class="cl-641aec68"><span class="cl-640b2562">9.4306583</span></p></td><td class="cl-641b9596"><p class="cl-641aec68"><span class="cl-640b2562">1.2593926</span></p></td><td class="cl-641b9596"><p class="cl-641aec68"><span class="cl-640b2562">7.4882595</span></p></td><td class="cl-641b958c"><p class="cl-641aec36"><span class="cl-640b2562">&lt;0.0001</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-641b958c"><p class="cl-641aec36"><span class="cl-640b2562">log(rprice)</span></p></td><td class="cl-641b9596"><p class="cl-641aec68"><span class="cl-640b2562">-1.1433751</span></p></td><td class="cl-641b9596"><p class="cl-641aec68"><span class="cl-640b2562">0.3723027</span></p></td><td class="cl-641b9596"><p class="cl-641aec68"><span class="cl-640b2562">-3.0710902</span></p></td><td class="cl-641b958c"><p class="cl-641aec36"><span class="cl-640b2562">0.0036</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-641b95aa"><p class="cl-641aec36"><span class="cl-640b2562">log(rincome)</span></p></td><td class="cl-641b95be"><p class="cl-641aec68"><span class="cl-640b2562">0.2145153</span></p></td><td class="cl-641b95be"><p class="cl-641aec68"><span class="cl-640b2562">0.3117469</span></p></td><td class="cl-641b95be"><p class="cl-641aec68"><span class="cl-640b2562">0.6881071</span></p></td><td class="cl-641b95aa"><p class="cl-641aec36"><span class="cl-640b2562">0.4949</span></p></td></tr></tbody></table></div>
</div>
</div>
<p>We obtain</p>
<p><span id="eq-eicigstsls"><span class="math display">\[
\begin{equation}
  \widehat{\log(Q_i)} = \underset{(1.26)}{9.43} - \underset{(0.37)}{1.14} \log(P_i) + \underset{(0.31)}{0.21} \log(income_i)
\end{equation}
\tag{8}\]</span></span></p>
<p>Adding salestax as an IV:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add cigtax to the data set</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>CigarettesSW<span class="sc">$</span>cigtax <span class="ot">&lt;-</span> <span class="fu">with</span>(CigarettesSW, tax<span class="sc">/</span>cpi)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>c1995 <span class="ot">&lt;-</span> <span class="fu">subset</span>(CigarettesSW, year <span class="sc">==</span> <span class="st">"1995"</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate the model</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>cig_ivreg3 <span class="ot">&lt;-</span> <span class="fu">ivreg</span>(<span class="fu">log</span>(packs) <span class="sc">~</span> <span class="fu">log</span>(rprice) <span class="sc">+</span> <span class="fu">log</span>(rincome) <span class="sc">|</span> </span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">log</span>(rincome) <span class="sc">+</span> salestax <span class="sc">+</span> cigtax, <span class="at">data =</span> c1995)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(cig_ivreg3, <span class="at">vcov =</span> vcovHC, <span class="at">type =</span> <span class="st">"HC1"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  broom<span class="sc">::</span><span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p.value =</span> prettyunits<span class="sc">::</span><span class="fu">pretty_p_value</span>(p.value)) <span class="sc">%&gt;%</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  flextable<span class="sc">::</span><span class="fu">flextable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="tabwid"><style>.cl-648d380e{}.cl-646c82d0{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-647aa22a{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-647aa25c{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-647b3852{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-647b387a{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-647b3884{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-647b3898{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-647b38a2{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-647b38ac{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-648d380e"><thead><tr style="overflow-wrap:break-word;"><th class="cl-647b3852"><p class="cl-647aa22a"><span class="cl-646c82d0">term</span></p></th><th class="cl-647b387a"><p class="cl-647aa25c"><span class="cl-646c82d0">estimate</span></p></th><th class="cl-647b387a"><p class="cl-647aa25c"><span class="cl-646c82d0">std.error</span></p></th><th class="cl-647b387a"><p class="cl-647aa25c"><span class="cl-646c82d0">statistic</span></p></th><th class="cl-647b3852"><p class="cl-647aa22a"><span class="cl-646c82d0">p.value</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-647b3884"><p class="cl-647aa22a"><span class="cl-646c82d0">(Intercept)</span></p></td><td class="cl-647b3898"><p class="cl-647aa25c"><span class="cl-646c82d0">9.8949555</span></p></td><td class="cl-647b3898"><p class="cl-647aa25c"><span class="cl-646c82d0">0.9592169</span></p></td><td class="cl-647b3898"><p class="cl-647aa25c"><span class="cl-646c82d0">10.315660</span></p></td><td class="cl-647b3884"><p class="cl-647aa22a"><span class="cl-646c82d0">&lt;0.0001</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-647b3884"><p class="cl-647aa22a"><span class="cl-646c82d0">log(rprice)</span></p></td><td class="cl-647b3898"><p class="cl-647aa25c"><span class="cl-646c82d0">-1.2774241</span></p></td><td class="cl-647b3898"><p class="cl-647aa25c"><span class="cl-646c82d0">0.2496100</span></p></td><td class="cl-647b3898"><p class="cl-647aa25c"><span class="cl-646c82d0">-5.117680</span></p></td><td class="cl-647b3884"><p class="cl-647aa22a"><span class="cl-646c82d0">&lt;0.0001</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-647b38a2"><p class="cl-647aa22a"><span class="cl-646c82d0">log(rincome)</span></p></td><td class="cl-647b38ac"><p class="cl-647aa25c"><span class="cl-646c82d0">0.2804048</span></p></td><td class="cl-647b38ac"><p class="cl-647aa25c"><span class="cl-646c82d0">0.2538897</span></p></td><td class="cl-647b38ac"><p class="cl-647aa25c"><span class="cl-646c82d0">1.104436</span></p></td><td class="cl-647b38a2"><p class="cl-647aa22a"><span class="cl-646c82d0">0.2753</span></p></td></tr></tbody></table></div>
</div>
</div>
<p><span id="eq-eicigstsls-2"><span class="math display">\[
\begin{equation}
  \widehat{\log(Q_i)} = \underset{(0.96)}{9.89} - \underset{(0.25)}{1.28} \log(P_i) + \underset{(0.25)}{0.28} \log(income_i)
\end{equation}
\tag{9}\]</span></span></p>
<p>A question then arises on which estimates to trust. One could argue that the estimates from (<a href="#eq-eicigstsls-2" class="quarto-xref">Equation&nbsp;9</a>) are more trustworthy due to the lower standard errors compared to (<a href="#eq-eicigstsls" class="quarto-xref">Equation&nbsp;8</a>). This is the subject considered under instrument validity.</p>
</section>
</section>
<section id="checking-instrument-validity" class="level2">
<h2 class="anchored" data-anchor-id="checking-instrument-validity">Checking instrument validity</h2>
<ol type="1">
<li><strong>Weak instrument</strong>: To check for a weak instrument, compute the <span class="math inline">\(F\)</span>-statistic corresponding to the hypothesis <span class="math inline">\(H_0: Z_1 = \dots Z_m = 0\)</span>. A rule of thumb is that an <span class="math inline">\(F\)</span>-statistic less than 10 imply weak instruments. If your instruments are weak, you can discard them and find better instruments or stick with them but find methods that improve TSLS.</li>
<li><strong>Instrument exogeneity assumption is not met</strong>: When we observe a correlation between an instrument and the error term, the IV regression is not consistent. Overidentifying restriction test (J-test) is used to test that additional instruments are exogenous. It follows <span class="math inline">\(\chi^2_{m -k}\)</span> (under homoscedasticity), where <span class="math inline">\(m\)</span> is the number of instruments and <span class="math inline">\(k\)</span> the number of endogenous regressors. It involves regressing the error term on all instruments and endogenous variables:</li>
</ol>
<p><span id="eq-jstat"><span class="math display">\[
\begin{equation}
\hat{\epsilon}^{TSLS} = \delta_0 + \delta_1Z_{1i} + \dots + \delta_mZ_{mi} +
\delta_{m+1}W_{1i} + \dots + \delta_{m+r}W_{ri} + e_i
\end{equation}
\tag{10}\]</span></span></p>
<p>and testing whether all instruments are exogenous through the joint hypothesis <span class="math inline">\(H_0: \delta_1 = 0, \dots, \delta_m = 0\)</span>, and computing the statistic <span class="math inline">\(J = mF\)</span>. (see <a href="https://www.econometrics-with-r.org/12.4-attdfc.html" class="uri">https://www.econometrics-with-r.org/12.4-attdfc.html</a>)</p>
<section id="example-demand-for-cigarettes-1" class="level3">
<h3 class="anchored" data-anchor-id="example-demand-for-cigarettes-1">Example: Demand for cigarettes</h3>
<p>We assess whether general sales tax and the cigarette-specific tax are valid instruments. It could be argued that tobacco growing states find economic importance in lower tobacco taxes and may lobby for them staying low. It may also be possible that tobacco growing states have higher rates of smoking than others, which would lead to endogeneity of cigarette-specific taxes. This can only be solved by including data on the size of the tobacco and cigarette industry into the regression, which is not available in this case.</p>
<p>It can be assumed that the role of tobacco and cigarette industry differs across states, but not across time. We can then exploit the panel structure of the data at two different time periods (1985, 1995) to estimate the <em>long-run elasticity</em> of the demand for cigarettes:</p>
<p><span id="eq-elas"><span class="math display">\[
\begin{equation}
log(Q_{i, 1995}) - log(Q_{i, 1985}) = \beta_0 + \beta_1[log(P_{i, 1995}) -
log(P_{i, 1985})] + \beta_2[log(income_{i, 1995}) - log(income_{i, 1985})] + \epsilon_i
\end{equation}
\tag{11}\]</span></span></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># subset data for year 1985</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>c1985 <span class="ot">&lt;-</span> <span class="fu">subset</span>(CigarettesSW, year <span class="sc">==</span> <span class="st">"1985"</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># define differences in variables</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>packsdiff <span class="ot">&lt;-</span> <span class="fu">log</span>(c1995<span class="sc">$</span>packs) <span class="sc">-</span> <span class="fu">log</span>(c1985<span class="sc">$</span>packs)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>pricediff <span class="ot">&lt;-</span> <span class="fu">log</span>(c1995<span class="sc">$</span>price<span class="sc">/</span>c1995<span class="sc">$</span>cpi) <span class="sc">-</span> <span class="fu">log</span>(c1985<span class="sc">$</span>price<span class="sc">/</span>c1985<span class="sc">$</span>cpi)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>incomediff <span class="ot">&lt;-</span> <span class="fu">log</span>(c1995<span class="sc">$</span>income<span class="sc">/</span>c1995<span class="sc">$</span>population<span class="sc">/</span>c1995<span class="sc">$</span>cpi) <span class="sc">-</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="fu">log</span>(c1985<span class="sc">$</span>income<span class="sc">/</span>c1985<span class="sc">$</span>population<span class="sc">/</span>c1985<span class="sc">$</span>cpi)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>salestaxdiff <span class="ot">&lt;-</span> (c1995<span class="sc">$</span>taxs <span class="sc">-</span> c1995<span class="sc">$</span>tax)<span class="sc">/</span>c1995<span class="sc">$</span>cpi <span class="sc">-</span> </span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>                                  (c1985<span class="sc">$</span>taxs <span class="sc">-</span> c1985<span class="sc">$</span>tax)<span class="sc">/</span>c1985<span class="sc">$</span>cpi</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>cigtaxdiff <span class="ot">&lt;-</span> c1995<span class="sc">$</span>tax<span class="sc">/</span>c1995<span class="sc">$</span>cpi <span class="sc">-</span> c1985<span class="sc">$</span>tax<span class="sc">/</span>c1985<span class="sc">$</span>cpi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We then perform 3 different IV estimations using <code>ivreg()</code>for differences between 1985, 1995:</p>
<ol type="1">
<li>TSLS using only the difference in sales taxes as the IV</li>
<li>TSLS using only difference in cigarette-specific taxes</li>
<li>TSLS using both differences in sales taxes and cigarette-specific taxes</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># estimating the 3 models</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>cig_ivreg_diff1 <span class="ot">&lt;-</span> <span class="fu">ivreg</span>(</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  packsdiff <span class="sc">~</span> pricediff <span class="sc">+</span> incomediff <span class="sc">|</span> incomediff <span class="sc">+</span> salestaxdiff</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>cig_ivreg_diff2 <span class="ot">&lt;-</span> cig_ivreg_diff1 <span class="ot">&lt;-</span> <span class="fu">ivreg</span>(</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  packsdiff <span class="sc">~</span> pricediff <span class="sc">+</span> incomediff <span class="sc">|</span> incomediff <span class="sc">+</span> cigtaxdiff</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>cig_ivreg_diff3 <span class="ot">&lt;-</span> cig_ivreg_diff1 <span class="ot">&lt;-</span> <span class="fu">ivreg</span>(</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  packsdiff <span class="sc">~</span> pricediff <span class="sc">+</span> incomediff <span class="sc">|</span> incomediff <span class="sc">+</span> salestaxdiff <span class="sc">+</span> cigtaxdiff</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Sales tax as IV</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(cig_ivreg_diff1, <span class="at">vcov. =</span> vcovHC, <span class="at">type =</span> <span class="st">"HC1"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render_summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-sltx" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-sltx-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Difference in sales tax as IV
</figcaption>
<div aria-describedby="tbl-sltx-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="tabwid"><style>.cl-650f5b4a{}.cl-64ec6770{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-64f9c46a{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-64f9c4a6{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-64fa48f4{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-64fa4912{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-64fa491c{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-64fa4926{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-64fa4930{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-64fa493a{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-650f5b4a"><thead><tr style="overflow-wrap:break-word;"><th class="cl-64fa48f4"><p class="cl-64f9c46a"><span class="cl-64ec6770">term</span></p></th><th class="cl-64fa4912"><p class="cl-64f9c4a6"><span class="cl-64ec6770">estimate</span></p></th><th class="cl-64fa4912"><p class="cl-64f9c4a6"><span class="cl-64ec6770">std.error</span></p></th><th class="cl-64fa4912"><p class="cl-64f9c4a6"><span class="cl-64ec6770">statistic</span></p></th><th class="cl-64fa48f4"><p class="cl-64f9c46a"><span class="cl-64ec6770">p.value</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-64fa491c"><p class="cl-64f9c46a"><span class="cl-64ec6770">(Intercept)</span></p></td><td class="cl-64fa4926"><p class="cl-64f9c4a6"><span class="cl-64ec6770">-0.052</span></p></td><td class="cl-64fa4926"><p class="cl-64f9c4a6"><span class="cl-64ec6770">0.062</span></p></td><td class="cl-64fa4926"><p class="cl-64f9c4a6"><span class="cl-64ec6770">-0.832</span></p></td><td class="cl-64fa491c"><p class="cl-64f9c46a"><span class="cl-64ec6770">0.4097</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-64fa491c"><p class="cl-64f9c46a"><span class="cl-64ec6770">pricediff</span></p></td><td class="cl-64fa4926"><p class="cl-64f9c4a6"><span class="cl-64ec6770">-1.202</span></p></td><td class="cl-64fa4926"><p class="cl-64f9c4a6"><span class="cl-64ec6770">0.197</span></p></td><td class="cl-64fa4926"><p class="cl-64f9c4a6"><span class="cl-64ec6770">-6.105</span></p></td><td class="cl-64fa491c"><p class="cl-64f9c46a"><span class="cl-64ec6770">&lt;0.0001</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-64fa4930"><p class="cl-64f9c46a"><span class="cl-64ec6770">incomediff</span></p></td><td class="cl-64fa493a"><p class="cl-64f9c4a6"><span class="cl-64ec6770">0.462</span></p></td><td class="cl-64fa493a"><p class="cl-64f9c4a6"><span class="cl-64ec6770">0.309</span></p></td><td class="cl-64fa493a"><p class="cl-64f9c4a6"><span class="cl-64ec6770">1.494</span></p></td><td class="cl-64fa4930"><p class="cl-64f9c46a"><span class="cl-64ec6770">0.1423</span></p></td></tr></tbody></table></div>
</div>
</div>
</figure>
</div>
</div>
<p>Cigarette-specific tax as IV</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(cig_ivreg_diff2, <span class="at">vcov. =</span> vcovHC, <span class="at">type =</span> <span class="st">"HC1"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render_summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-cigtx" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-cigtx-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Cigarette-specific tax as IV
</figcaption>
<div aria-describedby="tbl-cigtx-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="tabwid"><style>.cl-6573442a{}.cl-65507d14{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-655f7760{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-655f7792{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-65600af4{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-65600b26{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-65600b3a{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-65600b44{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-65600b58{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-65600b62{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-6573442a"><thead><tr style="overflow-wrap:break-word;"><th class="cl-65600af4"><p class="cl-655f7760"><span class="cl-65507d14">term</span></p></th><th class="cl-65600b26"><p class="cl-655f7792"><span class="cl-65507d14">estimate</span></p></th><th class="cl-65600b26"><p class="cl-655f7792"><span class="cl-65507d14">std.error</span></p></th><th class="cl-65600b26"><p class="cl-655f7792"><span class="cl-65507d14">statistic</span></p></th><th class="cl-65600af4"><p class="cl-655f7760"><span class="cl-65507d14">p.value</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-65600b3a"><p class="cl-655f7760"><span class="cl-65507d14">(Intercept)</span></p></td><td class="cl-65600b44"><p class="cl-655f7792"><span class="cl-65507d14">-0.017</span></p></td><td class="cl-65600b44"><p class="cl-655f7792"><span class="cl-65507d14">0.067</span></p></td><td class="cl-65600b44"><p class="cl-655f7792"><span class="cl-65507d14">-0.254</span></p></td><td class="cl-65600b3a"><p class="cl-655f7760"><span class="cl-65507d14">0.8009</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-65600b3a"><p class="cl-655f7760"><span class="cl-65507d14">pricediff</span></p></td><td class="cl-65600b44"><p class="cl-655f7792"><span class="cl-65507d14">-1.343</span></p></td><td class="cl-65600b44"><p class="cl-655f7792"><span class="cl-65507d14">0.229</span></p></td><td class="cl-65600b44"><p class="cl-655f7792"><span class="cl-65507d14">-5.871</span></p></td><td class="cl-65600b3a"><p class="cl-655f7760"><span class="cl-65507d14">&lt;0.0001</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-65600b58"><p class="cl-655f7760"><span class="cl-65507d14">incomediff</span></p></td><td class="cl-65600b62"><p class="cl-655f7792"><span class="cl-65507d14">0.428</span></p></td><td class="cl-65600b62"><p class="cl-655f7792"><span class="cl-65507d14">0.299</span></p></td><td class="cl-65600b62"><p class="cl-655f7792"><span class="cl-65507d14">1.433</span></p></td><td class="cl-65600b58"><p class="cl-655f7760"><span class="cl-65507d14">0.1587</span></p></td></tr></tbody></table></div>
</div>
</div>
</figure>
</div>
</div>
<p>Both sales tax and cigarette-specific tax as IV</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(cig_ivreg_diff3, <span class="at">vcov. =</span> vcovHC, <span class="at">type =</span> <span class="st">"HC1"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">render_summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-both" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-both-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3: Both sales tax and cigarette-specific tax as IV
</figcaption>
<div aria-describedby="tbl-both-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="tabwid"><style>.cl-65d0b9e8{}.cl-65aff3e8{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-65bf1e54{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-65bf1e86{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-65bfbdfa{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-65bfbe22{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-65bfbe23{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-65bfbe36{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-65bfbe40{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-65bfbe54{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-65d0b9e8"><thead><tr style="overflow-wrap:break-word;"><th class="cl-65bfbdfa"><p class="cl-65bf1e54"><span class="cl-65aff3e8">term</span></p></th><th class="cl-65bfbe22"><p class="cl-65bf1e86"><span class="cl-65aff3e8">estimate</span></p></th><th class="cl-65bfbe22"><p class="cl-65bf1e86"><span class="cl-65aff3e8">std.error</span></p></th><th class="cl-65bfbe22"><p class="cl-65bf1e86"><span class="cl-65aff3e8">statistic</span></p></th><th class="cl-65bfbdfa"><p class="cl-65bf1e54"><span class="cl-65aff3e8">p.value</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-65bfbe23"><p class="cl-65bf1e54"><span class="cl-65aff3e8">(Intercept)</span></p></td><td class="cl-65bfbe36"><p class="cl-65bf1e86"><span class="cl-65aff3e8">-0.052</span></p></td><td class="cl-65bfbe36"><p class="cl-65bf1e86"><span class="cl-65aff3e8">0.062</span></p></td><td class="cl-65bfbe36"><p class="cl-65bf1e86"><span class="cl-65aff3e8">-0.832</span></p></td><td class="cl-65bfbe23"><p class="cl-65bf1e54"><span class="cl-65aff3e8">0.4097</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-65bfbe23"><p class="cl-65bf1e54"><span class="cl-65aff3e8">pricediff</span></p></td><td class="cl-65bfbe36"><p class="cl-65bf1e86"><span class="cl-65aff3e8">-1.202</span></p></td><td class="cl-65bfbe36"><p class="cl-65bf1e86"><span class="cl-65aff3e8">0.197</span></p></td><td class="cl-65bfbe36"><p class="cl-65bf1e86"><span class="cl-65aff3e8">-6.105</span></p></td><td class="cl-65bfbe23"><p class="cl-65bf1e54"><span class="cl-65aff3e8">&lt;0.0001</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-65bfbe40"><p class="cl-65bf1e54"><span class="cl-65aff3e8">incomediff</span></p></td><td class="cl-65bfbe54"><p class="cl-65bf1e86"><span class="cl-65aff3e8">0.462</span></p></td><td class="cl-65bfbe54"><p class="cl-65bf1e86"><span class="cl-65aff3e8">0.309</span></p></td><td class="cl-65bfbe54"><p class="cl-65bf1e86"><span class="cl-65aff3e8">1.494</span></p></td><td class="cl-65bfbe40"><p class="cl-65bf1e54"><span class="cl-65aff3e8">0.1423</span></p></td></tr></tbody></table></div>
</div>
</div>
</figure>
</div>
</div>
<p>A tabulated summary</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Define the models in a named list (this replaces column.labels)</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>models <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"IV: salestax"</span> <span class="ot">=</span> cig_ivreg_diff1,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"IV: cigtax"</span>   <span class="ot">=</span> cig_ivreg_diff2,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"IVs: salestax, cigtax"</span> <span class="ot">=</span> cig_ivreg_diff3</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Define which Goodness-of-Fit stats to show and what to call them</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>gm <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"raw"</span> <span class="ot">=</span> <span class="st">"nobs"</span>, <span class="st">"clean"</span> <span class="ot">=</span> <span class="st">"Observations"</span>, <span class="st">"fmt"</span> <span class="ot">=</span> <span class="dv">0</span>),</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"raw"</span> <span class="ot">=</span> <span class="st">"r.squared"</span>, <span class="st">"clean"</span> <span class="ot">=</span> <span class="st">"R2"</span>, <span class="st">"fmt"</span> <span class="ot">=</span> <span class="dv">3</span>),</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"raw"</span> <span class="ot">=</span> <span class="st">"adj.r.squared"</span>, <span class="st">"clean"</span> <span class="ot">=</span> <span class="st">"Adj. R2"</span>, <span class="st">"fmt"</span> <span class="ot">=</span> <span class="dv">3</span>)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Define standard errors</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: modelsummary can calculate HC1 automatically, </span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="co"># but since you already have 'rob_se', we can pass it directly.</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>rob_se_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sqrt</span>(<span class="fu">diag</span>(<span class="fu">vcovHC</span>(cig_ivreg_diff1, <span class="at">type =</span> <span class="st">"HC1"</span>))),</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sqrt</span>(<span class="fu">diag</span>(<span class="fu">vcovHC</span>(cig_ivreg_diff2, <span class="at">type =</span> <span class="st">"HC1"</span>))),</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sqrt</span>(<span class="fu">diag</span>(<span class="fu">vcovHC</span>(cig_ivreg_diff3, <span class="at">type =</span> <span class="st">"HC1"</span>)))</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Generate the table</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>  models,</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">vcov =</span> rob_se_list,        <span class="co"># Applies your robust SEs</span></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">output =</span> <span class="st">"flextable"</span>,      <span class="co"># Outputs as a flextable object</span></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">fmt =</span> <span class="dv">3</span>,                   <span class="co"># 3 decimal places</span></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">stars =</span> <span class="cn">TRUE</span>,              <span class="co"># Significance stars (optional)</span></span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_map =</span> gm <span class="co"># Clean up GOF statistics</span></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autofit</span>() <span class="sc">|&gt;</span> </span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_vanilla</span>()   <span class="sc">%&gt;%</span>         <span class="co"># Clean academic style</span></span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a><span class="co"># This command removes any remaining horizontal lines inside the body</span></span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">border_inner_h</span>(<span class="at">part =</span> <span class="st">"body"</span>, <span class="at">border =</span> officer<span class="sc">::</span><span class="fu">fp_border</span>(<span class="at">width =</span> <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-iv-comparison" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-iv-comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4: Dependent Variable: 1985-1995 Difference in Log per Pack Price
</figcaption>
<div aria-describedby="tbl-iv-comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="tabwid"><style>.cl-682cc880{}.cl-680d89b6{font-family:'DejaVu Sans';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-680d89e8{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-681ae4a8{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-681b794a{width:1.295in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7972{width:1.168in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b797c{width:1.007in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7986{width:1.812in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7990{width:1.295in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b79a4{width:1.168in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b79ae{width:1.007in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b79b8{width:1.812in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b79c2{width:1.295in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b79cc{width:1.168in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b79d6{width:1.007in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b79e0{width:1.812in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b79ea{width:1.295in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b79f4{width:1.168in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b79fe{width:1.007in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7a08{width:1.812in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7a1c{width:1.295in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7a30{width:1.168in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7a3a{width:1.007in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7a44{width:1.812in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7a58{width:1.295in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7a62{width:1.168in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7a6c{width:1.007in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7a76{width:1.812in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7a80{width:1.295in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7a81{width:1.168in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7a8a{width:1.007in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7a9e{width:1.812in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7aa8{width:1.295in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7ab2{width:1.168in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7abc{width:1.007in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7ad0{width:1.812in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-682cc880"><thead><tr style="overflow-wrap:break-word;"><th class="cl-681b794a"><p class="cl-681ae4a8"><span class="cl-680d89b6"> </span></p></th><th class="cl-681b7972"><p class="cl-681ae4a8"><span class="cl-680d89b6">IV: salestax</span></p></th><th class="cl-681b797c"><p class="cl-681ae4a8"><span class="cl-680d89b6">IV: cigtax</span></p></th><th class="cl-681b7986"><p class="cl-681ae4a8"><span class="cl-680d89b6">IVs: salestax, cigtax</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-681b7990"><p class="cl-681ae4a8"><span class="cl-680d89e8">(Intercept)</span></p></td><td class="cl-681b79a4"><p class="cl-681ae4a8"><span class="cl-680d89e8">-0.052</span></p></td><td class="cl-681b79ae"><p class="cl-681ae4a8"><span class="cl-680d89e8">-0.017</span></p></td><td class="cl-681b79b8"><p class="cl-681ae4a8"><span class="cl-680d89e8">-0.052</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-681b79c2"><p class="cl-681ae4a8"><span class="cl-680d89e8"></span></p></td><td class="cl-681b79cc"><p class="cl-681ae4a8"><span class="cl-680d89e8">(0.062)</span></p></td><td class="cl-681b79d6"><p class="cl-681ae4a8"><span class="cl-680d89e8">(0.067)</span></p></td><td class="cl-681b79e0"><p class="cl-681ae4a8"><span class="cl-680d89e8">(0.062)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-681b79ea"><p class="cl-681ae4a8"><span class="cl-680d89e8">pricediff</span></p></td><td class="cl-681b79f4"><p class="cl-681ae4a8"><span class="cl-680d89e8">-1.202***</span></p></td><td class="cl-681b79fe"><p class="cl-681ae4a8"><span class="cl-680d89e8">-1.343***</span></p></td><td class="cl-681b7a08"><p class="cl-681ae4a8"><span class="cl-680d89e8">-1.202***</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-681b79c2"><p class="cl-681ae4a8"><span class="cl-680d89e8"></span></p></td><td class="cl-681b79cc"><p class="cl-681ae4a8"><span class="cl-680d89e8">(0.197)</span></p></td><td class="cl-681b79d6"><p class="cl-681ae4a8"><span class="cl-680d89e8">(0.229)</span></p></td><td class="cl-681b79e0"><p class="cl-681ae4a8"><span class="cl-680d89e8">(0.197)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-681b7a1c"><p class="cl-681ae4a8"><span class="cl-680d89e8">incomediff</span></p></td><td class="cl-681b7a30"><p class="cl-681ae4a8"><span class="cl-680d89e8">0.462</span></p></td><td class="cl-681b7a3a"><p class="cl-681ae4a8"><span class="cl-680d89e8">0.428</span></p></td><td class="cl-681b7a44"><p class="cl-681ae4a8"><span class="cl-680d89e8">0.462</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-681b79c2"><p class="cl-681ae4a8"><span class="cl-680d89e8"></span></p></td><td class="cl-681b79cc"><p class="cl-681ae4a8"><span class="cl-680d89e8">(0.309)</span></p></td><td class="cl-681b79d6"><p class="cl-681ae4a8"><span class="cl-680d89e8">(0.299)</span></p></td><td class="cl-681b79e0"><p class="cl-681ae4a8"><span class="cl-680d89e8">(0.309)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-681b7a1c"><p class="cl-681ae4a8"><span class="cl-680d89e8">Observations</span></p></td><td class="cl-681b7a30"><p class="cl-681ae4a8"><span class="cl-680d89e8">48</span></p></td><td class="cl-681b7a3a"><p class="cl-681ae4a8"><span class="cl-680d89e8">48</span></p></td><td class="cl-681b7a44"><p class="cl-681ae4a8"><span class="cl-680d89e8">48</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-681b7a58"><p class="cl-681ae4a8"><span class="cl-680d89e8">R2</span></p></td><td class="cl-681b7a62"><p class="cl-681ae4a8"><span class="cl-680d89e8">0.547</span></p></td><td class="cl-681b7a6c"><p class="cl-681ae4a8"><span class="cl-680d89e8">0.520</span></p></td><td class="cl-681b7a76"><p class="cl-681ae4a8"><span class="cl-680d89e8">0.547</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-681b7a80"><p class="cl-681ae4a8"><span class="cl-680d89e8">Adj. R2</span></p></td><td class="cl-681b7a81"><p class="cl-681ae4a8"><span class="cl-680d89e8">0.526</span></p></td><td class="cl-681b7a8a"><p class="cl-681ae4a8"><span class="cl-680d89e8">0.498</span></p></td><td class="cl-681b7a9e"><p class="cl-681ae4a8"><span class="cl-680d89e8">0.526</span></p></td></tr></tbody><tfoot><tr style="overflow-wrap:break-word;"><td colspan="4" class="cl-681b7aa8"><p class="cl-681ae4a8"><span class="cl-680d89e8">+ p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001</span></p></td></tr></tfoot></table></div>
</div>
</div>
</figure>
</div>
</div>
<p>We observe negative estimates for <code>pricediff</code> that differ when <code>cigtax</code> is used as IV. We proceed to test the validity of the instruments by computing F-statistics for the first-stage regressions.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># first-stage regressions</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>mod_relevance1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(pricediff <span class="sc">~</span> salestaxdiff <span class="sc">+</span> incomediff)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>mod_relevance2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(pricediff <span class="sc">~</span> cigtaxdiff <span class="sc">+</span> incomediff)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>mod_relevance3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(pricediff <span class="sc">~</span> incomediff <span class="sc">+</span> salestaxdiff <span class="sc">+</span> cigtaxdiff)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># check instrument relevance</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>mods <span class="ot">&lt;-</span> <span class="fu">list</span>(mod_relevance1, mod_relevance2, mod_relevance3)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(mods) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"salestax"</span>, <span class="st">"cigartax"</span>, <span class="st">"both"</span>)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>hyp <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"salestaxdiff = 0"</span>, <span class="st">"cigtaxdiff = 0"</span>, <span class="fu">c</span>(<span class="st">"salestaxdiff = 0"</span>, <span class="st">"cigtaxdiff = 0"</span>))</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>iv_tests <span class="ot">&lt;-</span> <span class="fu">map2</span>(</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  mods, hyp, \(m, h){</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">linearHypothesis</span>(m, h, <span class="at">vcov. =</span> <span class="fu">vcovHC</span>(m, <span class="at">type =</span> <span class="st">"HC1"</span>))</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a> iv_tests <span class="sc">|&gt;</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(broom<span class="sc">::</span>tidy, <span class="at">.id =</span> <span class="st">"model"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">p.value =</span> prettyunits<span class="sc">::</span><span class="fu">pretty_p_value</span>(p.value)) <span class="sc">%&gt;%</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>     <span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span> <span class="fu">round</span>(., <span class="dv">3</span>))</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>   ) <span class="sc">%&gt;%</span> </span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>   <span class="fu">flextable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-ivrel" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-ivrel-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;5: Test IV relevance by an F-test. All the F-statistics are significantly different from zero
</figcaption>
<div aria-describedby="tbl-ivrel-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="tabwid"><style>.cl-68a49360{}.cl-68922680{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-6899112a{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-68991148{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-68995a86{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-68995a9a{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-68995aa4{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-68995aae{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-68995aaf{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-68995ac2{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-68a49360"><thead><tr style="overflow-wrap:break-word;"><th class="cl-68995a86"><p class="cl-6899112a"><span class="cl-68922680">model</span></p></th><th class="cl-68995a86"><p class="cl-6899112a"><span class="cl-68922680">term</span></p></th><th class="cl-68995a9a"><p class="cl-68991148"><span class="cl-68922680">null.value</span></p></th><th class="cl-68995a9a"><p class="cl-68991148"><span class="cl-68922680">estimate</span></p></th><th class="cl-68995a9a"><p class="cl-68991148"><span class="cl-68922680">std.error</span></p></th><th class="cl-68995a9a"><p class="cl-68991148"><span class="cl-68922680">statistic</span></p></th><th class="cl-68995a86"><p class="cl-6899112a"><span class="cl-68922680">p.value</span></p></th><th class="cl-68995a9a"><p class="cl-68991148"><span class="cl-68922680">df.residual</span></p></th><th class="cl-68995a9a"><p class="cl-68991148"><span class="cl-68922680">df</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-68995aa4"><p class="cl-6899112a"><span class="cl-68922680">salestax</span></p></td><td class="cl-68995aa4"><p class="cl-6899112a"><span class="cl-68922680">salestaxdiff</span></p></td><td class="cl-68995aae"><p class="cl-68991148"><span class="cl-68922680">0</span></p></td><td class="cl-68995aae"><p class="cl-68991148"><span class="cl-68922680">0.025</span></p></td><td class="cl-68995aae"><p class="cl-68991148"><span class="cl-68922680">0.004</span></p></td><td class="cl-68995aae"><p class="cl-68991148"><span class="cl-68922680">33.674</span></p></td><td class="cl-68995aa4"><p class="cl-6899112a"><span class="cl-68922680">&lt;0.0001</span></p></td><td class="cl-68995aae"><p class="cl-68991148"><span class="cl-68922680">45</span></p></td><td class="cl-68995aae"><p class="cl-68991148"><span class="cl-68922680">1</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-68995aa4"><p class="cl-6899112a"><span class="cl-68922680">cigartax</span></p></td><td class="cl-68995aa4"><p class="cl-6899112a"><span class="cl-68922680">cigtaxdiff</span></p></td><td class="cl-68995aae"><p class="cl-68991148"><span class="cl-68922680">0</span></p></td><td class="cl-68995aae"><p class="cl-68991148"><span class="cl-68922680">0.010</span></p></td><td class="cl-68995aae"><p class="cl-68991148"><span class="cl-68922680">0.001</span></p></td><td class="cl-68995aae"><p class="cl-68991148"><span class="cl-68922680">107.183</span></p></td><td class="cl-68995aa4"><p class="cl-6899112a"><span class="cl-68922680">&lt;0.0001</span></p></td><td class="cl-68995aae"><p class="cl-68991148"><span class="cl-68922680">45</span></p></td><td class="cl-68995aae"><p class="cl-68991148"><span class="cl-68922680">1</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-68995aa4"><p class="cl-6899112a"><span class="cl-68922680">both</span></p></td><td class="cl-68995aa4"><p class="cl-6899112a"><span class="cl-68922680">salestaxdiff</span></p></td><td class="cl-68995aae"><p class="cl-68991148"><span class="cl-68922680">0</span></p></td><td class="cl-68995aae"><p class="cl-68991148"><span class="cl-68922680">0.013</span></p></td><td class="cl-68995aae"><p class="cl-68991148"><span class="cl-68922680">0.003</span></p></td><td class="cl-68995aae"><p class="cl-68991148"><span class="cl-68922680">88.616</span></p></td><td class="cl-68995aa4"><p class="cl-6899112a"><span class="cl-68922680">&lt;0.0001</span></p></td><td class="cl-68995aae"><p class="cl-68991148"><span class="cl-68922680">44</span></p></td><td class="cl-68995aae"><p class="cl-68991148"><span class="cl-68922680">2</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-68995aaf"><p class="cl-6899112a"><span class="cl-68922680">both</span></p></td><td class="cl-68995aaf"><p class="cl-6899112a"><span class="cl-68922680">cigtaxdiff</span></p></td><td class="cl-68995ac2"><p class="cl-68991148"><span class="cl-68922680">0</span></p></td><td class="cl-68995ac2"><p class="cl-68991148"><span class="cl-68922680">0.008</span></p></td><td class="cl-68995ac2"><p class="cl-68991148"><span class="cl-68922680">0.001</span></p></td><td class="cl-68995ac2"><p class="cl-68991148"><span class="cl-68922680">88.616</span></p></td><td class="cl-68995aaf"><p class="cl-6899112a"><span class="cl-68922680">&lt;0.0001</span></p></td><td class="cl-68995ac2"><p class="cl-68991148"><span class="cl-68922680">44</span></p></td><td class="cl-68995ac2"><p class="cl-68991148"><span class="cl-68922680">2</span></p></td></tr></tbody></table></div>
</div>
</div>
</figure>
</div>
</div>
<p>Next we conduct overidentifying restriction test for model with both sales tax and cigatax as IV which is the only model where the coefficient on the difference in log prices is overidentified (<span class="math inline">\(m = 2, k=1\)</span>) making it possible to compute the <span class="math inline">\(J\)</span> statistic. To achive this, we regress the residuals from <code>cig_ivreg_diff3</code> on the IVs and the presumed exogenous regressor <code>incomediff</code>. We again test if the coefficients of the IV variables is zero, a condition necessary for exogenous variables.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute the J-statistic</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>cig_iv_OR <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">residuals</span>(cig_ivreg_diff3) <span class="sc">~</span> incomediff <span class="sc">+</span> salestaxdiff <span class="sc">+</span> cigtaxdiff)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>cig_OR_test <span class="ot">&lt;-</span> <span class="fu">linearHypothesis</span>(cig_iv_OR, </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">c</span>(<span class="st">"salestaxdiff = 0"</span>, <span class="st">"cigtaxdiff = 0"</span>), </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>                               <span class="at">test =</span> <span class="st">"Chisq"</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>cig_OR_test <span class="sc">%&gt;%</span> <span class="fu">render_summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-jtest" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-jtest-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;6: J-test statitic testing for exogeneity condition of IVs
</figcaption>
<div aria-describedby="tbl-jtest-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="tabwid"><style>.cl-6924cabc{}.cl-6908801e{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-69134dd2{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-69134df0{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-6913ba88{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6913baa6{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6913bab0{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6913baba{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6913bac4{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6913bad8{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-6924cabc"><thead><tr style="overflow-wrap:break-word;"><th class="cl-6913ba88"><p class="cl-69134dd2"><span class="cl-6908801e">term</span></p></th><th class="cl-6913baa6"><p class="cl-69134df0"><span class="cl-6908801e">null.value</span></p></th><th class="cl-6913baa6"><p class="cl-69134df0"><span class="cl-6908801e">estimate</span></p></th><th class="cl-6913baa6"><p class="cl-69134df0"><span class="cl-6908801e">std.error</span></p></th><th class="cl-6913baa6"><p class="cl-69134df0"><span class="cl-6908801e">statistic</span></p></th><th class="cl-6913ba88"><p class="cl-69134dd2"><span class="cl-6908801e">p.value</span></p></th><th class="cl-6913baa6"><p class="cl-69134df0"><span class="cl-6908801e">df.residual</span></p></th><th class="cl-6913baa6"><p class="cl-69134df0"><span class="cl-6908801e">rss</span></p></th><th class="cl-6913baa6"><p class="cl-69134df0"><span class="cl-6908801e">df</span></p></th><th class="cl-6913baa6"><p class="cl-69134df0"><span class="cl-6908801e">sumsq</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-6913bab0"><p class="cl-69134dd2"><span class="cl-6908801e">salestaxdiff</span></p></td><td class="cl-6913baba"><p class="cl-69134df0"><span class="cl-6908801e">0</span></p></td><td class="cl-6913baba"><p class="cl-69134df0"><span class="cl-6908801e">0.013</span></p></td><td class="cl-6913baba"><p class="cl-69134df0"><span class="cl-6908801e">0.006</span></p></td><td class="cl-6913baba"><p class="cl-69134df0"><span class="cl-6908801e">4.932</span></p></td><td class="cl-6913bab0"><p class="cl-69134dd2"><span class="cl-6908801e">0.0849</span></p></td><td class="cl-6913baba"><p class="cl-69134df0"><span class="cl-6908801e">44</span></p></td><td class="cl-6913baba"><p class="cl-69134df0"><span class="cl-6908801e">0.337</span></p></td><td class="cl-6913baba"><p class="cl-69134df0"><span class="cl-6908801e">2</span></p></td><td class="cl-6913baba"><p class="cl-69134df0"><span class="cl-6908801e">0.038</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-6913bac4"><p class="cl-69134dd2"><span class="cl-6908801e">cigtaxdiff</span></p></td><td class="cl-6913bad8"><p class="cl-69134df0"><span class="cl-6908801e">0</span></p></td><td class="cl-6913bad8"><p class="cl-69134df0"><span class="cl-6908801e">-0.004</span></p></td><td class="cl-6913bad8"><p class="cl-69134df0"><span class="cl-6908801e">0.002</span></p></td><td class="cl-6913bad8"><p class="cl-69134df0"><span class="cl-6908801e">4.932</span></p></td><td class="cl-6913bac4"><p class="cl-69134dd2"><span class="cl-6908801e">0.0849</span></p></td><td class="cl-6913bad8"><p class="cl-69134df0"><span class="cl-6908801e">44</span></p></td><td class="cl-6913bad8"><p class="cl-69134df0"><span class="cl-6908801e">0.337</span></p></td><td class="cl-6913bad8"><p class="cl-69134df0"><span class="cl-6908801e">2</span></p></td><td class="cl-6913bad8"><p class="cl-69134df0"><span class="cl-6908801e">0.038</span></p></td></tr></tbody></table></div>
</div>
</div>
</figure>
</div>
</div>
<p><strong>Note</strong>: The reported degrees of freedom is wrong, (2 instead of <span class="math inline">\(m-k = 2-1=1\)</span>). The J-statistic is <span class="math inline">\(\chi^2_1\)</span> instead of <span class="math inline">\(\chi^2_2\)</span> as reported by the model. We calculate the correct p-value:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pchisq</span>(cig_OR_test[<span class="dv">2</span>, <span class="dv">5</span>], <span class="at">df =</span> <span class="dv">1</span>, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.02636406</code></pre>
</div>
</div>
<p>We reject the hypothesis that both instruments are exogenous at <span class="math inline">\(\alpha = 0.05\)</span> and conclude that</p>
<ol type="1">
<li>sales tax is an invalid instrument for the per-pack price,</li>
<li>and so is the cigarette-specific tax,</li>
<li>and that both instruments are invalid.</li>
</ol>
</section>
</section>
</section>
<section id="experiments-and-quasi-experiments" class="level1">
<h1>Experiments and Quasi-experiments</h1>
<p>Experiments give us the tools to conduct program evaluation interest being to measure causal effects of programs. The gold-standard for this kind of work is a randomized controlled experiment. In a quasi-experiment there are no randomized assignments to interventions, we study the processes in their natural setting.</p>
<section id="potential-outcomes-causal-effects-and-idealized-experiments" class="level2">
<h2 class="anchored" data-anchor-id="potential-outcomes-causal-effects-and-idealized-experiments">Potential outcomes, causal effects and idealized experiments</h2>
<p>Interest is in the <strong>average causal effect</strong> estimated by the <strong>difference estimator</strong>. A potential outcome is the outcome for an individual under a potential treatment. For this individual the causal effect of the treatment is the difference between the potential outcome if the individual receives the treatment and the potential outcome if they do not. We are interested in studying the <strong>average causal effect</strong> since this difference may vary from individual to individual. In a randomized controlled experiment, it is expected that 1. Subjects are randomly selected from the population(ensures average causal effect in sample equals average causal effect in population), 2. Subjects are randomly assigned to treatment and control group (ensures receiving a treatment is independent of a subjects potential outcome).</p>
<p>If above conditions are met, then the average causal effect is the expected outcome in treatment group less expected outcome in the control:</p>
<p><span class="math display">\[
\text{Average causal effect}  = E(Y_i|X_i = 1) - E(Y_i|X_i = 0)
\]</span></p>
<p>where <span class="math inline">\(X_i\)</span> is a binary treatment indicator. Estimation follows <strong>differences estimator</strong> which is an OLS regression model</p>
<p><span id="eq-ae"><span class="math display">\[
\begin{equation}
Y_i = \beta_0 + \beta_1X_i + \epsilon_i, i = 1, \dots, n
\end{equation}
\tag{12}\]</span></span></p>
<p>where random assignment ensures <span class="math inline">\(E(\epsilon_i|X_i) = 0\)</span>. The difference estimator in (<a href="#eq-ae" class="quarto-xref">Equation&nbsp;12</a>) can take additional regressors <span class="math inline">\(W_1, \dots, W_r\)</span> and is called a <strong>differences estimator with additional regressors</strong>:</p>
<p><span id="eq-ae-dear"><span class="math display">\[
\begin{equation}
Y_i = \beta_0 + \beta_1X_i + \beta_2W_{1i} + \dots + \beta_{1+r}W_{ri} +
\epsilon_i, i = 1, \dots, n
\end{equation}
\tag{13}\]</span></span></p>
<p>It utilizes a <strong>conditional mean independence</strong> assumption that states that treatment assignment <span class="math inline">\(X_i\)</span> is random and independent of any pretreatment variable <span class="math inline">\(W_i\)</span>. This ensures that</p>
<p><span class="math display">\[
\begin{equation}
E(\epsilon_i|X_i, W_i) = E(\epsilon_i|W_i) = 0
\end{equation}
\]</span></p>
<p>implying that the conditional expectation of the error term <span class="math inline">\(\epsilon_i\)</span>, given the treatment indicator <span class="math inline">\(X_i\)</span> and the the pretreatment characteristic <span class="math inline">\(W_i\)</span> does not depend on <span class="math inline">\(X_i\)</span>.</p>
<p>### Analysis of experimental data</p>
<p><code>STAR</code> data set from <code>{AER}</code> is a large student-teacher achievement ratio randomized controlled experiment that was assessing whether class size reduction is effective in improving education outcomes. 6400 students were randomly assigned into one of the three interventions: small class (13 to 17 students per teacher), regular class (22 to 25 students per teacher), and regular-with-aide class (22 to 25 students with a full-time teachers aide). Teachers were also randomly assigned to classes. The subjects were followed from kindergarten to grade 3 (K,1, 2, 3 suffixes in variable names).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"STAR"</span>, <span class="at">package =</span> <span class="st">"AER"</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>skimr<span class="sc">::</span><span class="fu">skim</span>(STAR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Couldn't find skimmers for class: yearqtr; No user-defined `sfl`
provided. Falling back to `character`.</code></pre>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">STAR</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">11598</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">47</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">character</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">factor</td>
<td style="text-align: left;">34</td>
</tr>
<tr class="even">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">12</td>
</tr>
<tr class="odd">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 19%">
<col style="width: 13%">
<col style="width: 19%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">max</th>
<th style="text-align: right;">empty</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: right;">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">birth</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 14%">
<col style="width: 10%">
<col style="width: 14%">
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 43%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: left;">ordered</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: left;">top_counts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">gender</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">mal: 6122, fem: 5456</td>
</tr>
<tr class="even">
<td style="text-align: left;">ethnicity</td>
<td style="text-align: right;">145</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">cau: 7193, afa: 4173, asi: 32, his: 21</td>
</tr>
<tr class="odd">
<td style="text-align: left;">stark</td>
<td style="text-align: right;">5273</td>
<td style="text-align: right;">0.55</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">reg: 2231, reg: 2194, sma: 1900</td>
</tr>
<tr class="even">
<td style="text-align: left;">star1</td>
<td style="text-align: right;">4769</td>
<td style="text-align: right;">0.59</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">reg: 2584, reg: 2320, sma: 1925</td>
</tr>
<tr class="odd">
<td style="text-align: left;">star2</td>
<td style="text-align: right;">4758</td>
<td style="text-align: right;">0.59</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">reg: 2495, reg: 2329, sma: 2016</td>
</tr>
<tr class="even">
<td style="text-align: left;">star3</td>
<td style="text-align: right;">4796</td>
<td style="text-align: right;">0.59</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">reg: 2543, sma: 2174, reg: 2085</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lunchk</td>
<td style="text-align: right;">5296</td>
<td style="text-align: right;">0.54</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">non: 3250, fre: 3052</td>
</tr>
<tr class="even">
<td style="text-align: left;">lunch1</td>
<td style="text-align: right;">4947</td>
<td style="text-align: right;">0.57</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">fre: 3430, non: 3221</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lunch2</td>
<td style="text-align: right;">5102</td>
<td style="text-align: right;">0.56</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">fre: 3336, non: 3160</td>
</tr>
<tr class="even">
<td style="text-align: left;">lunch3</td>
<td style="text-align: right;">5078</td>
<td style="text-align: right;">0.56</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">fre: 3293, non: 3227</td>
</tr>
<tr class="odd">
<td style="text-align: left;">schoolk</td>
<td style="text-align: right;">5273</td>
<td style="text-align: right;">0.55</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">rur: 2917, inn: 1428, sub: 1412, urb: 568</td>
</tr>
<tr class="even">
<td style="text-align: left;">school1</td>
<td style="text-align: right;">4769</td>
<td style="text-align: right;">0.59</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">rur: 3237, sub: 1586, inn: 1380, urb: 626</td>
</tr>
<tr class="odd">
<td style="text-align: left;">school2</td>
<td style="text-align: right;">4758</td>
<td style="text-align: right;">0.59</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">rur: 3167, sub: 1710, inn: 1481, urb: 482</td>
</tr>
<tr class="even">
<td style="text-align: left;">school3</td>
<td style="text-align: right;">4796</td>
<td style="text-align: right;">0.59</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">rur: 3240, sub: 1720, inn: 1335, urb: 507</td>
</tr>
<tr class="odd">
<td style="text-align: left;">degreek</td>
<td style="text-align: right;">5294</td>
<td style="text-align: right;">0.54</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">bac: 4119, mas: 1981, mas: 161, spe: 43</td>
</tr>
<tr class="even">
<td style="text-align: left;">degree1</td>
<td style="text-align: right;">4788</td>
<td style="text-align: right;">0.59</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">bac: 4456, mas: 2294, spe: 38, phd: 22</td>
</tr>
<tr class="odd">
<td style="text-align: left;">degree2</td>
<td style="text-align: right;">4819</td>
<td style="text-align: right;">0.58</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">bac: 4249, mas: 2427, spe: 67, phd: 36</td>
</tr>
<tr class="even">
<td style="text-align: left;">degree3</td>
<td style="text-align: right;">4862</td>
<td style="text-align: right;">0.58</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">bac: 3762, mas: 2885, spe: 89, phd: 0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ladderk</td>
<td style="text-align: right;">5869</td>
<td style="text-align: right;">0.49</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">lev: 4671, app: 514, pro: 334, lev: 119</td>
</tr>
<tr class="even">
<td style="text-align: left;">ladder1</td>
<td style="text-align: right;">4811</td>
<td style="text-align: right;">0.59</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">lev: 4492, app: 718, pro: 666, not: 506</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ladder2</td>
<td style="text-align: right;">4878</td>
<td style="text-align: right;">0.58</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">lev: 4703, not: 754, app: 482, pro: 411</td>
</tr>
<tr class="even">
<td style="text-align: left;">ladder3</td>
<td style="text-align: right;">4847</td>
<td style="text-align: right;">0.58</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">lev: 4437, pro: 550, not: 497, lev: 484</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tethnicityk</td>
<td style="text-align: right;">5335</td>
<td style="text-align: right;">0.54</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">cau: 5232, afa: 1031</td>
</tr>
<tr class="even">
<td style="text-align: left;">tethnicity1</td>
<td style="text-align: right;">4822</td>
<td style="text-align: right;">0.58</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">cau: 5592, afa: 1184</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tethnicity2</td>
<td style="text-align: right;">4819</td>
<td style="text-align: right;">0.58</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">cau: 5398, afa: 1381</td>
</tr>
<tr class="even">
<td style="text-align: left;">tethnicity3</td>
<td style="text-align: right;">4847</td>
<td style="text-align: right;">0.58</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">cau: 5328, afa: 1409, asi: 14</td>
</tr>
<tr class="odd">
<td style="text-align: left;">systemk</td>
<td style="text-align: right;">5273</td>
<td style="text-align: right;">0.55</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">42</td>
<td style="text-align: left;">11: 1788, 18: 360, 22: 319, 6: 228</td>
</tr>
<tr class="even">
<td style="text-align: left;">system1</td>
<td style="text-align: right;">4769</td>
<td style="text-align: right;">0.59</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">42</td>
<td style="text-align: left;">11: 1757, 22: 508, 18: 269, 12: 240</td>
</tr>
<tr class="odd">
<td style="text-align: left;">system2</td>
<td style="text-align: right;">4758</td>
<td style="text-align: right;">0.59</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">41</td>
<td style="text-align: left;">11: 1908, 22: 495, 18: 312, 12: 263</td>
</tr>
<tr class="even">
<td style="text-align: left;">system3</td>
<td style="text-align: right;">4796</td>
<td style="text-align: right;">0.59</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">41</td>
<td style="text-align: left;">11: 1792, 22: 473, 18: 302, 12: 246</td>
</tr>
<tr class="odd">
<td style="text-align: left;">schoolidk</td>
<td style="text-align: right;">5273</td>
<td style="text-align: right;">0.55</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">79</td>
<td style="text-align: left;">27: 156, 28: 154, 51: 146, 22: 137</td>
</tr>
<tr class="even">
<td style="text-align: left;">schoolid1</td>
<td style="text-align: right;">4769</td>
<td style="text-align: right;">0.59</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">76</td>
<td style="text-align: left;">51: 238, 63: 149, 27: 142, 9: 134</td>
</tr>
<tr class="odd">
<td style="text-align: left;">schoolid2</td>
<td style="text-align: right;">4758</td>
<td style="text-align: right;">0.59</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">75</td>
<td style="text-align: left;">51: 235, 27: 146, 22: 141, 9: 140</td>
</tr>
<tr class="even">
<td style="text-align: left;">schoolid3</td>
<td style="text-align: right;">4796</td>
<td style="text-align: right;">0.59</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">75</td>
<td style="text-align: left;">51: 207, 58: 147, 9: 146, 66: 139</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 17%">
<col style="width: 12%">
<col style="width: 17%">
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 6%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">readk</td>
<td style="text-align: right;">5809</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">436.73</td>
<td style="text-align: right;">31.71</td>
<td style="text-align: right;">315</td>
<td style="text-align: right;">414</td>
<td style="text-align: right;">433</td>
<td style="text-align: right;">453</td>
<td style="text-align: right;">627</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">read1</td>
<td style="text-align: right;">5202</td>
<td style="text-align: right;">0.55</td>
<td style="text-align: right;">520.78</td>
<td style="text-align: right;">55.19</td>
<td style="text-align: right;">404</td>
<td style="text-align: right;">478</td>
<td style="text-align: right;">514</td>
<td style="text-align: right;">558</td>
<td style="text-align: right;">651</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">read2</td>
<td style="text-align: right;">5521</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: right;">583.93</td>
<td style="text-align: right;">46.04</td>
<td style="text-align: right;">468</td>
<td style="text-align: right;">552</td>
<td style="text-align: right;">582</td>
<td style="text-align: right;">614</td>
<td style="text-align: right;">732</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">read3</td>
<td style="text-align: right;">5598</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: right;">615.41</td>
<td style="text-align: right;">38.57</td>
<td style="text-align: right;">499</td>
<td style="text-align: right;">588</td>
<td style="text-align: right;">614</td>
<td style="text-align: right;">641</td>
<td style="text-align: right;">775</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">mathk</td>
<td style="text-align: right;">5727</td>
<td style="text-align: right;">0.51</td>
<td style="text-align: right;">485.38</td>
<td style="text-align: right;">47.70</td>
<td style="text-align: right;">288</td>
<td style="text-align: right;">454</td>
<td style="text-align: right;">484</td>
<td style="text-align: right;">513</td>
<td style="text-align: right;">626</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">math1</td>
<td style="text-align: right;">4998</td>
<td style="text-align: right;">0.57</td>
<td style="text-align: right;">530.53</td>
<td style="text-align: right;">43.10</td>
<td style="text-align: right;">404</td>
<td style="text-align: right;">500</td>
<td style="text-align: right;">529</td>
<td style="text-align: right;">557</td>
<td style="text-align: right;">676</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">math2</td>
<td style="text-align: right;">5533</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: right;">580.61</td>
<td style="text-align: right;">44.57</td>
<td style="text-align: right;">441</td>
<td style="text-align: right;">550</td>
<td style="text-align: right;">579</td>
<td style="text-align: right;">611</td>
<td style="text-align: right;">721</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">math3</td>
<td style="text-align: right;">5521</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: right;">617.97</td>
<td style="text-align: right;">39.84</td>
<td style="text-align: right;">487</td>
<td style="text-align: right;">591</td>
<td style="text-align: right;">616</td>
<td style="text-align: right;">645</td>
<td style="text-align: right;">774</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">experiencek</td>
<td style="text-align: right;">5294</td>
<td style="text-align: right;">0.54</td>
<td style="text-align: right;">9.26</td>
<td style="text-align: right;">5.81</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">27</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">experience1</td>
<td style="text-align: right;">4788</td>
<td style="text-align: right;">0.59</td>
<td style="text-align: right;">11.63</td>
<td style="text-align: right;">8.94</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">42</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">experience2</td>
<td style="text-align: right;">4860</td>
<td style="text-align: right;">0.58</td>
<td style="text-align: right;">13.15</td>
<td style="text-align: right;">8.65</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">40</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">experience3</td>
<td style="text-align: right;">4847</td>
<td style="text-align: right;">0.58</td>
<td style="text-align: right;">13.93</td>
<td style="text-align: right;">8.61</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">38</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
</div>
</div>
<p>In essence, there were 2 treatments in each grade (small class with 13 - 17 students, and a regular class with 22 - 25 students and a teaching aide). We introduce two binary variables, each being an indicator for the respective treatment group for the difference estimator. This is to capture the treatment effect for each treatment group separately yielding the population regression model for the test score as</p>
<p><span id="eq-pop-model"><span class="math display">\[
\begin{equation}
Y_i = \beta_0 + \beta_1 smallClass_i + \beta2RegAide_i + \epsilon_i
\end{equation}
  \tag{14}\]</span></span></p>
<div class="cell" data-tbl-cap-location="bottom">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>grades <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"k"</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co"># map over grades to create a list of models</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>star_models <span class="ot">&lt;-</span> grades <span class="sc">|&gt;</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">paste0</span>(<span class="st">"grade_"</span>, grades)) <span class="sc">|&gt;</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    \(y){</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="co">#       construct the formula dynamically: I(ready + mathy) ~ starY</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>      form <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">"I(read"</span>, y, <span class="st">"+ math"</span>, y, <span class="st">") ~ star"</span>, y))</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">lm</span>(form, <span class="at">data =</span> STAR)</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="co"># compute robust standard error</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>rob_se <span class="ot">&lt;-</span> star_models <span class="sc">|&gt;</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a> <span class="fu">map</span>(\(m) <span class="fu">sqrt</span>(<span class="fu">diag</span>(<span class="fu">vcovHC</span>(m, <span class="at">type =</span> <span class="st">"HC1"</span>))))</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Define which Goodness-of-Fit stats to show and what to call them</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>gm1 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"raw"</span> <span class="ot">=</span> <span class="st">"nobs"</span>, <span class="st">"clean"</span> <span class="ot">=</span> <span class="st">"Observations"</span>, <span class="st">"fmt"</span> <span class="ot">=</span> <span class="dv">0</span>),</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"raw"</span> <span class="ot">=</span> <span class="st">"r.squared"</span>, <span class="st">"clean"</span> <span class="ot">=</span> <span class="st">"R2"</span>, <span class="st">"fmt"</span> <span class="ot">=</span> <span class="dv">3</span>),</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"raw"</span> <span class="ot">=</span> <span class="st">"adj.r.squared"</span>, <span class="st">"clean"</span> <span class="ot">=</span> <span class="st">"Adj. R2"</span>, <span class="st">"fmt"</span> <span class="ot">=</span> <span class="dv">3</span>),</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Added Residual Standard Error</span></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"raw"</span> <span class="ot">=</span> <span class="st">"sigma"</span>, <span class="st">"clean"</span> <span class="ot">=</span> <span class="st">"Residual Std. Error"</span>, <span class="st">"fmt"</span> <span class="ot">=</span> <span class="dv">3</span>),</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Added F-statistic</span></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"raw"</span> <span class="ot">=</span> <span class="st">"statistic"</span>, <span class="st">"clean"</span> <span class="ot">=</span> <span class="st">"F-statistic"</span>, <span class="st">"fmt"</span> <span class="ot">=</span> <span class="dv">3</span>)</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a><span class="co"># render table</span></span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a><span class="fu">model_tables</span>(<span class="at">models =</span> star_models, <span class="at">robust_se =</span> rob_se)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-popmod1" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-tbl-cap-location="bottom">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-popmod1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="tabwid"><style>.cl-6b4ba4e6{}.cl-6b391e2a{font-family:'DejaVu Sans';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-6b391e48{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-6b40aa28{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-6b40f726{width:1.683in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6b40f744{width:1.166in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6b40f74e{width:1.683in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6b40f758{width:1.166in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6b40f762{width:1.683in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6b40f76c{width:1.166in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6b40f776{width:1.683in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6b40f780{width:1.166in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6b40f78a{width:1.683in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6b40f794{width:1.166in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6b40f79e{width:1.683in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6b40f7a8{width:1.166in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6b40f7b2{width:1.683in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6b40f7bc{width:1.166in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-6b4ba4e6"><thead><tr style="overflow-wrap:break-word;"><th class="cl-6b40f726"><p class="cl-6b40aa28"><span class="cl-6b391e2a"> </span></p></th><th class="cl-6b40f744"><p class="cl-6b40aa28"><span class="cl-6b391e2a">grade_k</span></p></th><th class="cl-6b40f744"><p class="cl-6b40aa28"><span class="cl-6b391e2a">grade_1</span></p></th><th class="cl-6b40f744"><p class="cl-6b40aa28"><span class="cl-6b391e2a">grade_2</span></p></th><th class="cl-6b40f744"><p class="cl-6b40aa28"><span class="cl-6b391e2a">grade_3</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-6b40f74e"><p class="cl-6b40aa28"><span class="cl-6b391e48">starksmall</span></p></td><td class="cl-6b40f758"><p class="cl-6b40aa28"><span class="cl-6b391e48">13.899***</span></p></td><td class="cl-6b40f758"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f758"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f758"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-6b40f762"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f76c"><p class="cl-6b40aa28"><span class="cl-6b391e48">(2.454)</span></p></td><td class="cl-6b40f76c"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f76c"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f76c"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-6b40f776"><p class="cl-6b40aa28"><span class="cl-6b391e48">starkregular+aide</span></p></td><td class="cl-6b40f780"><p class="cl-6b40aa28"><span class="cl-6b391e48">0.314</span></p></td><td class="cl-6b40f780"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f780"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f780"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-6b40f762"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f76c"><p class="cl-6b40aa28"><span class="cl-6b391e48">(2.271)</span></p></td><td class="cl-6b40f76c"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f76c"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f76c"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-6b40f74e"><p class="cl-6b40aa28"><span class="cl-6b391e48">star1small</span></p></td><td class="cl-6b40f758"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f758"><p class="cl-6b40aa28"><span class="cl-6b391e48">29.781***</span></p></td><td class="cl-6b40f758"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f758"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-6b40f762"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f76c"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f76c"><p class="cl-6b40aa28"><span class="cl-6b391e48">(2.831)</span></p></td><td class="cl-6b40f76c"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f76c"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-6b40f776"><p class="cl-6b40aa28"><span class="cl-6b391e48">star1regular+aide</span></p></td><td class="cl-6b40f780"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f780"><p class="cl-6b40aa28"><span class="cl-6b391e48">11.959***</span></p></td><td class="cl-6b40f780"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f780"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-6b40f762"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f76c"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f76c"><p class="cl-6b40aa28"><span class="cl-6b391e48">(2.652)</span></p></td><td class="cl-6b40f76c"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f76c"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-6b40f74e"><p class="cl-6b40aa28"><span class="cl-6b391e48">star2small</span></p></td><td class="cl-6b40f758"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f758"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f758"><p class="cl-6b40aa28"><span class="cl-6b391e48">19.394***</span></p></td><td class="cl-6b40f758"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-6b40f762"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f76c"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f76c"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f76c"><p class="cl-6b40aa28"><span class="cl-6b391e48">(2.712)</span></p></td><td class="cl-6b40f76c"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-6b40f776"><p class="cl-6b40aa28"><span class="cl-6b391e48">star2regular+aide</span></p></td><td class="cl-6b40f780"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f780"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f780"><p class="cl-6b40aa28"><span class="cl-6b391e48">3.479</span></p></td><td class="cl-6b40f780"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-6b40f762"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f76c"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f76c"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f76c"><p class="cl-6b40aa28"><span class="cl-6b391e48">(2.545)</span></p></td><td class="cl-6b40f76c"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-6b40f74e"><p class="cl-6b40aa28"><span class="cl-6b391e48">star3small</span></p></td><td class="cl-6b40f758"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f758"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f758"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f758"><p class="cl-6b40aa28"><span class="cl-6b391e48">15.587***</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-6b40f762"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f76c"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f76c"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f76c"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f76c"><p class="cl-6b40aa28"><span class="cl-6b391e48">(2.396)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-6b40f776"><p class="cl-6b40aa28"><span class="cl-6b391e48">star3regular+aide</span></p></td><td class="cl-6b40f780"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f780"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f780"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f780"><p class="cl-6b40aa28"><span class="cl-6b391e48">-0.291</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-6b40f762"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f76c"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f76c"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f76c"><p class="cl-6b40aa28"><span class="cl-6b391e48"></span></p></td><td class="cl-6b40f76c"><p class="cl-6b40aa28"><span class="cl-6b391e48">(2.273)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-6b40f74e"><p class="cl-6b40aa28"><span class="cl-6b391e48">Num.Obs.</span></p></td><td class="cl-6b40f758"><p class="cl-6b40aa28"><span class="cl-6b391e48">5786</span></p></td><td class="cl-6b40f758"><p class="cl-6b40aa28"><span class="cl-6b391e48">6379</span></p></td><td class="cl-6b40f758"><p class="cl-6b40aa28"><span class="cl-6b391e48">6049</span></p></td><td class="cl-6b40f758"><p class="cl-6b40aa28"><span class="cl-6b391e48">5967</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-6b40f78a"><p class="cl-6b40aa28"><span class="cl-6b391e48">R2</span></p></td><td class="cl-6b40f794"><p class="cl-6b40aa28"><span class="cl-6b391e48">0.007</span></p></td><td class="cl-6b40f794"><p class="cl-6b40aa28"><span class="cl-6b391e48">0.017</span></p></td><td class="cl-6b40f794"><p class="cl-6b40aa28"><span class="cl-6b391e48">0.009</span></p></td><td class="cl-6b40f794"><p class="cl-6b40aa28"><span class="cl-6b391e48">0.010</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-6b40f776"><p class="cl-6b40aa28"><span class="cl-6b391e48">R2 Adj.</span></p></td><td class="cl-6b40f780"><p class="cl-6b40aa28"><span class="cl-6b391e48">0.007</span></p></td><td class="cl-6b40f780"><p class="cl-6b40aa28"><span class="cl-6b391e48">0.017</span></p></td><td class="cl-6b40f780"><p class="cl-6b40aa28"><span class="cl-6b391e48">0.009</span></p></td><td class="cl-6b40f780"><p class="cl-6b40aa28"><span class="cl-6b391e48">0.010</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-6b40f78a"><p class="cl-6b40aa28"><span class="cl-6b391e48">AIC</span></p></td><td class="cl-6b40f794"><p class="cl-6b40aa28"><span class="cl-6b391e48">66151.5</span></p></td><td class="cl-6b40f794"><p class="cl-6b40aa28"><span class="cl-6b391e48">75587.2</span></p></td><td class="cl-6b40f794"><p class="cl-6b40aa28"><span class="cl-6b391e48">70731.2</span></p></td><td class="cl-6b40f794"><p class="cl-6b40aa28"><span class="cl-6b391e48">68126.3</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-6b40f78a"><p class="cl-6b40aa28"><span class="cl-6b391e48">BIC</span></p></td><td class="cl-6b40f794"><p class="cl-6b40aa28"><span class="cl-6b391e48">66178.2</span></p></td><td class="cl-6b40f794"><p class="cl-6b40aa28"><span class="cl-6b391e48">75614.2</span></p></td><td class="cl-6b40f794"><p class="cl-6b40aa28"><span class="cl-6b391e48">70758.1</span></p></td><td class="cl-6b40f794"><p class="cl-6b40aa28"><span class="cl-6b391e48">68153.1</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-6b40f776"><p class="cl-6b40aa28"><span class="cl-6b391e48">Log.Lik.</span></p></td><td class="cl-6b40f780"><p class="cl-6b40aa28"><span class="cl-6b391e48">-33071.755</span></p></td><td class="cl-6b40f780"><p class="cl-6b40aa28"><span class="cl-6b391e48">-37789.595</span></p></td><td class="cl-6b40f780"><p class="cl-6b40aa28"><span class="cl-6b391e48">-35361.613</span></p></td><td class="cl-6b40f780"><p class="cl-6b40aa28"><span class="cl-6b391e48">-34059.138</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-6b40f78a"><p class="cl-6b40aa28"><span class="cl-6b391e48">RMSE</span></p></td><td class="cl-6b40f794"><p class="cl-6b40aa28"><span class="cl-6b391e48">73.47</span></p></td><td class="cl-6b40f794"><p class="cl-6b40aa28"><span class="cl-6b391e48">90.48</span></p></td><td class="cl-6b40f794"><p class="cl-6b40aa28"><span class="cl-6b391e48">83.67</span></p></td><td class="cl-6b40f794"><p class="cl-6b40aa28"><span class="cl-6b391e48">72.89</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-6b40f79e"><p class="cl-6b40aa28"><span class="cl-6b391e48">Std.Errors</span></p></td><td class="cl-6b40f7a8"><p class="cl-6b40aa28"><span class="cl-6b391e48">grade_k</span></p></td><td class="cl-6b40f7a8"><p class="cl-6b40aa28"><span class="cl-6b391e48">grade_1</span></p></td><td class="cl-6b40f7a8"><p class="cl-6b40aa28"><span class="cl-6b391e48">grade_2</span></p></td><td class="cl-6b40f7a8"><p class="cl-6b40aa28"><span class="cl-6b391e48">grade_3</span></p></td></tr></tbody><tfoot><tr style="overflow-wrap:break-word;"><td colspan="5" class="cl-6b40f7b2"><p class="cl-6b40aa28"><span class="cl-6b391e48">+ p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001</span></p></td></tr></tfoot></table></div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-popmod1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;7: Project STAR: Differences estimate. Class size reduction improves study performance excpt for grade 1
</figcaption>
</figure>
</div>
</div>
<p>We can augment the model in (<a href="#eq-pop-model" class="quarto-xref">Equation&nbsp;14</a>) with extra variables under 2 circumstances:</p>
<ol type="1">
<li>Adding the regressors explain some of the observed variations in the outcome making the estimates more efficient</li>
<li>If treatment assignment is not random, the estimates obtained in (<a href="#eq-pop-model" class="quarto-xref">Equation&nbsp;14</a>) are possibly biased. The additional regressors could mitigate this challenge.</li>
</ol>
<p>For our setting we could consider 6 additional variables (in a staggered manner):</p>
<ul>
<li><em>experience</em> - Teachers years of experience</li>
<li><em>boy</em> - A dummy (student is a boy)</li>
<li><em>lunch</em> - Free lunch eligibility (dummy)</li>
<li><em>black</em> - Student is black (dummy)</li>
<li><em>race</em> - Students race is other than black or white (dummy)</li>
<li><em>schoolid</em> - School indicator variables</li>
</ul>
<p><strong>Note</strong>: For randomized controlled experiments, we can make causal claims only for variables that subjects were randomly assigned into.</p>
</section>
<section id="quasi-experiments" class="level2">
<h2 class="anchored" data-anchor-id="quasi-experiments">Quasi experiments</h2>
<p>Quasi experiments exploit as if randomness to use methods considered under randomized controlled experiments. They come in two forms:</p>
<ol type="1">
<li>Random variations in individual circumstances allow to view the treatment as if it was randomly determined.</li>
<li>The treatment is only partly determined by as if random variation.</li>
</ol>
<p>The former allows the use of either model (<a href="#eq-ae-dear" class="quarto-xref">Equation&nbsp;13</a>), i.e., <strong>the difference estimator with additional regressors</strong>, or, using <strong>difference-in-difference (DID)</strong> if the as if randomness does not guarantee the non-existence of systematic differences in the control and treatment groups. The latter case invites the use of an IV approach for a case like model (<a href="#eq-ae-dear" class="quarto-xref">Equation&nbsp;13</a>), utilizing the source of as if randomness in treatment assignment as the instrument. Other methods include <strong>sharp regression discontinuity design (RDD)</strong> and <strong>fuzzy regression discontinuity design (FRDD)</strong>. We use simulated data to explore these methods</p>
<section id="the-difference-in-difference-did-estimator" class="level3">
<h3 class="anchored" data-anchor-id="the-difference-in-difference-did-estimator">The difference-in-difference (DID) estimator</h3>
<p>The source of as if randomness in treatment assignment in quasi-experiments does not always rule out systematic differences between control and treatment groups. DID involves data in organised in the before and after treatment.</p>
<p><span id="eq-DID"><span class="math display">\[
\begin{align}
  \widehat{\beta}_1^{\text{diffs-in-diffs}} =&amp; \, (\overline{Y}^{\text{treatment,after}} - \overline{Y}^{\text{treatment,before}}) - (\overline{Y}^{\text{control,after}} - \overline{Y}^{\text{control,before}}) \\
  =&amp; \Delta \overline{Y}^{\text{treatment}} - \Delta \overline{Y}^{\text{control}},
\end{align}
\tag{15}\]</span></span></p>
<p>with</p>
<ul>
<li><p><span class="math inline">\(\overline{Y}^{\text{treatment,before}}\)</span> - the sample average in the treatment group before the treatment</p></li>
<li><p><span class="math inline">\(\overline{Y}^{\text{treatment,after}}\)</span> - the sample average in the treatment group after the treatment</p></li>
<li><p><span class="math inline">\(\overline{Y}^{\text{treatment,before}}\)</span> - the sample average in the control group before the treatment</p></li>
<li><p><span class="math inline">\(\overline{Y}^{\text{treatment,after}}\)</span> - the sample average in the control group after the treatment.</p></li>
</ul>
<p>We now use R to plot a DID setting.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize plot and add control group</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">8</span>), </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">"p"</span>,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">12</span>),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.3</span>, <span class="fl">1.3</span>),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>     <span class="co"># main = "The Differences-in-Differences Estimator",</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Period"</span>,</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Y"</span>,</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">20</span>,</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">xaxt =</span> <span class="st">"n"</span>,</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">yaxt =</span> <span class="st">"n"</span>)</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"before"</span>, <span class="st">"after"</span>))</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>, <span class="at">at =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">13</span>))</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="co"># add treatment group</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">9</span>, <span class="dv">11</span>), </span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">"darkred"</span>,</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">20</span>)</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a><span class="co"># add line segments</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">11</span>), <span class="at">col =</span> <span class="st">"darkred"</span>)</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">8</span>), <span class="at">col =</span> <span class="st">"steelblue"</span>)</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">9</span>), <span class="at">col =</span> <span class="st">"darkred"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">11</span>), <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a><span class="co"># add annotations</span></span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="fu">expression</span>(<span class="fu">hat</span>(beta)[<span class="dv">1</span>]<span class="sc">^</span>{DID}), <span class="at">cex =</span> <span class="fl">0.8</span>, <span class="at">pos =</span> <span class="dv">4</span>)</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="dv">0</span>, <span class="fl">5.5</span>, <span class="st">"s. mean control"</span>, <span class="at">cex =</span> <span class="fl">0.8</span> , <span class="at">pos =</span> <span class="dv">4</span>)</span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="dv">0</span>, <span class="fl">6.8</span>, <span class="st">"s. mean treatment"</span>, <span class="at">cex =</span> <span class="fl">0.8</span> , <span class="at">pos =</span> <span class="dv">4</span>)</span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="dv">1</span>, <span class="fl">7.9</span>, <span class="st">"s. mean control"</span>, <span class="at">cex =</span> <span class="fl">0.8</span> , <span class="at">pos =</span> <span class="dv">4</span>)</span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="dv">1</span>, <span class="fl">11.1</span>, <span class="st">"s. mean treatment"</span>, <span class="at">cex =</span> <span class="fl">0.8</span> , <span class="at">pos =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-did" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-did-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-did-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-did-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Difference-in-differnce plot
</figcaption>
</figure>
</div>
</div>
</div>
<p>The DID estimator (<a href="#eq-DID" class="quarto-xref">Equation&nbsp;15</a>) can take a regression notation: <span class="math inline">\(\hat{\beta_1}^{DID}\)</span> is the OLS estimator of <span class="math inline">\(\beta_1\)</span> in</p>
<p><span id="eq-DID-1"><span class="math display">\[
\begin{equation}
\Delta Y_i = \beta_0 + \beta_1X_i + \epsilon_i
\end{equation}
\tag{16}\]</span></span></p>
<p>with <span class="math inline">\(\Delta Y_i\)</span> denoting the difference in pre and post-treatment outcomes of subject <span class="math inline">\(i\)</span>, <span class="math inline">\(X_i\)</span> is the treatment indicator. We can add additional regressors measuring pretreatment characteristics to (<a href="#eq-DID-1" class="quarto-xref">Equation&nbsp;16</a>) to get the <strong>difference-in-difference estimator with additional regressors</strong>.</p>
<p><span id="eq-DID-2"><span class="math display">\[
\begin{equation}
\Delta Y_i = \beta_0 + \beta_1X_i + \beta_2W_{1i} + \dots + \beta_{1+r}W_{ri} +  \epsilon_i
\end{equation}
\tag{17}\]</span></span></p>
<p>Simulate data:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="fu">as.numeric</span>(<span class="fu">Sys.Date</span>()))</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co"># set sample size</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co"># define treatment effect</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>TEffect <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co"># generate treatment dummy</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>TDummy <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, n<span class="sc">/</span><span class="dv">2</span>), <span class="fu">rep</span>(<span class="dv">1</span>, n<span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate pre- and post-treatment values of the dependent variable</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>y_pre <span class="ot">&lt;-</span> <span class="dv">7</span> <span class="sc">+</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>y_pre[<span class="dv">1</span><span class="sc">:</span>n<span class="sc">/</span><span class="dv">2</span>] <span class="ot">&lt;-</span> y_pre[<span class="dv">1</span><span class="sc">:</span>n<span class="sc">/</span><span class="dv">2</span>] <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>y_post <span class="ot">&lt;-</span> <span class="dv">7</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">+</span> TEffect <span class="sc">*</span> TDummy <span class="sc">+</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>y_post[<span class="dv">1</span><span class="sc">:</span>n<span class="sc">/</span><span class="dv">2</span>] <span class="ot">&lt;-</span> y_post[<span class="dv">1</span><span class="sc">:</span>n<span class="sc">/</span><span class="dv">2</span>] <span class="sc">-</span> <span class="dv">1</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Plot data:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>pre <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(y_pre[TDummy<span class="sc">==</span><span class="dv">0</span>]))</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(y_pre[TDummy<span class="sc">==</span><span class="dv">0</span>]))</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot control group in t=1</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">jitter</span>(pre, <span class="fl">0.6</span>), </span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>     y_pre[TDummy <span class="sc">==</span> <span class="dv">0</span>], </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">16</span>), </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="fu">alpha</span>(<span class="st">"steelblue"</span>, <span class="fl">0.3</span>),</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">20</span>, </span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">1.5</span>),</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Y"</span>,</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Period"</span>,</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">xaxt =</span> <span class="st">"n"</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>     <span class="co"># ,main = "Artificial Data for DID Estimation"</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"before"</span>, <span class="st">"after"</span>))</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="co"># add treatment group in t=1</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="fu">jitter</span>(pre, <span class="fl">0.6</span>), </span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>       y_pre[TDummy <span class="sc">==</span> <span class="dv">1</span>], </span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">alpha</span>(<span class="st">"darkred"</span>, <span class="fl">0.3</span>), </span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">20</span>)</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a><span class="co"># add control group in t=2</span></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="fu">jitter</span>(post, <span class="fl">0.6</span>),</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>       y_post[TDummy <span class="sc">==</span> <span class="dv">0</span>], </span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">alpha</span>(<span class="st">"steelblue"</span>, <span class="fl">0.5</span>),</span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">20</span>)</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a><span class="co"># add treatment group in t=2</span></span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="fu">jitter</span>(post, <span class="fl">0.6</span>), </span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>       y_post[TDummy <span class="sc">==</span> <span class="dv">1</span>], </span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">alpha</span>(<span class="st">"darkred"</span>, <span class="fl">0.5</span>),</span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-did-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-did-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-did-1-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-did-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Artificial data for DID estimation
</figcaption>
</figure>
</div>
</div>
</div>
<p>Compute DID estimate by hand:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute the DID estimator for the treatment effect 'by hand'</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(y_post[TDummy <span class="sc">==</span> <span class="dv">1</span>]) <span class="sc">-</span> <span class="fu">mean</span>(y_pre[TDummy <span class="sc">==</span> <span class="dv">1</span>]) <span class="sc">-</span> </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>(<span class="fu">mean</span>(y_post[TDummy <span class="sc">==</span> <span class="dv">0</span>]) <span class="sc">-</span> <span class="fu">mean</span>(y_pre[TDummy <span class="sc">==</span> <span class="dv">0</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4.085678</code></pre>
</div>
</div>
<p>Compute DID using a linear model:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute the DID estimator using a linear model</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="fu">I</span>(y_post <span class="sc">-</span> y_pre) <span class="sc">~</span> TDummy) <span class="sc">%&gt;%</span> <span class="fu">render_summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="tabwid"><style>.cl-6c1d04e6{}.cl-6c0e0126{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-6c1495c2{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-6c1495d6{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-6c14d7da{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6c14d7ee{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6c14d7f8{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6c14d802{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6c14d803{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6c14d80c{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-6c1d04e6"><thead><tr style="overflow-wrap:break-word;"><th class="cl-6c14d7da"><p class="cl-6c1495c2"><span class="cl-6c0e0126">term</span></p></th><th class="cl-6c14d7ee"><p class="cl-6c1495d6"><span class="cl-6c0e0126">estimate</span></p></th><th class="cl-6c14d7ee"><p class="cl-6c1495d6"><span class="cl-6c0e0126">std.error</span></p></th><th class="cl-6c14d7ee"><p class="cl-6c1495d6"><span class="cl-6c0e0126">statistic</span></p></th><th class="cl-6c14d7da"><p class="cl-6c1495c2"><span class="cl-6c0e0126">p.value</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-6c14d7f8"><p class="cl-6c1495c2"><span class="cl-6c0e0126">(Intercept)</span></p></td><td class="cl-6c14d802"><p class="cl-6c1495d6"><span class="cl-6c0e0126">1.964</span></p></td><td class="cl-6c14d802"><p class="cl-6c1495d6"><span class="cl-6c0e0126">0.129</span></p></td><td class="cl-6c14d802"><p class="cl-6c1495d6"><span class="cl-6c0e0126">15.220</span></p></td><td class="cl-6c14d7f8"><p class="cl-6c1495c2"><span class="cl-6c0e0126">&lt;0.0001</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-6c14d803"><p class="cl-6c1495c2"><span class="cl-6c0e0126">TDummy</span></p></td><td class="cl-6c14d80c"><p class="cl-6c1495d6"><span class="cl-6c0e0126">4.086</span></p></td><td class="cl-6c14d80c"><p class="cl-6c1495d6"><span class="cl-6c0e0126">0.182</span></p></td><td class="cl-6c14d80c"><p class="cl-6c1495d6"><span class="cl-6c0e0126">22.392</span></p></td><td class="cl-6c14d803"><p class="cl-6c1495c2"><span class="cl-6c0e0126">&lt;0.0001</span></p></td></tr></tbody></table></div>
</div>
</div>
</section>
<section id="regression-discontinuity-estimators" class="level3">
<h3 class="anchored" data-anchor-id="regression-discontinuity-estimators">Regression discontinuity estimators</h3>
<p>Consider the model</p>
<p><span id="eq-SRDDsetting"><span class="math display">\[
\begin{align}
  Y_i =&amp; \beta_0 + \beta_1 X_i + \beta_2 W_i + u_i
\end{align}
\tag{18}\]</span></span></p>
<p>and let</p>
<p><span class="math display">\[
\begin{align*}
X_i =&amp;
  \begin{cases}
    1, &amp; W_i \geq c \\
    0, &amp; W_i &lt; c,
  \end{cases}
\end{align*}
\]</span> so that the receipt of treatment, <span class="math inline">\(X_i\)</span>, is determined by some threshold <span class="math inline">\(c\)</span> of a continuous variable <span class="math inline">\(W_i\)</span>, the so called running variable. The idea of <em>regression discontinuity design</em> is to use observations with a <span class="math inline">\(W_i\)</span> close to <span class="math inline">\(c\)</span> for estimation of <span class="math inline">\(\beta_1\)</span>. <span class="math inline">\(\beta_1\)</span> is the average treatment effect for individuals with <span class="math inline">\(W_i = c\)</span> which is assumed to be a good approximation to the treatment effect in the population. (<a href="#eq-SRDDsetting" class="quarto-xref">Equation&nbsp;18</a>) is called a <em>sharp regression discontinuity design</em> because treatment assignment is deterministic and discontinuous at the cutoff: all observations with <span class="math inline">\(W_i &lt; c\)</span> do not receive treatment and all observations where <span class="math inline">\(W_i \geq c\)</span> are treated.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="fu">as.numeric</span>(<span class="fu">Sys.Date</span>()))</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co"># generate some sample data</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>W <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1000</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> W <span class="sc">+</span> <span class="dv">10</span> <span class="sc">*</span> (W<span class="sc">&gt;=</span><span class="dv">0</span>) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">1000</span>)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="co"># construct rdd_data </span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">rdd_data</span>(y, W, <span class="at">cutpoint =</span> <span class="dv">0</span>)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the sample data</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(data,</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">0.35</span>, </span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"W"</span>, </span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-rdd" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-rdd-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-rdd-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-rdd-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: Regression discontinuity plot
</figcaption>
</figure>
</div>
</div>
</div>
<p>The argument <code>nbins</code> sets the number of bins the running variable is divided into for aggregation. The dots represent bin averages of the outcome variable.</p>
<p>We use the function <code>rdd_reg_lm()</code> to estimate the treatment effect using model (<a href="#eq-SRDDsetting" class="quarto-xref">Equation&nbsp;18</a>). <code>slope = "same"</code> restricts the slopes of the estimated regression function to be the same on both sides of the jump at cutpoint <span class="math inline">\(W = 0\)</span>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>rdd_mod <span class="ot">&lt;-</span> <span class="fu">rdd_reg_lm</span>(<span class="at">rdd_object =</span> data, </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">slope =</span> <span class="st">"same"</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="fu">render_summary</span>(rdd_mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The `tidy()` method for objects of class `rdd_reg_lm` is not maintained by the broom team, and is only supported through the `lm` tidier method. Please be cautious in interpreting and reporting broom output.

This warning is displayed once per session.</code></pre>
</div>
<div class="cell-output-display">
<div class="tabwid"><style>.cl-6c944114{}.cl-6c7baf14{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-6c84a538{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-6c84a560{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-6c850a00{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6c850a1e{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6c850a28{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6c850a32{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6c850a3c{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6c850a46{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-6c944114"><thead><tr style="overflow-wrap:break-word;"><th class="cl-6c850a00"><p class="cl-6c84a538"><span class="cl-6c7baf14">term</span></p></th><th class="cl-6c850a1e"><p class="cl-6c84a560"><span class="cl-6c7baf14">estimate</span></p></th><th class="cl-6c850a1e"><p class="cl-6c84a560"><span class="cl-6c7baf14">std.error</span></p></th><th class="cl-6c850a1e"><p class="cl-6c84a560"><span class="cl-6c7baf14">statistic</span></p></th><th class="cl-6c850a00"><p class="cl-6c84a538"><span class="cl-6c7baf14">p.value</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-6c850a28"><p class="cl-6c84a538"><span class="cl-6c7baf14">(Intercept)</span></p></td><td class="cl-6c850a32"><p class="cl-6c84a560"><span class="cl-6c7baf14">3.065</span></p></td><td class="cl-6c850a32"><p class="cl-6c84a560"><span class="cl-6c7baf14">0.073</span></p></td><td class="cl-6c850a32"><p class="cl-6c84a560"><span class="cl-6c7baf14">42.135</span></p></td><td class="cl-6c850a28"><p class="cl-6c84a538"><span class="cl-6c7baf14">&lt;0.0001</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-6c850a28"><p class="cl-6c84a538"><span class="cl-6c7baf14">D</span></p></td><td class="cl-6c850a32"><p class="cl-6c84a560"><span class="cl-6c7baf14">9.873</span></p></td><td class="cl-6c850a32"><p class="cl-6c84a560"><span class="cl-6c7baf14">0.129</span></p></td><td class="cl-6c850a32"><p class="cl-6c84a560"><span class="cl-6c7baf14">76.751</span></p></td><td class="cl-6c850a28"><p class="cl-6c84a538"><span class="cl-6c7baf14">&lt;0.0001</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-6c850a3c"><p class="cl-6c84a538"><span class="cl-6c7baf14">x</span></p></td><td class="cl-6c850a46"><p class="cl-6c84a560"><span class="cl-6c7baf14">2.172</span></p></td><td class="cl-6c850a46"><p class="cl-6c84a560"><span class="cl-6c7baf14">0.113</span></p></td><td class="cl-6c850a46"><p class="cl-6c84a560"><span class="cl-6c7baf14">19.244</span></p></td><td class="cl-6c850a3c"><p class="cl-6c84a538"><span class="cl-6c7baf14">&lt;0.0001</span></p></td></tr></tbody></table></div>
</div>
</div>
<p>You can visualize by calling plot</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the RDD model along with binned observations</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rdd_mod,</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">0.35</span>, </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"steelblue"</span>, </span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"W"</span>, </span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>So far we assumed that crossing of the threshold determines receipt of treatment so that the jump of the population regression functions at the threshold can be regarded as the causal effect of the treatment.</p>
<p>When crossing the threshold <span class="math inline">\(c\)</span> is not the only cause for receipt of the treatment, treatment is no a deterministic function of <span class="math inline">\(W_i\)</span>. Instead, it is useful to think of <span class="math inline">\(c\)</span> as a threshold where the <em>probability</em> of receiving the treatment jumps.</p>
<p>This jump may be due to unobservable variables that have impact on the probability of being treated. Thus, <span class="math inline">\(X_i\)</span> in (<a href="#eq-SRDDsetting" class="quarto-xref">Equation&nbsp;18</a>) will be correlated with the error <span class="math inline">\(u_i\)</span> and it becomes more difficult to consistently estimate the treatment effect. In this setting, using a <em>fuzzy regression discontinuity design</em> which is based an IV approach may be a remedy: take the binary variable <span class="math inline">\(Z_i\)</span> as an indicator for crossing of the threshold,</p>
<p><span class="math display">\[
\begin{align*}
  Z_i = \begin{cases}
    1, &amp; W_i \geq c \\
    0, &amp; W_i &lt; c,
  \end{cases}
\end{align*}
\]</span> and assume that <span class="math inline">\(Z_i\)</span> relates to <span class="math inline">\(Y_i\)</span> only through the treatment indicator <span class="math inline">\(X_i\)</span>. Then <span class="math inline">\(Z_i\)</span> and <span class="math inline">\(u_i\)</span> are uncorrelated but <span class="math inline">\(Z_i\)</span> influences receipt of treatment so it is correlated with <span class="math inline">\(X_i\)</span>. Thus, <span class="math inline">\(Z_i\)</span> is a valid instrument for <span class="math inline">\(X_i\)</span> and (<a href="#eq-SRDDsetting" class="quarto-xref">Equation&nbsp;18</a>) can be estimated using TSLS.</p>
<p>The following code chunk generates sample data where observations with a value of the running variable <span class="math inline">\(W_i\)</span> below the cutoff <span class="math inline">\(c=0\)</span> do not receive treatment and observations with <span class="math inline">\(W_i \geq 0\)</span> do receive treatment with a probability of <span class="math inline">\(80\%\)</span> so that treatment status is only partially determined by the running variable and the cutoff. Treatment leads to an increase in <span class="math inline">\(Y\)</span> by <span class="math inline">\(2\)</span> units. Observations with <span class="math inline">\(W_i \geq 0\)</span> that do not receive treatment are called <em>no-shows</em>: think of an individual that was assigned to receive the treatment but somehow manages to avoid it.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># generate sample data</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="fu">as.numeric</span>(<span class="fu">Sys.Date</span>()))</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.7</span>, <span class="fl">0.7</span>, <span class="dv">1</span>), <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">mvrnorm</span>(<span class="dv">2000</span>, mu, sigma))</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(d) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"W"</span>, <span class="st">"Y"</span>)</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="co"># introduce fuzziness</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>treatProb <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(d<span class="sc">$</span>W <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.8</span>)</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>fuzz <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="at">X =</span> d<span class="sc">$</span>treatProb, <span class="at">FUN =</span> <span class="cf">function</span>(x) <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="at">prob =</span> x))</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="co"># treatment effect</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>Y <span class="ot">&lt;-</span> d<span class="sc">$</span>Y <span class="sc">+</span> fuzz <span class="sc">*</span> <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Plot:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># generate a colored plot of treatment and control group</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(d<span class="sc">$</span>W, d<span class="sc">$</span>Y,</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"steelblue"</span>, <span class="st">"darkred"</span>)[<span class="fu">factor</span>(fuzz)], </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch=</span> <span class="dv">20</span>, </span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">0.5</span>,</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>),</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">3.5</span>, <span class="dv">5</span>),</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"W"</span>,</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Y"</span>)</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="co"># add a dashed vertical line at cutoff</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a><span class="co">#add legend</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>,<span class="at">pch=</span><span class="dv">20</span>,<span class="at">col=</span><span class="fu">c</span>(<span class="st">"steelblue"</span>,<span class="st">"darkred"</span>),</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend=</span><span class="fu">c</span>(<span class="st">"Do not receive treatment"</span>,<span class="st">"Receive treatment"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Obviously, receipt of treatment is no longer a deterministic function of the running variable <span class="math inline">\(W\)</span>. Some observations with <span class="math inline">\(W\geq0\)</span> <em>did not</em> receive the treatment. We may estimate a FRDD by additionally setting <code>treatProb</code> as the assignment variable <code>z</code> in <code>rdd_data</code>. Then <code>rdd_reg_lm()</code> applies the following TSLS procedure: treatment is predicted using <span class="math inline">\(W_i\)</span> and the cutoff dummy <span class="math inline">\(Z_i\)</span>, the instrumental variable, in the first stage regression. The fitted values from the first stage regression are used to obtain a consistent estimate of the treatment effect using the second stage where the outcome <span class="math inline">\(Y\)</span> is regressed on the fitted values and the running variable <span class="math inline">\(W\)</span>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate the Fuzzy RDD</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">rdd_data</span>(d<span class="sc">$</span>Y, d<span class="sc">$</span>W, </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">cutpoint =</span> <span class="dv">0</span>, </span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">z =</span> d<span class="sc">$</span>treatProb)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>frdd_mod <span class="ot">&lt;-</span> <span class="fu">rdd_reg_lm</span>(<span class="at">rdd_object =</span> data, </span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">slope =</span> <span class="st">"same"</span>)</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>frdd_mod <span class="sc">%&gt;%</span> <span class="fu">render_summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="tabwid"><style>.cl-6dc412d0{}.cl-6daf9530{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-6db80d14{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-6db80d32{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-6db862b4{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db862c8{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db862dc{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db862e6{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db862f0{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db862fa{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-6dc412d0"><thead><tr style="overflow-wrap:break-word;"><th class="cl-6db862b4"><p class="cl-6db80d14"><span class="cl-6daf9530">term</span></p></th><th class="cl-6db862c8"><p class="cl-6db80d32"><span class="cl-6daf9530">estimate</span></p></th><th class="cl-6db862c8"><p class="cl-6db80d32"><span class="cl-6daf9530">std.error</span></p></th><th class="cl-6db862c8"><p class="cl-6db80d32"><span class="cl-6daf9530">statistic</span></p></th><th class="cl-6db862b4"><p class="cl-6db80d14"><span class="cl-6daf9530">p.value</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-6db862dc"><p class="cl-6db80d14"><span class="cl-6daf9530">(Intercept)</span></p></td><td class="cl-6db862e6"><p class="cl-6db80d32"><span class="cl-6daf9530">0.014</span></p></td><td class="cl-6db862e6"><p class="cl-6db80d32"><span class="cl-6daf9530">0.040</span></p></td><td class="cl-6db862e6"><p class="cl-6db80d32"><span class="cl-6daf9530">0.362</span></p></td><td class="cl-6db862dc"><p class="cl-6db80d14"><span class="cl-6daf9530">0.7171</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-6db862dc"><p class="cl-6db80d14"><span class="cl-6daf9530">D</span></p></td><td class="cl-6db862e6"><p class="cl-6db80d32"><span class="cl-6daf9530">1.981</span></p></td><td class="cl-6db862e6"><p class="cl-6db80d32"><span class="cl-6daf9530">0.085</span></p></td><td class="cl-6db862e6"><p class="cl-6db80d32"><span class="cl-6daf9530">23.393</span></p></td><td class="cl-6db862dc"><p class="cl-6db80d14"><span class="cl-6daf9530">&lt;0.0001</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-6db862f0"><p class="cl-6db80d14"><span class="cl-6daf9530">x</span></p></td><td class="cl-6db862fa"><p class="cl-6db80d32"><span class="cl-6daf9530">0.709</span></p></td><td class="cl-6db862fa"><p class="cl-6db80d32"><span class="cl-6daf9530">0.034</span></p></td><td class="cl-6db862fa"><p class="cl-6db80d32"><span class="cl-6daf9530">20.685</span></p></td><td class="cl-6db862f0"><p class="cl-6db80d14"><span class="cl-6daf9530">&lt;0.0001</span></p></td></tr></tbody></table></div>
</div>
</div>
<p>The estimate is close to <span class="math inline">\(2\)</span>, the population treatment effect. We may call <code>plot()</code> on the model object to obtain a figure consisting of binned data and the estimated regression function.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot estimated FRDD function</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(frdd_mod, </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">0.5</span>, </span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">lwd =</span> <span class="fl">0.4</span>,</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>),</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">3.5</span>, <span class="dv">5</span>),</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"W"</span>,</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>What if we used a SRDD instead, thereby ignoring the fact that treatment is not perfectly determined by the cutoff in <span class="math inline">\(W\)</span>? We may get an impression of the consequences by estimating an SRDD using the previously simulated data.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate SRDD</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">rdd_data</span>(d<span class="sc">$</span>Y, </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>                 d<span class="sc">$</span>W, </span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">cutpoint =</span> <span class="dv">0</span>)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>srdd_mod <span class="ot">&lt;-</span> <span class="fu">rdd_reg_lm</span>(<span class="at">rdd_object =</span> data, </span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">slope =</span> <span class="st">"same"</span>)</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>srdd_mod <span class="sc">%&gt;%</span> <span class="fu">render_summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="tabwid"><style>.cl-6e5a8f4e{}.cl-6e493e06{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-6e50919c{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-6e5091ba{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-6e50de86{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6e50dea4{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6e50dec2{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6e50decc{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6e50ded6{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6e50dee0{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-6e5a8f4e"><thead><tr style="overflow-wrap:break-word;"><th class="cl-6e50de86"><p class="cl-6e50919c"><span class="cl-6e493e06">term</span></p></th><th class="cl-6e50dea4"><p class="cl-6e5091ba"><span class="cl-6e493e06">estimate</span></p></th><th class="cl-6e50dea4"><p class="cl-6e5091ba"><span class="cl-6e493e06">std.error</span></p></th><th class="cl-6e50dea4"><p class="cl-6e5091ba"><span class="cl-6e493e06">statistic</span></p></th><th class="cl-6e50de86"><p class="cl-6e50919c"><span class="cl-6e493e06">p.value</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-6e50dec2"><p class="cl-6e50919c"><span class="cl-6e493e06">(Intercept)</span></p></td><td class="cl-6e50decc"><p class="cl-6e5091ba"><span class="cl-6e493e06">0.014</span></p></td><td class="cl-6e50decc"><p class="cl-6e5091ba"><span class="cl-6e493e06">0.040</span></p></td><td class="cl-6e50decc"><p class="cl-6e5091ba"><span class="cl-6e493e06">0.362</span></p></td><td class="cl-6e50dec2"><p class="cl-6e50919c"><span class="cl-6e493e06">0.7171</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-6e50dec2"><p class="cl-6e50919c"><span class="cl-6e493e06">D</span></p></td><td class="cl-6e50decc"><p class="cl-6e5091ba"><span class="cl-6e493e06">1.585</span></p></td><td class="cl-6e50decc"><p class="cl-6e5091ba"><span class="cl-6e493e06">0.068</span></p></td><td class="cl-6e50decc"><p class="cl-6e5091ba"><span class="cl-6e493e06">23.393</span></p></td><td class="cl-6e50dec2"><p class="cl-6e50919c"><span class="cl-6e493e06">&lt;0.0001</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-6e50ded6"><p class="cl-6e50919c"><span class="cl-6e493e06">x</span></p></td><td class="cl-6e50dee0"><p class="cl-6e5091ba"><span class="cl-6e493e06">0.709</span></p></td><td class="cl-6e50dee0"><p class="cl-6e5091ba"><span class="cl-6e493e06">0.034</span></p></td><td class="cl-6e50dee0"><p class="cl-6e5091ba"><span class="cl-6e493e06">20.685</span></p></td><td class="cl-6e50ded6"><p class="cl-6e50919c"><span class="cl-6e493e06">&lt;0.0001</span></p></td></tr></tbody></table></div>
</div>
</div>
<p>The estimate obtained using a SRDD is suggestive of a substantial downward bias. In fact, this procedure is inconsistent for the true causal effect so increasing the sample would not alleviate the bias.</p>


</section>
</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{okola2026,
  author = {Okola, Basil},
  title = {Econometrics: {R} Introduction},
  date = {2026-01-21},
  url = {https://bokola.github.io/posts/2026-01-15-survey-design/},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-okola2026" class="csl-entry quarto-appendix-citeas" role="listitem">
Okola, Basil. 2026. <span>Econometrics: R Introduction.</span> January
21, 2026. <a href="https://bokola.github.io/posts/2026-01-15-survey-design/">https://bokola.github.io/posts/2026-01-15-survey-design/</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/bokola\.github\.io\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>