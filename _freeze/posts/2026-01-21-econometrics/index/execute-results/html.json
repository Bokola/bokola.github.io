{
  "hash": "3366c297d03d957fc4c1d0d5f94dfcab",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Econometrics: R introduction\"\ndescription: \"\"\nauthor:\n  - name: Basil Okola\n    url: https://bokola.github.io/\n    # orcid: 0000-0002-5300-3075\n    affiliation: Master of Statistics and Data Science @ Hasselt University\n    affiliation-url: https://ucsb-meds.github.io/ \ndate: 2026-01-21\ncategories: [econometrics, instrumental variables, quasi-experiments, RCTs,R] # self-defined categories\n# include-after-body: pub_ready_viz.html\ncitation: \n  url: https://bokola.github.io/posts/2026-01-15-survey-design/ \n\ndraft: false # setting this to `true` will prevent your post from appearing on your listing page until you're ready!\ncode-fold: true\n# bibliography: reference.bib\n---\n\n\n# Multiple Regression\n\nA number of assumptions underlying ordinary least square (OLS) regression come \ninto close scrutiny under multiple linear regressions. Key assumptions include\n**linearity, independence of residuals, homoscedasticity, normality of residuals**.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(\n  AER, tidyverse, mvtnorm, flextable, modelsummary, sandwich, stargazer,\n  MASS, rddtools, scales, broom, prettyunits\n)\ndata(\"CASchools\", package = \"AER\")\n\n#' Render model coefficients as a flextable\n#'\n#' @param x model object\n#'\n#' @returns\n#' @export\n#'\n#' @examples\nrender_summary <- function(x){\n  x %>% broom::tidy() %>%\n    mutate(p.value = prettyunits::pretty_p_value(p.value)) %>%\n    mutate(across(where(is.numeric), ~ round(., 3))) %>%\n    flextable::flextable()\n}\n\n#' Render a list of models as flextable\n#'\n#' @param models list object of models\n#' @param robust_se list object of robust standard errors\n#'\n#' @returns\n#' @export\n#'\n#' @examples\nmodel_tables <- function(models, robust_se) {\n  modelsummary(\n    models,\n    vcov = robust_se,\n    # Applies your robust SEs\n    output = \"flextable\",\n    # Outputs as a flextable object\n    fmt = 3,\n    # 3 decimal places\n    stars = TRUE,\n    # Significance stars (optional)\n    # gof_map = gm1 # Clean up GOF statistics\n    coef_omit = \"^\\\\(Intercept\\\\)$\"\n    ,\n    gof_omit = NULL\n  ) |>\n    autofit() |>\n    theme_vanilla()   %>%         # Clean academic style\n    # This command removes any remaining horizontal lines inside the body\n    border_inner_h(part = \"body\", border = officer::fp_border(width = 0))\n}\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#|fig-height: 18\nm <- lm(math ~ expenditure, data = CASchools)\n\npar(mfrow = c(2, 2))\nplot(m, col = \"steelblue\", pch = 20)\npar(mfrow = c(1, 1))\n```\n\n::: {.cell-output-display}\n![OLS assumptions visual diagnostic](index_files/figure-html/fig-ols-1.png){#fig-ols width=672}\n:::\n:::\n\n* A plot of residuals vs. fitted values assesses linearity and homoscedasticity assumption. \nA random (white noise) scatter around 0 suggests the assumptions are met.\n* A normal quantile-quantile (Q-Q) plot assesses the normality assumption of the residuals\nwith departure from the straight line suggesting departure from normality.\n* A plot of standardized residuals against fitted values assesses homoscedasticity assumption.\nLook for white noise around the horizontal line in the scale location plot.\n* The residual vs. leverage plot assesses for influential outliers. Points far away from the \ncenter are considered influential.\n\nA number of factors may make multiple OLS regression biased due to a violation\nof any of the assumptions underlying OLS. Sources of these biases include:\n\n**omitted variables, misspecification of the functional form, measurement errors,\nmissing data and sample selection, simultaneous causality bias**.\n\n## omitted variables\n\nThere is no easy fix for addressing omitted variables as a source of bias. Available guidelines stress\n\n1. specifying coefficient(s) of interest\n2. Identifying important sources of omitted variable bias using available \ndomain knowledge prior to model fitting so you end up with a a baseline model \nspecification and a questionable list of other regressors\n3. Using different model specification to test whether questionable regressors\nhave effects different from zero\n4. Providing full disclosure of your results such as results of different model \nspecifications in support of your argument\n\nThe other sources of bias can be assessed via simulations.\n\n## Misspecification of the functional form of a regression function\n\nAssume the underlying function is such that $Y_i = X_i^2$, but the model is\nspecified in the form $Y_i = \\beta_0 + \\beta_1X_i + \\epsilon_i$.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(as.numeric(Sys.time()))\n\nX <- runif(100, -5, 5)\nY <- X^2 + rnorm(100)\n\nml <- lm(Y ~ X)\n\nplot(\n  X,\n  Y,\n  main = \"Model misspecification\",\n  pch = 20,\n  col = \"steelblue\"\n  \n)\n\n# add the regression line\nabline(\n  ml,\n  col = \"grey\",\n  lwd = 2, \n  lty = 2\n)\n\nlegend(\n  \"bottomright\",\n  bg = \"transparent\",\n  cex = 0.8,\n  lwd = 2,\n  lty = 2,\n  col = \"grey\",\n  legend = \"OLS line\"\n  \n)\n```\n\n::: {.cell-output-display}\n![Model misspecification](index_files/figure-html/fig-ms-lm-1.png){#fig-ms-lm width=672}\n:::\n:::\n\n\n## Measurement error and errors-in-variable bias\n\nSet in due to imprecise measurement of the independent variable and do not disappear\nnot even with a large sample size. Due to imprecise measurements we observe \n$\\overset{\\sim}{X}_i$ instead of $X_i$ the \nmodel under consideration becomes \n\n\\begin{align*}\n  Y_i =& \\, \\beta_0 + \\beta_1 \\overset{\\sim}{X}_i + \\underbrace{\\beta_1 (X_i - \\overset{\\sim}{X}_i) + u_i}_{=v_i}. \\\\\n  Y_i =& \\, \\beta_0 + \\beta_1 \\overset{\\sim}{X}_i + v_i.\n\\end{align*}\n\nwhere $\\overset{\\sim}{X}_i$ and the error term $v_i$ are correlated. The OLS would\nthus be biased and inconsistent for $B_1$ with the strength of bias dependent on the\ncorrelation between the observed regressor $\\overset{\\sim}{X}_i$ and the measurement error\n$w_i = X_i - \\overset{\\sim}{X}_i$.\nThe classical measurement error model assumes that the measurement error, $w_i$, has zero mean and that it is uncorrelated with the variable, $X_i$, and the error term of the population regression model, $u_i$:\n\n\\begin{equation}\n  \\overset{\\sim}{X}_i = X_i + w_i, \\ \\ \\rho_{w_i,u_i}=0, \\ \\ \\rho_{w_i,X_i}=0. \n\\end{equation}\nThen it holds that \n$$\\begin{equation}\n  \\widehat{\\beta}_1 \\xrightarrow{p}{\\frac{\\sigma_{X}^2}{\\sigma_{X}^2 + \\sigma_{w}^2}} \\beta_1, \n\\end{equation}\n$${\\#eq-cmembias}\nwhich implies inconsistency as $\\sigma_{X}^2, \\sigma_{w}^2 > 0$ such that the fraction in (@eq-cmembias) is smaller than $1$. Note that there are two extreme cases: \n\n1. If there is no measurement error, $\\sigma_{w}^2=0$ such that $\\widehat{\\beta}_1 \\xrightarrow{p}{\\beta_1}$. \n\n2. If $\\sigma_{w}^2 \\gg \\sigma_{X}^2$ we have $\\widehat{\\beta}_1 \\xrightarrow{p}{0}$. This is the case if the measurement error is so large that there essentially is no information on $X$ in the data that can be used to estimate $\\beta_1$.\n\nThe most obvious way to deal with errors-in-variables bias is to use an accurately measured $X$. If this is not possible, instrumental variables regression is an option. One might also deal with the issue by using a mathematical model of the measurement error and adjust the estimates appropriately: if it is plausible that the classical measurement error model applies and if there is information that can be used to estimate the ratio in equation (@eq-cmembias), one could compute an estimate that corrects for the downward bias.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat <- data.frame(\n  rmvnorm(1000, c(50, 100), \n          sigma = cbind(c(10, 5), c(5, 10))))\n\n# set columns names\ncolnames(dat) <- c(\"X\", \"Y\")\n\n# estimate the model (without measurement error)\nnoerror_mod <- lm(Y ~ X, data = dat)\n\n# estimate the model (with measurement error in X)\ndat$X <- dat$X + rnorm(n = 1000, sd = sqrt(10))\nerror_mod <- lm(Y ~ X, data = dat)\n\n# print estimated coefficients to console\nnoerror_mod$coefficients\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n(Intercept)           X \n 74.7383283   0.5046925 \n```\n\n\n:::\n\n```{.r .cell-code}\n#> (Intercept)           X \n#>  76.3002047   0.4755264\nerror_mod$coefficients\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n(Intercept)           X \n 88.8165365   0.2228252 \n```\n\n\n:::\n\n```{.r .cell-code}\n#> (Intercept)           X \n#>   87.276004    0.255212\n#>   \n# plot sample data\nplot(dat$X, dat$Y, \n     pch = 20, \n     col = \"steelblue\",\n     xlab = \"X\",\n     ylab = \"Y\")\n\n# add population regression function\nabline(coef = c(75, 0.5), \n       col = \"darkgreen\",\n       lwd  = 1.5)\n\n# add estimated regression functions\nabline(noerror_mod, \n       col = \"purple\",\n       lwd  = 1.5)\n\nabline(error_mod, \n       col = \"darkred\",\n       lwd  = 1.5)\n\n# add legend\nlegend(\"topleft\",\n       bg = \"transparent\",\n       cex = 0.8,\n       lty = 1,\n       col = c(\"darkgreen\", \"purple\", \"darkred\"), \n       legend = c(\"Population\", \"No Errors\", \"Errors\"))\n```\n\n::: {.cell-output-display}\n![Measurement error](index_files/figure-html/fig-me-1.png){#fig-me width=672}\n:::\n:::\n\n\n## Missing data and sample selection\n\nIf data is not missing at random, we are faced with biased estimates.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# randmly select 500 obs\nid <- sample(1:1000, 500)\ndat1 <- dat[-id,]\ndat2 <- dat[id,]\n\nci_mod <- lm(Y ~ X, data = dat1)\n\nplot(\n  dat1$X,\n  dat1$Y,\n  col = \"steelblue\",\n  pch = 20,\n  cex = 0.8,\n  xlab = \"X\",\n  ylab = \"Y\"\n)\n\npoints(\n  dat2$X,\n  dat2$Y,\n  cex = 0.8,\n  col = \"grey\",\n  pch = 20\n)\n\n# add pop reg function\nabline(\n  coef = c(75, 100),\n  col = \"darkgreen\",\n  lwd = 1.5\n)\n\n# add full sample model\nabline(noerror_mod, col = \"black\")\n\n# add model without a sample of 500\nabline(ci_mod, col = \"purple\")\n\nlegend(\n  \"bottomright\",\n  lty = 2,\n  bg = \"transparent\",\n  cex = 0.8,\n  col = c(\"darkgreen\", \"black\", \"purple\"),\n  legend = c(\"population\", \"full sample\", \"random sample of 500\")\n)\n```\n\n::: {.cell-output-display}\n![Missing data bias](index_files/figure-html/fig-mis-1.png){#fig-mis width=672}\n:::\n:::\n\n\n## Simultaneous causality bias\n\nArises when `Y` influences `X`. Let's assume that we are interested in estimating the\neffect of 20% increase in price on cigarette. We get the log of price and use it to\nmodel consumption, giving a price elasticity of consumption interpretation. Since\nit is not demand on the Y-axis, this not an estimate of the demand curve, and is \ntherefore a classic example of reverse (simultaneous) causality.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(\"CigarettesSW\")\nc1995 <- subset(CigarettesSW, year == \"1995\")\n\n# estimate the model\ncigcon_mod <- lm(log(packs) ~ log(price), data = c1995)\ncigcon_mod\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = log(packs) ~ log(price), data = c1995)\n\nCoefficients:\n(Intercept)   log(price)  \n     10.850       -1.213  \n```\n\n\n:::\n\n```{.r .cell-code}\n# plot the estimated regression line and the data\nplot(log(c1995$price), log(c1995$packs),\n     xlab = \"ln(Price)\",\n     ylab = \"ln(Consumption)\",\n     main = \"Demand for Cigarettes\",\n     pch = 20,\n     col = \"steelblue\")\n\nabline(cigcon_mod, \n       col = \"darkred\", \n       lwd = 1.5)\n# add legend\nlegend(\"topright\",lty=1,col= \"darkred\", \"Estimated Regression Line\")\n```\n\n::: {.cell-output-display}\n![Reverse causlaity bias](index_files/figure-html/fig-revc-1.png){#fig-revc width=672}\n:::\n:::\n\n\n# Instrumental variable regression\n\n## Simple instrumental variable regression\n\nInstrumental variables (IV) can be used to address possible omitted variable bias.\nConsidering a simple regression model \n\n$$\n\\begin{equation}\nY_i = \\beta_0 + \\beta_1X_i + \\epsilon_i, i = 1, \\ldots, n\n\\end{equation}\n$${\\#eq-lm}\n\nin which the error term is correlated with the endogenous regressor $X$ making the OLS estimate\ninconsistent for $\\beta_1$, we can use a single IV variable $Z$ to obtain a \nconsistent estimator for $\\beta_1$. The IV variable has to meet the \n\n\n1. **relevance condition**: $X$ and its instrument $Z$ must be correlated\n$\\rho_{Z_i, X_i} \\ne 0$ or multicollinear for multiple IV regression.\n2. **instrument exogeneity condition**: The instrument $Z$ must not be \ncorrelated with the error term. \n$\\rho_{Z_i, \\epsilon_i} = 0$\n\nEstimation is through a two-stage least square (TSLS) estimation. The first stage\ncondenses the variation in the endogenous variable $X$ into a problem-free part \nthat is explained by the IV variable $Z$, and a problematic component that is \ncorrelated to the error term $\\epsilon_i$. In the second stage the problem-free\ncomponent of the variation in $X$ is used to estimate $\\beta_1$.\n\nThe first stage uses the regression model $X_i = \\pi_0 + \\pi_1Z_i + v_i$, where \n$\\pi_0 + \\pi_1Z_i$ is the component of $X_i$ explained by $Z_i$, and $v_i$ is the \ncomponent that can not be explained by $Z_i$ and is correlated with $\\epsilon_i$.\nWe can use OLS estimates $\\hat{\\pi_0}$ and $\\hat{\\pi_1}$ to predict $X_i$ giving \nproblem-free $\\hat{X_i}$ ($\\hat{X_i}$ exogenous in the regression of Y on $\\hat{X}$\ndone on second stage ) if $Z$ is indeed a valid instrument. The second stage \nproduces $\\hat{\\beta}_0^{TSLS}$, and $\\hat{\\beta}_1^{TSLS}$, which are the TSLS \nestimates of $\\beta_0$ and $\\beta_1$ respectively. For a single IV it can be shown \nthat the TSLS estimator is but the ratio of sample covariance between $Z$ and $Y$\n\n$$\n\\begin{equation}\n\\hat{\\beta}^{TSLS} = \\frac{s_{Z, Y}}{s_{Z, X}} = \\frac{\\frac{1}{n-1} \\sum_{i=1}^n (Y_i - \\bar{Y})(Z_i - \\bar{Z})}{\\frac{1}{n-1}\\sum_{i=1}^n (X_i - \\bar{X}) (Z_i - \\bar{Z})}\n\\end{equation}\n$${\\#eq-tsls}\n\n### Example: Demand for cigarettes\n\n\n::: {.cell}\n\n```{.r .cell-code}\nskimr::skim(CigarettesSW)\n```\n\n::: {.cell-output-display}\n\nTable: Data summary\n\n|                         |             |\n|:------------------------|:------------|\n|Name                     |CigarettesSW |\n|Number of rows           |96           |\n|Number of columns        |9            |\n|_______________________  |             |\n|Column type frequency:   |             |\n|factor                   |2            |\n|numeric                  |7            |\n|________________________ |             |\n|Group variables          |None         |\n\n\n**Variable type: factor**\n\n|skim_variable | n_missing| complete_rate|ordered | n_unique|top_counts                 |\n|:-------------|---------:|-------------:|:-------|--------:|:--------------------------|\n|state         |         0|             1|FALSE   |       48|AL: 2, AR: 2, AZ: 2, CA: 2 |\n|year          |         0|             1|FALSE   |        2|198: 48, 199: 48           |\n\n\n**Variable type: numeric**\n\n|skim_variable | n_missing| complete_rate|        mean|           sd|         p0|         p25|         p50|         p75|         p100|hist  |\n|:-------------|---------:|-------------:|-----------:|------------:|----------:|-----------:|-----------:|-----------:|------------:|:-----|\n|cpi           |         0|             1|        1.30|         0.23|       1.08|        1.08|        1.30| 1.52000e+00|         1.52|▇▁▁▁▇ |\n|population    |         0|             1|  5168866.32|   5442344.66|  478447.00|  1622606.50|  3697471.50| 5.90150e+06|  31493524.00|▇▂▁▁▁ |\n|packs         |         0|             1|      109.18|        25.87|      49.27|       92.45|      110.16| 1.23520e+02|       197.99|▂▇▇▁▁ |\n|income        |         0|             1| 99878735.74| 120541138.18| 6887097.00| 25520384.00| 61661644.00| 1.27314e+08| 771470144.00|▇▁▁▁▁ |\n|tax           |         0|             1|       42.68|        16.14|      18.00|       31.00|       37.00| 5.08800e+01|        99.00|▇▆▃▂▁ |\n|price         |         0|             1|      143.45|        43.89|      84.97|      102.71|      137.72| 1.76150e+02|       240.85|▇▁▅▂▂ |\n|taxs          |         0|             1|       48.33|        19.33|      21.27|       34.77|       41.05| 5.94800e+01|       112.63|▇▅▂▁▁ |\n\n\n:::\n:::\n\n\nWe wish to estimate $\\beta_1$ in \n\n$$\n\\begin{equation}\nlog(Q_i) = \\beta_0 + \\beta_1 log(P_i) + \\epsilon_i\n\\end{equation}\n$${\\#eq-tcigar}\n\n\nwhere $Q_i$ is the number of cigarette packs per capita sold and $P_i$ is the \nafter tax average real price per pack of cigarette in state $i$. We use sales tax\n(dollars per pack) to instrument the endogenous regressor $log(P_i)$. Salestax is\nconsidered a relevant instrument as it is included in the after-tax average \nprice per pack.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# compute real per capita prices\nCigarettesSW$rprice <- with(CigarettesSW, price / cpi)\n\n#  compute the sales tax\nCigarettesSW$salestax <- with(CigarettesSW, (taxs - tax) / cpi)\n\n# check the correlation between sales tax and price\ncor(CigarettesSW$salestax, CigarettesSW$price)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.6141228\n```\n\n\n:::\n\n```{.r .cell-code}\n#> [1] 0.6141228\n\n# generate a subset for the year 1995\nc1995 <- subset(CigarettesSW, year == \"1995\")\n```\n:::\n\n\nThe first stage regression is $log(P_i) = \\pi_0 + \\pi_1SalesTax_i + v_i$. In the\nsecond stage we regress $log(Q_i)$ on $log(P_i)$ to obtain $\\hat{\\beta_0}^{TSLS}$\n$\\hat{\\beta_1}^{TSLS}$.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# perform the first stage regression\ncig_s1 <- lm(log(rprice) ~ salestax, data = c1995)\n\ncoeftest(cig_s1, vcov = vcovHC, type = \"HC1\") %>% broom::tidy() %>%\n  mutate(p.value = prettyunits::pretty_p_value(p.value)) %>% \n  flextable::flextable()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-635dd196{}.cl-633379a0{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-6344d696{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-6344d6c8{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-63457146{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6345716e{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-63457182{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-63457196{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-634571a0{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-634571be{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-635dd196'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-63457146\"><p class=\"cl-6344d696\"><span class=\"cl-633379a0\">term</span></p></th><th class=\"cl-6345716e\"><p class=\"cl-6344d6c8\"><span class=\"cl-633379a0\">estimate</span></p></th><th class=\"cl-6345716e\"><p class=\"cl-6344d6c8\"><span class=\"cl-633379a0\">std.error</span></p></th><th class=\"cl-6345716e\"><p class=\"cl-6344d6c8\"><span class=\"cl-633379a0\">statistic</span></p></th><th class=\"cl-63457146\"><p class=\"cl-6344d696\"><span class=\"cl-633379a0\">p.value</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-63457182\"><p class=\"cl-6344d696\"><span class=\"cl-633379a0\">(Intercept)</span></p></td><td class=\"cl-63457196\"><p class=\"cl-6344d6c8\"><span class=\"cl-633379a0\">4.61654632</span></p></td><td class=\"cl-63457196\"><p class=\"cl-6344d6c8\"><span class=\"cl-633379a0\">0.028917686</span></p></td><td class=\"cl-63457196\"><p class=\"cl-6344d6c8\"><span class=\"cl-633379a0\">159.644388</span></p></td><td class=\"cl-63457182\"><p class=\"cl-6344d696\"><span class=\"cl-633379a0\">&lt;0.0001</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-634571a0\"><p class=\"cl-6344d696\"><span class=\"cl-633379a0\">salestax</span></p></td><td class=\"cl-634571be\"><p class=\"cl-6344d6c8\"><span class=\"cl-633379a0\">0.03072886</span></p></td><td class=\"cl-634571be\"><p class=\"cl-6344d6c8\"><span class=\"cl-633379a0\">0.004835432</span></p></td><td class=\"cl-634571be\"><p class=\"cl-6344d6c8\"><span class=\"cl-633379a0\">6.354935</span></p></td><td class=\"cl-634571a0\"><p class=\"cl-6344d696\"><span class=\"cl-633379a0\">&lt;0.0001</span></p></td></tr></tbody></table></div>\n```\n\n:::\n\n```{.r .cell-code}\n# store the fitted values from first stage\nlcigp_pred <- cig_s1$fitted.values\n```\n:::\n\n\nRun the second stage:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncig_s2 <- lm(log(c1995$packs) ~ lcigp_pred)\ncoeftest(cig_s2, vcov. = vcovHC) %>% broom::tidy() %>%\n  mutate(p.value = prettyunits::pretty_p_value(p.value)) %>%\n  flextable::flextable()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-63cb5d4c{}.cl-63a3f25c{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-63b71a8a{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-63b71abc{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-63b7ac20{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-63b7ac52{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-63b7ac66{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-63b7ac70{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-63b7ac8e{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-63b7ac98{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-63cb5d4c'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-63b7ac20\"><p class=\"cl-63b71a8a\"><span class=\"cl-63a3f25c\">term</span></p></th><th class=\"cl-63b7ac52\"><p class=\"cl-63b71abc\"><span class=\"cl-63a3f25c\">estimate</span></p></th><th class=\"cl-63b7ac52\"><p class=\"cl-63b71abc\"><span class=\"cl-63a3f25c\">std.error</span></p></th><th class=\"cl-63b7ac52\"><p class=\"cl-63b71abc\"><span class=\"cl-63a3f25c\">statistic</span></p></th><th class=\"cl-63b7ac20\"><p class=\"cl-63b71a8a\"><span class=\"cl-63a3f25c\">p.value</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-63b7ac66\"><p class=\"cl-63b71a8a\"><span class=\"cl-63a3f25c\">(Intercept)</span></p></td><td class=\"cl-63b7ac70\"><p class=\"cl-63b71abc\"><span class=\"cl-63a3f25c\">9.719877</span></p></td><td class=\"cl-63b7ac70\"><p class=\"cl-63b71abc\"><span class=\"cl-63a3f25c\">1.7030357</span></p></td><td class=\"cl-63b7ac70\"><p class=\"cl-63b71abc\"><span class=\"cl-63a3f25c\">5.707383</span></p></td><td class=\"cl-63b7ac66\"><p class=\"cl-63b71a8a\"><span class=\"cl-63a3f25c\">&lt;0.0001</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-63b7ac8e\"><p class=\"cl-63b71a8a\"><span class=\"cl-63a3f25c\">lcigp_pred</span></p></td><td class=\"cl-63b7ac98\"><p class=\"cl-63b71abc\"><span class=\"cl-63a3f25c\">-1.083587</span></p></td><td class=\"cl-63b7ac98\"><p class=\"cl-63b71abc\"><span class=\"cl-63a3f25c\">0.3556347</span></p></td><td class=\"cl-63b7ac98\"><p class=\"cl-63b71abc\"><span class=\"cl-63a3f25c\">-3.046910</span></p></td><td class=\"cl-63b7ac8e\"><p class=\"cl-63b71a8a\"><span class=\"cl-63a3f25c\">0.0038</span></p></td></tr></tbody></table></div>\n```\n\n:::\n:::\n\n\nThus estimating the model (@eq-tcigar) using TSLS yields \n\n$$\n\\begin{equation}\n  \\widehat{\\log(Q_i)} = \\underset{(1.70)}{9.72} - \\underset{(0.36)}{1.08} \\log(P_i)\n\\end{equation}\n$${\\#eq-ecigstsls}\n\nwhere we write $\\log(P_i)$ instead of $\\widehat{\\log(P_i)}$ for consistency. See\n`AER::ivreg()` for automatic IV regression.\n\n## The general IV regression model\n\nAn extension of simple IV regression to multiple predictors: \n\n$$\n\\begin{equation}\n  Y_i = \\beta_0 + \\beta_1 X_{1i} + \\dots + \\beta_k X_{ki} + \\beta_{k+1} W_{1i} + \\dots + \\beta_{k+r} W_{ri} + \\epsilon_i, \n\\end{equation}\n$${\\#eq-givmodel}\n\nwith $i=1,\\dots,n$ is the general instrumental variables regression model where\n\n- $Y_i$ is the dependent variable,\n\n- $\\\\beta_0,\\dots,\\beta_{k+1}$ are $1+k+r$ unknown regression coefficients,\n\n- $X_{1i},\\dots,X_{ki}$ are $k$ endogenous regressors ,\n\n- $W_{1i},\\dots,W_{ri}$ are $r$ exogenous regressors which are uncorrelated with $u_i$,\n\n- $\\epsilon_i$ is the error term,\n\n- $Z_{1i},\\dots,Z_{mi}$ are $m$ instrumental variables.\n\nThe coefficients are overidentified if $m>k$. If $m<k$, the coefficients are underidentified and when $m=k$ they are exactly identified. For estimation of the IV regression model we require exact identification or overidentification. The computations can be autometed with `AER::ivreg()` function.\n\nSuppose we wish to estimate the model $Y_i = \\beta_0 + \\beta_1X_{1i} + \\beta_2X_{2i} + W_{1i} + \\epsilon_i$,\nwhere $X_{1i}$ and $X_{2i}$ are endogenous variables instrumented by $Z_{1i}$ and $Z_{2i}$ respectively, and $W_{1i}$ is an exogenous variable, a correct model specification involves listing all exogenous variables as\ninstruments too by joining them with `+`s on the right of the vertical bar `|`:\n\n`y ~ X1 + X2 + W1 | W1 + Z1 + Z2`. A convenient way of specifying a model is\nupdating a formula using `.` (which includes all variables except for the outcome).\nFor instance, if we have one exogenous regressor $w1$\nand one endogenous regrossor $x1$ with instrument $z1$, the appropriate formula\nwould be `y ~ w1 + x1 | w1 + z1` $=$ `y ~ w1 + x1 | . ~ x1 + z1`.\n\nSome assumptions underlying the IV regression are:\n\n1. $E(\\epsilon_i|W_{1i}, \\dots, W_{ri}) = 0$\n2. $(X_{1i}, \\dots, X_{ki}, W_{1i}, \\dots, W_{ri}, Z_{1i}, \\dots, Z_{mi})$ are i.i.d draws from their joint distribution\n3. All variables have nonzero finite fourth moment, i.e., outliers are unlikely\n4. The $Z_s$ are valid instruments.\n\n### Example: Demands for cigarettes\n\nWe update (@eq-tcigar) to include income:\n\n\n$$\n\\begin{equation}\nlog(Q_i) = \\beta_0 + \\beta_1 log(P_i) + \\beta_2 log(income_i) +  \\epsilon_i\n\\end{equation}\n$${\\#eq-ticigar}\n\nwhere income is defined as real per capita income.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# add rincome to the dataset\nCigarettesSW$rincome <- with(CigarettesSW, income / population / cpi)\n\nc1995 <- subset(CigarettesSW, year == \"1995\")\n\n# estimate the model\ncig_ivreg2 <- ivreg(log(packs) ~ log(rprice) + log(rincome) | log(rincome) + \n                    salestax, data = c1995)\n\ncoeftest(cig_ivreg2, vcov = vcovHC, type = \"HC1\") %>%\n  broom::tidy() %>%\n  mutate(p.value = prettyunits::pretty_p_value(p.value)) %>%\n  flextable::flextable()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-642ca480{}.cl-640b2562{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-641aec36{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-641aec68{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-641b9532{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-641b9578{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-641b958c{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-641b9596{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-641b95aa{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-641b95be{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-642ca480'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-641b9532\"><p class=\"cl-641aec36\"><span class=\"cl-640b2562\">term</span></p></th><th class=\"cl-641b9578\"><p class=\"cl-641aec68\"><span class=\"cl-640b2562\">estimate</span></p></th><th class=\"cl-641b9578\"><p class=\"cl-641aec68\"><span class=\"cl-640b2562\">std.error</span></p></th><th class=\"cl-641b9578\"><p class=\"cl-641aec68\"><span class=\"cl-640b2562\">statistic</span></p></th><th class=\"cl-641b9532\"><p class=\"cl-641aec36\"><span class=\"cl-640b2562\">p.value</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-641b958c\"><p class=\"cl-641aec36\"><span class=\"cl-640b2562\">(Intercept)</span></p></td><td class=\"cl-641b9596\"><p class=\"cl-641aec68\"><span class=\"cl-640b2562\">9.4306583</span></p></td><td class=\"cl-641b9596\"><p class=\"cl-641aec68\"><span class=\"cl-640b2562\">1.2593926</span></p></td><td class=\"cl-641b9596\"><p class=\"cl-641aec68\"><span class=\"cl-640b2562\">7.4882595</span></p></td><td class=\"cl-641b958c\"><p class=\"cl-641aec36\"><span class=\"cl-640b2562\">&lt;0.0001</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-641b958c\"><p class=\"cl-641aec36\"><span class=\"cl-640b2562\">log(rprice)</span></p></td><td class=\"cl-641b9596\"><p class=\"cl-641aec68\"><span class=\"cl-640b2562\">-1.1433751</span></p></td><td class=\"cl-641b9596\"><p class=\"cl-641aec68\"><span class=\"cl-640b2562\">0.3723027</span></p></td><td class=\"cl-641b9596\"><p class=\"cl-641aec68\"><span class=\"cl-640b2562\">-3.0710902</span></p></td><td class=\"cl-641b958c\"><p class=\"cl-641aec36\"><span class=\"cl-640b2562\">0.0036</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-641b95aa\"><p class=\"cl-641aec36\"><span class=\"cl-640b2562\">log(rincome)</span></p></td><td class=\"cl-641b95be\"><p class=\"cl-641aec68\"><span class=\"cl-640b2562\">0.2145153</span></p></td><td class=\"cl-641b95be\"><p class=\"cl-641aec68\"><span class=\"cl-640b2562\">0.3117469</span></p></td><td class=\"cl-641b95be\"><p class=\"cl-641aec68\"><span class=\"cl-640b2562\">0.6881071</span></p></td><td class=\"cl-641b95aa\"><p class=\"cl-641aec36\"><span class=\"cl-640b2562\">0.4949</span></p></td></tr></tbody></table></div>\n```\n\n:::\n:::\n\n\nWe obtain \n\n$$\n\\begin{equation}\n  \\widehat{\\log(Q_i)} = \\underset{(1.26)}{9.43} - \\underset{(0.37)}{1.14} \\log(P_i) + \\underset{(0.31)}{0.21} \\log(income_i)\n\\end{equation}\n$${\\#eq-eicigstsls}\n\n\nAdding salestax as an IV:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# add cigtax to the data set\nCigarettesSW$cigtax <- with(CigarettesSW, tax/cpi)\n\nc1995 <- subset(CigarettesSW, year == \"1995\")\n\n# estimate the model\ncig_ivreg3 <- ivreg(log(packs) ~ log(rprice) + log(rincome) | \n                    log(rincome) + salestax + cigtax, data = c1995)\n\ncoeftest(cig_ivreg3, vcov = vcovHC, type = \"HC1\") %>% \n  broom::tidy() %>%\n  mutate(p.value = prettyunits::pretty_p_value(p.value)) %>%\n  flextable::flextable()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-648d380e{}.cl-646c82d0{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-647aa22a{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-647aa25c{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-647b3852{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-647b387a{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-647b3884{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-647b3898{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-647b38a2{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-647b38ac{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-648d380e'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-647b3852\"><p class=\"cl-647aa22a\"><span class=\"cl-646c82d0\">term</span></p></th><th class=\"cl-647b387a\"><p class=\"cl-647aa25c\"><span class=\"cl-646c82d0\">estimate</span></p></th><th class=\"cl-647b387a\"><p class=\"cl-647aa25c\"><span class=\"cl-646c82d0\">std.error</span></p></th><th class=\"cl-647b387a\"><p class=\"cl-647aa25c\"><span class=\"cl-646c82d0\">statistic</span></p></th><th class=\"cl-647b3852\"><p class=\"cl-647aa22a\"><span class=\"cl-646c82d0\">p.value</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-647b3884\"><p class=\"cl-647aa22a\"><span class=\"cl-646c82d0\">(Intercept)</span></p></td><td class=\"cl-647b3898\"><p class=\"cl-647aa25c\"><span class=\"cl-646c82d0\">9.8949555</span></p></td><td class=\"cl-647b3898\"><p class=\"cl-647aa25c\"><span class=\"cl-646c82d0\">0.9592169</span></p></td><td class=\"cl-647b3898\"><p class=\"cl-647aa25c\"><span class=\"cl-646c82d0\">10.315660</span></p></td><td class=\"cl-647b3884\"><p class=\"cl-647aa22a\"><span class=\"cl-646c82d0\">&lt;0.0001</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-647b3884\"><p class=\"cl-647aa22a\"><span class=\"cl-646c82d0\">log(rprice)</span></p></td><td class=\"cl-647b3898\"><p class=\"cl-647aa25c\"><span class=\"cl-646c82d0\">-1.2774241</span></p></td><td class=\"cl-647b3898\"><p class=\"cl-647aa25c\"><span class=\"cl-646c82d0\">0.2496100</span></p></td><td class=\"cl-647b3898\"><p class=\"cl-647aa25c\"><span class=\"cl-646c82d0\">-5.117680</span></p></td><td class=\"cl-647b3884\"><p class=\"cl-647aa22a\"><span class=\"cl-646c82d0\">&lt;0.0001</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-647b38a2\"><p class=\"cl-647aa22a\"><span class=\"cl-646c82d0\">log(rincome)</span></p></td><td class=\"cl-647b38ac\"><p class=\"cl-647aa25c\"><span class=\"cl-646c82d0\">0.2804048</span></p></td><td class=\"cl-647b38ac\"><p class=\"cl-647aa25c\"><span class=\"cl-646c82d0\">0.2538897</span></p></td><td class=\"cl-647b38ac\"><p class=\"cl-647aa25c\"><span class=\"cl-646c82d0\">1.104436</span></p></td><td class=\"cl-647b38a2\"><p class=\"cl-647aa22a\"><span class=\"cl-646c82d0\">0.2753</span></p></td></tr></tbody></table></div>\n```\n\n:::\n:::\n\n\n$$\n\\begin{equation}\n  \\widehat{\\log(Q_i)} = \\underset{(0.96)}{9.89} - \\underset{(0.25)}{1.28} \\log(P_i) + \\underset{(0.25)}{0.28} \\log(income_i)\n\\end{equation}\n$${\\#eq-eicigstsls-2}\n\nA question then arises on which estimates to trust. One could argue that the \nestimates from (@eq-eicigstsls-2) are more trustworthy due to the lower standard\nerrors compared to (@eq-eicigstsls). This is the subject considered under instrument \nvalidity.\n\n## Checking instrument validity\n\n1. **Weak instrument**: To check for a weak instrument, compute the $F$-statistic\ncorresponding to the hypothesis $H_0: Z_1 = \\dots Z_m = 0$. A rule of thumb is\nthat an $F$-statistic less than 10 imply weak instruments. If your instruments\nare weak, you can discard them and find better instruments or stick with them\nbut find methods that improve TSLS.\n2. **Instrument exogeneity assumption is not met**: When we observe a correlation\nbetween an instrument and the error term, the IV regression is not consistent. \nOveridentifying restriction test (J-test) is used to test that additional instruments\nare exogenous. It follows $\\chi^2_{m -k}$ (under homoscedasticity), where $m$ is the number of instruments\nand $k$ the number of endogenous regressors. It involves regressing the error term\non all instruments and endogenous variables:\n\n$$\n\\begin{equation}\n\\hat{\\epsilon}^{TSLS} = \\delta_0 + \\delta_1Z_{1i} + \\dots + \\delta_mZ_{mi} +\n\\delta_{m+1}W_{1i} + \\dots + \\delta_{m+r}W_{ri} + e_i\n\\end{equation}\n$${\\#eq-jstat}\n\nand testing whether all instruments are exogenous through the joint hypothesis\n$H_0: \\delta_1 = 0, \\dots, \\delta_m = 0$, and computing the statistic $J = mF$.\n(see <https://www.econometrics-with-r.org/12.4-attdfc.html>)\n\n\n### Example: Demand for cigarettes\n\nWe assess whether general sales tax and the cigarette-specific tax are valid\ninstruments. It could be argued that tobacco growing states find economic importance\nin lower tobacco taxes and may lobby for them staying low. It may also be possible\nthat tobacco growing states have higher rates of smoking than others, which would \nlead to endogeneity of cigarette-specific taxes. This can only be solved by including\ndata on the size of the tobacco and cigarette industry into the regression, which is\nnot available in this case.\n\nIt can be assumed that the role of tobacco and cigarette industry differs across\nstates, but not across time. We can then exploit the panel structure of the data\nat two different time periods (1985, 1995) to estimate the *long-run elasticity*\nof the demand for cigarettes:\n\n$$\n\\begin{equation}\nlog(Q_{i, 1995}) - log(Q_{i, 1985}) = \\beta_0 + \\beta_1[log(P_{i, 1995}) -\nlog(P_{i, 1985})] + \\beta_2[log(income_{i, 1995}) - log(income_{i, 1985})] + \\epsilon_i\n\\end{equation}\n$${\\#eq-elas}\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# subset data for year 1985\nc1985 <- subset(CigarettesSW, year == \"1985\")\n\n# define differences in variables\npacksdiff <- log(c1995$packs) - log(c1985$packs)\n\npricediff <- log(c1995$price/c1995$cpi) - log(c1985$price/c1985$cpi)\n\nincomediff <- log(c1995$income/c1995$population/c1995$cpi) -\nlog(c1985$income/c1985$population/c1985$cpi)\n\nsalestaxdiff <- (c1995$taxs - c1995$tax)/c1995$cpi - \n                                  (c1985$taxs - c1985$tax)/c1985$cpi\n\ncigtaxdiff <- c1995$tax/c1995$cpi - c1985$tax/c1985$cpi\n```\n:::\n\n\nWe then perform 3 different IV estimations using `ivreg()`for differences between\n1985, 1995:\n\n1. TSLS using only the difference in sales taxes as the IV \n2. TSLS using only difference in cigarette-specific taxes\n3. TSLS using both differences in sales taxes and cigarette-specific taxes\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# estimating the 3 models\ncig_ivreg_diff1 <- ivreg(\n  packsdiff ~ pricediff + incomediff | incomediff + salestaxdiff\n)\n\ncig_ivreg_diff2 <- cig_ivreg_diff1 <- ivreg(\n  packsdiff ~ pricediff + incomediff | incomediff + cigtaxdiff\n)\n\ncig_ivreg_diff3 <- cig_ivreg_diff1 <- ivreg(\n  packsdiff ~ pricediff + incomediff | incomediff + salestaxdiff + cigtaxdiff\n)\n```\n:::\n\n\nSales tax as IV\n\n\n::: {#tbl-sltx .cell tbl-cap='Difference in sales tax as IV'}\n\n```{.r .cell-code}\ncoeftest(cig_ivreg_diff1, vcov. = vcovHC, type = \"HC1\") %>%\n  render_summary()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-650f5b4a{}.cl-64ec6770{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-64f9c46a{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-64f9c4a6{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-64fa48f4{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-64fa4912{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-64fa491c{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-64fa4926{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-64fa4930{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-64fa493a{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-650f5b4a'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-64fa48f4\"><p class=\"cl-64f9c46a\"><span class=\"cl-64ec6770\">term</span></p></th><th class=\"cl-64fa4912\"><p class=\"cl-64f9c4a6\"><span class=\"cl-64ec6770\">estimate</span></p></th><th class=\"cl-64fa4912\"><p class=\"cl-64f9c4a6\"><span class=\"cl-64ec6770\">std.error</span></p></th><th class=\"cl-64fa4912\"><p class=\"cl-64f9c4a6\"><span class=\"cl-64ec6770\">statistic</span></p></th><th class=\"cl-64fa48f4\"><p class=\"cl-64f9c46a\"><span class=\"cl-64ec6770\">p.value</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-64fa491c\"><p class=\"cl-64f9c46a\"><span class=\"cl-64ec6770\">(Intercept)</span></p></td><td class=\"cl-64fa4926\"><p class=\"cl-64f9c4a6\"><span class=\"cl-64ec6770\">-0.052</span></p></td><td class=\"cl-64fa4926\"><p class=\"cl-64f9c4a6\"><span class=\"cl-64ec6770\">0.062</span></p></td><td class=\"cl-64fa4926\"><p class=\"cl-64f9c4a6\"><span class=\"cl-64ec6770\">-0.832</span></p></td><td class=\"cl-64fa491c\"><p class=\"cl-64f9c46a\"><span class=\"cl-64ec6770\">0.4097</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-64fa491c\"><p class=\"cl-64f9c46a\"><span class=\"cl-64ec6770\">pricediff</span></p></td><td class=\"cl-64fa4926\"><p class=\"cl-64f9c4a6\"><span class=\"cl-64ec6770\">-1.202</span></p></td><td class=\"cl-64fa4926\"><p class=\"cl-64f9c4a6\"><span class=\"cl-64ec6770\">0.197</span></p></td><td class=\"cl-64fa4926\"><p class=\"cl-64f9c4a6\"><span class=\"cl-64ec6770\">-6.105</span></p></td><td class=\"cl-64fa491c\"><p class=\"cl-64f9c46a\"><span class=\"cl-64ec6770\">&lt;0.0001</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-64fa4930\"><p class=\"cl-64f9c46a\"><span class=\"cl-64ec6770\">incomediff</span></p></td><td class=\"cl-64fa493a\"><p class=\"cl-64f9c4a6\"><span class=\"cl-64ec6770\">0.462</span></p></td><td class=\"cl-64fa493a\"><p class=\"cl-64f9c4a6\"><span class=\"cl-64ec6770\">0.309</span></p></td><td class=\"cl-64fa493a\"><p class=\"cl-64f9c4a6\"><span class=\"cl-64ec6770\">1.494</span></p></td><td class=\"cl-64fa4930\"><p class=\"cl-64f9c46a\"><span class=\"cl-64ec6770\">0.1423</span></p></td></tr></tbody></table></div>\n```\n\n:::\n:::\n\n\nCigarette-specific tax as IV\n\n\n::: {#tbl-cigtx .cell tbl-cap='Cigarette-specific tax as IV'}\n\n```{.r .cell-code}\ncoeftest(cig_ivreg_diff2, vcov. = vcovHC, type = \"HC1\") %>% \n  render_summary()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-6573442a{}.cl-65507d14{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-655f7760{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-655f7792{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-65600af4{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-65600b26{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-65600b3a{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-65600b44{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-65600b58{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-65600b62{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-6573442a'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-65600af4\"><p class=\"cl-655f7760\"><span class=\"cl-65507d14\">term</span></p></th><th class=\"cl-65600b26\"><p class=\"cl-655f7792\"><span class=\"cl-65507d14\">estimate</span></p></th><th class=\"cl-65600b26\"><p class=\"cl-655f7792\"><span class=\"cl-65507d14\">std.error</span></p></th><th class=\"cl-65600b26\"><p class=\"cl-655f7792\"><span class=\"cl-65507d14\">statistic</span></p></th><th class=\"cl-65600af4\"><p class=\"cl-655f7760\"><span class=\"cl-65507d14\">p.value</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-65600b3a\"><p class=\"cl-655f7760\"><span class=\"cl-65507d14\">(Intercept)</span></p></td><td class=\"cl-65600b44\"><p class=\"cl-655f7792\"><span class=\"cl-65507d14\">-0.017</span></p></td><td class=\"cl-65600b44\"><p class=\"cl-655f7792\"><span class=\"cl-65507d14\">0.067</span></p></td><td class=\"cl-65600b44\"><p class=\"cl-655f7792\"><span class=\"cl-65507d14\">-0.254</span></p></td><td class=\"cl-65600b3a\"><p class=\"cl-655f7760\"><span class=\"cl-65507d14\">0.8009</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-65600b3a\"><p class=\"cl-655f7760\"><span class=\"cl-65507d14\">pricediff</span></p></td><td class=\"cl-65600b44\"><p class=\"cl-655f7792\"><span class=\"cl-65507d14\">-1.343</span></p></td><td class=\"cl-65600b44\"><p class=\"cl-655f7792\"><span class=\"cl-65507d14\">0.229</span></p></td><td class=\"cl-65600b44\"><p class=\"cl-655f7792\"><span class=\"cl-65507d14\">-5.871</span></p></td><td class=\"cl-65600b3a\"><p class=\"cl-655f7760\"><span class=\"cl-65507d14\">&lt;0.0001</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-65600b58\"><p class=\"cl-655f7760\"><span class=\"cl-65507d14\">incomediff</span></p></td><td class=\"cl-65600b62\"><p class=\"cl-655f7792\"><span class=\"cl-65507d14\">0.428</span></p></td><td class=\"cl-65600b62\"><p class=\"cl-655f7792\"><span class=\"cl-65507d14\">0.299</span></p></td><td class=\"cl-65600b62\"><p class=\"cl-655f7792\"><span class=\"cl-65507d14\">1.433</span></p></td><td class=\"cl-65600b58\"><p class=\"cl-655f7760\"><span class=\"cl-65507d14\">0.1587</span></p></td></tr></tbody></table></div>\n```\n\n:::\n:::\n\n\nBoth sales tax and cigarette-specific tax as IV\n\n\n::: {#tbl-both .cell tbl-cap='Both sales tax and cigarette-specific tax as IV'}\n\n```{.r .cell-code}\ncoeftest(cig_ivreg_diff3, vcov. = vcovHC, type = \"HC1\") %>%\n  render_summary()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-65d0b9e8{}.cl-65aff3e8{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-65bf1e54{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-65bf1e86{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-65bfbdfa{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-65bfbe22{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-65bfbe23{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-65bfbe36{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-65bfbe40{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-65bfbe54{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-65d0b9e8'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-65bfbdfa\"><p class=\"cl-65bf1e54\"><span class=\"cl-65aff3e8\">term</span></p></th><th class=\"cl-65bfbe22\"><p class=\"cl-65bf1e86\"><span class=\"cl-65aff3e8\">estimate</span></p></th><th class=\"cl-65bfbe22\"><p class=\"cl-65bf1e86\"><span class=\"cl-65aff3e8\">std.error</span></p></th><th class=\"cl-65bfbe22\"><p class=\"cl-65bf1e86\"><span class=\"cl-65aff3e8\">statistic</span></p></th><th class=\"cl-65bfbdfa\"><p class=\"cl-65bf1e54\"><span class=\"cl-65aff3e8\">p.value</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-65bfbe23\"><p class=\"cl-65bf1e54\"><span class=\"cl-65aff3e8\">(Intercept)</span></p></td><td class=\"cl-65bfbe36\"><p class=\"cl-65bf1e86\"><span class=\"cl-65aff3e8\">-0.052</span></p></td><td class=\"cl-65bfbe36\"><p class=\"cl-65bf1e86\"><span class=\"cl-65aff3e8\">0.062</span></p></td><td class=\"cl-65bfbe36\"><p class=\"cl-65bf1e86\"><span class=\"cl-65aff3e8\">-0.832</span></p></td><td class=\"cl-65bfbe23\"><p class=\"cl-65bf1e54\"><span class=\"cl-65aff3e8\">0.4097</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-65bfbe23\"><p class=\"cl-65bf1e54\"><span class=\"cl-65aff3e8\">pricediff</span></p></td><td class=\"cl-65bfbe36\"><p class=\"cl-65bf1e86\"><span class=\"cl-65aff3e8\">-1.202</span></p></td><td class=\"cl-65bfbe36\"><p class=\"cl-65bf1e86\"><span class=\"cl-65aff3e8\">0.197</span></p></td><td class=\"cl-65bfbe36\"><p class=\"cl-65bf1e86\"><span class=\"cl-65aff3e8\">-6.105</span></p></td><td class=\"cl-65bfbe23\"><p class=\"cl-65bf1e54\"><span class=\"cl-65aff3e8\">&lt;0.0001</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-65bfbe40\"><p class=\"cl-65bf1e54\"><span class=\"cl-65aff3e8\">incomediff</span></p></td><td class=\"cl-65bfbe54\"><p class=\"cl-65bf1e86\"><span class=\"cl-65aff3e8\">0.462</span></p></td><td class=\"cl-65bfbe54\"><p class=\"cl-65bf1e86\"><span class=\"cl-65aff3e8\">0.309</span></p></td><td class=\"cl-65bfbe54\"><p class=\"cl-65bf1e86\"><span class=\"cl-65aff3e8\">1.494</span></p></td><td class=\"cl-65bfbe40\"><p class=\"cl-65bf1e54\"><span class=\"cl-65aff3e8\">0.1423</span></p></td></tr></tbody></table></div>\n```\n\n:::\n:::\n\n\nA tabulated summary\n\n\n::: {#tbl-iv-comparison .cell tbl-cap='Dependent Variable: 1985-1995 Difference in Log per Pack Price'}\n\n```{.r .cell-code}\n# 1. Define the models in a named list (this replaces column.labels)\nmodels <- list(\n  \"IV: salestax\" = cig_ivreg_diff1,\n  \"IV: cigtax\"   = cig_ivreg_diff2,\n  \"IVs: salestax, cigtax\" = cig_ivreg_diff3\n)\n\n# Define which Goodness-of-Fit stats to show and what to call them\ngm <- list(\n  list(\"raw\" = \"nobs\", \"clean\" = \"Observations\", \"fmt\" = 0),\n  list(\"raw\" = \"r.squared\", \"clean\" = \"R2\", \"fmt\" = 3),\n  list(\"raw\" = \"adj.r.squared\", \"clean\" = \"Adj. R2\", \"fmt\" = 3)\n)\n\n# 2. Define standard errors\n# Note: modelsummary can calculate HC1 automatically, \n# but since you already have 'rob_se', we can pass it directly.\nrob_se_list <- list(\n  sqrt(diag(vcovHC(cig_ivreg_diff1, type = \"HC1\"))),\n  sqrt(diag(vcovHC(cig_ivreg_diff2, type = \"HC1\"))),\n  sqrt(diag(vcovHC(cig_ivreg_diff3, type = \"HC1\")))\n)\n\n# 3. Generate the table\nmodelsummary(\n  models,\n  vcov = rob_se_list,        # Applies your robust SEs\n  output = \"flextable\",      # Outputs as a flextable object\n  fmt = 3,                   # 3 decimal places\n  stars = TRUE,              # Significance stars (optional)\n  gof_map = gm # Clean up GOF statistics\n) |> \n  autofit() |> \n  theme_vanilla()   %>%         # Clean academic style\n# This command removes any remaining horizontal lines inside the body\n  border_inner_h(part = \"body\", border = officer::fp_border(width = 0))\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-682cc880{}.cl-680d89b6{font-family:'DejaVu Sans';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-680d89e8{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-681ae4a8{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-681b794a{width:1.295in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7972{width:1.168in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b797c{width:1.007in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7986{width:1.812in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7990{width:1.295in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b79a4{width:1.168in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b79ae{width:1.007in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b79b8{width:1.812in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b79c2{width:1.295in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b79cc{width:1.168in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b79d6{width:1.007in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b79e0{width:1.812in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b79ea{width:1.295in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b79f4{width:1.168in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b79fe{width:1.007in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7a08{width:1.812in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7a1c{width:1.295in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7a30{width:1.168in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7a3a{width:1.007in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7a44{width:1.812in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7a58{width:1.295in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7a62{width:1.168in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7a6c{width:1.007in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7a76{width:1.812in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7a80{width:1.295in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7a81{width:1.168in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7a8a{width:1.007in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7a9e{width:1.812in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7aa8{width:1.295in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7ab2{width:1.168in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7abc{width:1.007in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-681b7ad0{width:1.812in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-682cc880'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-681b794a\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89b6\"> </span></p></th><th class=\"cl-681b7972\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89b6\">IV: salestax</span></p></th><th class=\"cl-681b797c\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89b6\">IV: cigtax</span></p></th><th class=\"cl-681b7986\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89b6\">IVs: salestax, cigtax</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-681b7990\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89e8\">(Intercept)</span></p></td><td class=\"cl-681b79a4\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89e8\">-0.052</span></p></td><td class=\"cl-681b79ae\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89e8\">-0.017</span></p></td><td class=\"cl-681b79b8\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89e8\">-0.052</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-681b79c2\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89e8\"></span></p></td><td class=\"cl-681b79cc\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89e8\">(0.062)</span></p></td><td class=\"cl-681b79d6\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89e8\">(0.067)</span></p></td><td class=\"cl-681b79e0\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89e8\">(0.062)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-681b79ea\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89e8\">pricediff</span></p></td><td class=\"cl-681b79f4\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89e8\">-1.202***</span></p></td><td class=\"cl-681b79fe\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89e8\">-1.343***</span></p></td><td class=\"cl-681b7a08\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89e8\">-1.202***</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-681b79c2\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89e8\"></span></p></td><td class=\"cl-681b79cc\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89e8\">(0.197)</span></p></td><td class=\"cl-681b79d6\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89e8\">(0.229)</span></p></td><td class=\"cl-681b79e0\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89e8\">(0.197)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-681b7a1c\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89e8\">incomediff</span></p></td><td class=\"cl-681b7a30\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89e8\">0.462</span></p></td><td class=\"cl-681b7a3a\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89e8\">0.428</span></p></td><td class=\"cl-681b7a44\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89e8\">0.462</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-681b79c2\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89e8\"></span></p></td><td class=\"cl-681b79cc\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89e8\">(0.309)</span></p></td><td class=\"cl-681b79d6\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89e8\">(0.299)</span></p></td><td class=\"cl-681b79e0\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89e8\">(0.309)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-681b7a1c\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89e8\">Observations</span></p></td><td class=\"cl-681b7a30\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89e8\">48</span></p></td><td class=\"cl-681b7a3a\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89e8\">48</span></p></td><td class=\"cl-681b7a44\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89e8\">48</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-681b7a58\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89e8\">R2</span></p></td><td class=\"cl-681b7a62\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89e8\">0.547</span></p></td><td class=\"cl-681b7a6c\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89e8\">0.520</span></p></td><td class=\"cl-681b7a76\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89e8\">0.547</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-681b7a80\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89e8\">Adj. R2</span></p></td><td class=\"cl-681b7a81\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89e8\">0.526</span></p></td><td class=\"cl-681b7a8a\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89e8\">0.498</span></p></td><td class=\"cl-681b7a9e\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89e8\">0.526</span></p></td></tr></tbody><tfoot><tr style=\"overflow-wrap:break-word;\"><td  colspan=\"4\"class=\"cl-681b7aa8\"><p class=\"cl-681ae4a8\"><span class=\"cl-680d89e8\">+ p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001</span></p></td></tr></tfoot></table></div>\n```\n\n:::\n:::\n\n\nWe observe negative estimates for `pricediff` that differ when `cigtax` is used \nas IV. We proceed to test the validity of the instruments by computing F-statistics\nfor the first-stage regressions.\n\n\n::: {#tbl-ivrel .cell tbl-cap='Test IV relevance by an F-test. All the F-statistics are significantly different from zero'}\n\n```{.r .cell-code}\n# first-stage regressions\nmod_relevance1 <- lm(pricediff ~ salestaxdiff + incomediff)\nmod_relevance2 <- lm(pricediff ~ cigtaxdiff + incomediff)\nmod_relevance3 <- lm(pricediff ~ incomediff + salestaxdiff + cigtaxdiff)\n\n# check instrument relevance\n\nmods <- list(mod_relevance1, mod_relevance2, mod_relevance3)\nnames(mods) <- c(\"salestax\", \"cigartax\", \"both\")\nhyp <- list(\"salestaxdiff = 0\", \"cigtaxdiff = 0\", c(\"salestaxdiff = 0\", \"cigtaxdiff = 0\"))\n\niv_tests <- map2(\n  mods, hyp, \\(m, h){\n    linearHypothesis(m, h, vcov. = vcovHC(m, type = \"HC1\"))\n  }\n) \n\n iv_tests |>\n  map_dfr(broom::tidy, .id = \"model\") %>% \n   mutate(p.value = prettyunits::pretty_p_value(p.value)) %>%\n   mutate(\n     across(where(is.numeric), ~ round(., 3))\n   ) %>% \n   flextable()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-68a49360{}.cl-68922680{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-6899112a{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-68991148{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-68995a86{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-68995a9a{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-68995aa4{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-68995aae{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-68995aaf{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-68995ac2{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-68a49360'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-68995a86\"><p class=\"cl-6899112a\"><span class=\"cl-68922680\">model</span></p></th><th class=\"cl-68995a86\"><p class=\"cl-6899112a\"><span class=\"cl-68922680\">term</span></p></th><th class=\"cl-68995a9a\"><p class=\"cl-68991148\"><span class=\"cl-68922680\">null.value</span></p></th><th class=\"cl-68995a9a\"><p class=\"cl-68991148\"><span class=\"cl-68922680\">estimate</span></p></th><th class=\"cl-68995a9a\"><p class=\"cl-68991148\"><span class=\"cl-68922680\">std.error</span></p></th><th class=\"cl-68995a9a\"><p class=\"cl-68991148\"><span class=\"cl-68922680\">statistic</span></p></th><th class=\"cl-68995a86\"><p class=\"cl-6899112a\"><span class=\"cl-68922680\">p.value</span></p></th><th class=\"cl-68995a9a\"><p class=\"cl-68991148\"><span class=\"cl-68922680\">df.residual</span></p></th><th class=\"cl-68995a9a\"><p class=\"cl-68991148\"><span class=\"cl-68922680\">df</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-68995aa4\"><p class=\"cl-6899112a\"><span class=\"cl-68922680\">salestax</span></p></td><td class=\"cl-68995aa4\"><p class=\"cl-6899112a\"><span class=\"cl-68922680\">salestaxdiff</span></p></td><td class=\"cl-68995aae\"><p class=\"cl-68991148\"><span class=\"cl-68922680\">0</span></p></td><td class=\"cl-68995aae\"><p class=\"cl-68991148\"><span class=\"cl-68922680\">0.025</span></p></td><td class=\"cl-68995aae\"><p class=\"cl-68991148\"><span class=\"cl-68922680\">0.004</span></p></td><td class=\"cl-68995aae\"><p class=\"cl-68991148\"><span class=\"cl-68922680\">33.674</span></p></td><td class=\"cl-68995aa4\"><p class=\"cl-6899112a\"><span class=\"cl-68922680\">&lt;0.0001</span></p></td><td class=\"cl-68995aae\"><p class=\"cl-68991148\"><span class=\"cl-68922680\">45</span></p></td><td class=\"cl-68995aae\"><p class=\"cl-68991148\"><span class=\"cl-68922680\">1</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-68995aa4\"><p class=\"cl-6899112a\"><span class=\"cl-68922680\">cigartax</span></p></td><td class=\"cl-68995aa4\"><p class=\"cl-6899112a\"><span class=\"cl-68922680\">cigtaxdiff</span></p></td><td class=\"cl-68995aae\"><p class=\"cl-68991148\"><span class=\"cl-68922680\">0</span></p></td><td class=\"cl-68995aae\"><p class=\"cl-68991148\"><span class=\"cl-68922680\">0.010</span></p></td><td class=\"cl-68995aae\"><p class=\"cl-68991148\"><span class=\"cl-68922680\">0.001</span></p></td><td class=\"cl-68995aae\"><p class=\"cl-68991148\"><span class=\"cl-68922680\">107.183</span></p></td><td class=\"cl-68995aa4\"><p class=\"cl-6899112a\"><span class=\"cl-68922680\">&lt;0.0001</span></p></td><td class=\"cl-68995aae\"><p class=\"cl-68991148\"><span class=\"cl-68922680\">45</span></p></td><td class=\"cl-68995aae\"><p class=\"cl-68991148\"><span class=\"cl-68922680\">1</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-68995aa4\"><p class=\"cl-6899112a\"><span class=\"cl-68922680\">both</span></p></td><td class=\"cl-68995aa4\"><p class=\"cl-6899112a\"><span class=\"cl-68922680\">salestaxdiff</span></p></td><td class=\"cl-68995aae\"><p class=\"cl-68991148\"><span class=\"cl-68922680\">0</span></p></td><td class=\"cl-68995aae\"><p class=\"cl-68991148\"><span class=\"cl-68922680\">0.013</span></p></td><td class=\"cl-68995aae\"><p class=\"cl-68991148\"><span class=\"cl-68922680\">0.003</span></p></td><td class=\"cl-68995aae\"><p class=\"cl-68991148\"><span class=\"cl-68922680\">88.616</span></p></td><td class=\"cl-68995aa4\"><p class=\"cl-6899112a\"><span class=\"cl-68922680\">&lt;0.0001</span></p></td><td class=\"cl-68995aae\"><p class=\"cl-68991148\"><span class=\"cl-68922680\">44</span></p></td><td class=\"cl-68995aae\"><p class=\"cl-68991148\"><span class=\"cl-68922680\">2</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-68995aaf\"><p class=\"cl-6899112a\"><span class=\"cl-68922680\">both</span></p></td><td class=\"cl-68995aaf\"><p class=\"cl-6899112a\"><span class=\"cl-68922680\">cigtaxdiff</span></p></td><td class=\"cl-68995ac2\"><p class=\"cl-68991148\"><span class=\"cl-68922680\">0</span></p></td><td class=\"cl-68995ac2\"><p class=\"cl-68991148\"><span class=\"cl-68922680\">0.008</span></p></td><td class=\"cl-68995ac2\"><p class=\"cl-68991148\"><span class=\"cl-68922680\">0.001</span></p></td><td class=\"cl-68995ac2\"><p class=\"cl-68991148\"><span class=\"cl-68922680\">88.616</span></p></td><td class=\"cl-68995aaf\"><p class=\"cl-6899112a\"><span class=\"cl-68922680\">&lt;0.0001</span></p></td><td class=\"cl-68995ac2\"><p class=\"cl-68991148\"><span class=\"cl-68922680\">44</span></p></td><td class=\"cl-68995ac2\"><p class=\"cl-68991148\"><span class=\"cl-68922680\">2</span></p></td></tr></tbody></table></div>\n```\n\n:::\n:::\n\n\nNext we conduct overidentifying restriction test for model with both sales tax and \ncigatax as IV which is the only model where the coefficient on the difference in\nlog prices is overidentified ($m = 2, k=1$) making it possible to compute the $J$\nstatistic. To achive this, we regress the residuals from `cig_ivreg_diff3` on the\nIVs and the presumed exogenous regressor `incomediff`. We again test if the coefficients\nof the IV variables is zero, a condition necessary for exogenous variables.\n\n\n::: {#tbl-jtest .cell tbl-cap='J-test statitic testing for exogeneity condition of IVs'}\n\n```{.r .cell-code}\n# compute the J-statistic\ncig_iv_OR <- lm(residuals(cig_ivreg_diff3) ~ incomediff + salestaxdiff + cigtaxdiff)\n\ncig_OR_test <- linearHypothesis(cig_iv_OR, \n                               c(\"salestaxdiff = 0\", \"cigtaxdiff = 0\"), \n                               test = \"Chisq\")\ncig_OR_test %>% render_summary()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-6924cabc{}.cl-6908801e{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-69134dd2{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-69134df0{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-6913ba88{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6913baa6{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6913bab0{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6913baba{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6913bac4{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6913bad8{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-6924cabc'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-6913ba88\"><p class=\"cl-69134dd2\"><span class=\"cl-6908801e\">term</span></p></th><th class=\"cl-6913baa6\"><p class=\"cl-69134df0\"><span class=\"cl-6908801e\">null.value</span></p></th><th class=\"cl-6913baa6\"><p class=\"cl-69134df0\"><span class=\"cl-6908801e\">estimate</span></p></th><th class=\"cl-6913baa6\"><p class=\"cl-69134df0\"><span class=\"cl-6908801e\">std.error</span></p></th><th class=\"cl-6913baa6\"><p class=\"cl-69134df0\"><span class=\"cl-6908801e\">statistic</span></p></th><th class=\"cl-6913ba88\"><p class=\"cl-69134dd2\"><span class=\"cl-6908801e\">p.value</span></p></th><th class=\"cl-6913baa6\"><p class=\"cl-69134df0\"><span class=\"cl-6908801e\">df.residual</span></p></th><th class=\"cl-6913baa6\"><p class=\"cl-69134df0\"><span class=\"cl-6908801e\">rss</span></p></th><th class=\"cl-6913baa6\"><p class=\"cl-69134df0\"><span class=\"cl-6908801e\">df</span></p></th><th class=\"cl-6913baa6\"><p class=\"cl-69134df0\"><span class=\"cl-6908801e\">sumsq</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6913bab0\"><p class=\"cl-69134dd2\"><span class=\"cl-6908801e\">salestaxdiff</span></p></td><td class=\"cl-6913baba\"><p class=\"cl-69134df0\"><span class=\"cl-6908801e\">0</span></p></td><td class=\"cl-6913baba\"><p class=\"cl-69134df0\"><span class=\"cl-6908801e\">0.013</span></p></td><td class=\"cl-6913baba\"><p class=\"cl-69134df0\"><span class=\"cl-6908801e\">0.006</span></p></td><td class=\"cl-6913baba\"><p class=\"cl-69134df0\"><span class=\"cl-6908801e\">4.932</span></p></td><td class=\"cl-6913bab0\"><p class=\"cl-69134dd2\"><span class=\"cl-6908801e\">0.0849</span></p></td><td class=\"cl-6913baba\"><p class=\"cl-69134df0\"><span class=\"cl-6908801e\">44</span></p></td><td class=\"cl-6913baba\"><p class=\"cl-69134df0\"><span class=\"cl-6908801e\">0.337</span></p></td><td class=\"cl-6913baba\"><p class=\"cl-69134df0\"><span class=\"cl-6908801e\">2</span></p></td><td class=\"cl-6913baba\"><p class=\"cl-69134df0\"><span class=\"cl-6908801e\">0.038</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6913bac4\"><p class=\"cl-69134dd2\"><span class=\"cl-6908801e\">cigtaxdiff</span></p></td><td class=\"cl-6913bad8\"><p class=\"cl-69134df0\"><span class=\"cl-6908801e\">0</span></p></td><td class=\"cl-6913bad8\"><p class=\"cl-69134df0\"><span class=\"cl-6908801e\">-0.004</span></p></td><td class=\"cl-6913bad8\"><p class=\"cl-69134df0\"><span class=\"cl-6908801e\">0.002</span></p></td><td class=\"cl-6913bad8\"><p class=\"cl-69134df0\"><span class=\"cl-6908801e\">4.932</span></p></td><td class=\"cl-6913bac4\"><p class=\"cl-69134dd2\"><span class=\"cl-6908801e\">0.0849</span></p></td><td class=\"cl-6913bad8\"><p class=\"cl-69134df0\"><span class=\"cl-6908801e\">44</span></p></td><td class=\"cl-6913bad8\"><p class=\"cl-69134df0\"><span class=\"cl-6908801e\">0.337</span></p></td><td class=\"cl-6913bad8\"><p class=\"cl-69134df0\"><span class=\"cl-6908801e\">2</span></p></td><td class=\"cl-6913bad8\"><p class=\"cl-69134df0\"><span class=\"cl-6908801e\">0.038</span></p></td></tr></tbody></table></div>\n```\n\n:::\n:::\n\n\n**Note**: The reported degrees of freedom is wrong, (2 instead of $m-k = 2-1=1$).\nThe J-statistic is $\\chi^2_1$ instead of $\\chi^2_2$ as reported by the model.\nWe calculate the correct p-value:\n\n\n::: {.cell}\n\n```{.r .cell-code}\npchisq(cig_OR_test[2, 5], df = 1, lower.tail = FALSE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.02636406\n```\n\n\n:::\n:::\n\n\nWe reject the hypothesis that both instruments are exogenous at $\\alpha = 0.05$\nand conclude that\n\n1. sales tax is an invalid instrument for the per-pack price,\n2. and so is the cigarette-specific tax,\n3. and that both instruments are invalid.\n\n# Experiments and Quasi-experiments\n\nExperiments give us the tools to conduct program evaluation interest being to \nmeasure causal effects of programs. The gold-standard for this kind of work is \na randomized controlled experiment. In a quasi-experiment there are no randomized\nassignments to interventions, we study the processes in their natural setting.\n\n## Potential outcomes, causal effects and idealized experiments\n\nInterest is in the **average causal effect** estimated by the **difference estimator**.\nA potential outcome is the outcome for an individual under a potential treatment.\nFor this individual the causal effect of the treatment is the difference between \nthe potential outcome if the individual receives the treatment and the potential\noutcome if they do not. We are interested in studying the **average causal effect**\nsince this difference may vary from individual to individual. In a randomized \ncontrolled experiment, it is expected that\n1. Subjects are randomly selected from the population(ensures average causal effect\nin sample equals average causal effect in population),\n2. Subjects are randomly assigned to treatment and control group (ensures receiving\na treatment is independent of a subject's potential outcome).\n\nIf above conditions are met, then the average causal effect is the expected outcome\nin treatment group less expected outcome in the control:\n\n$$\n\\text{Average causal effect}  = E(Y_i|X_i = 1) - E(Y_i|X_i = 0)\n$$\n\nwhere $X_i$ is a binary treatment indicator. Estimation follows **differences estimator** \nwhich is an OLS regression model\n\n$$\n\\begin{equation}\nY_i = \\beta_0 + \\beta_1X_i + \\epsilon_i, i = 1, \\dots, n\n\\end{equation}\n$${\\#eq-ae}\n\nwhere random assignment ensures $E(\\epsilon_i|X_i) = 0$. The difference estimator\nin (@eq-ae) can take additional regressors $W_1, \\dots, W_r$ and is called a\n**differences estimator with additional regressors**:\n\n$$\n\\begin{equation}\nY_i = \\beta_0 + \\beta_1X_i + \\beta_2W_{1i} + \\dots + \\beta_{1+r}W_{ri} +\n\\epsilon_i, i = 1, \\dots, n\n\\end{equation}\n$${\\#eq-ae-dear}\n\nIt utilizes a **conditional mean independence** assumption that states that\ntreatment assignment $X_i$ is random and independent of any pretreatment variable\n$W_i$. This ensures that\n\n$$\n\\begin{equation}\nE(\\epsilon_i|X_i, W_i) = E(\\epsilon_i|W_i) = 0\n\\end{equation}\n$$\n \n implying that the conditional expectation of the error term $\\epsilon_i$, given \n the treatment indicator $X_i$ and the the pretreatment characteristic $W_i$ does\n not depend on $X_i$.\n \n ### Analysis of experimental data\n \n `STAR` data set from `{AER}` is a large student-teacher achievement ratio randomized \n controlled experiment that was assessing whether class size reduction is effective\n in improving education outcomes. 6400 students were randomly assigned into one\n of the three interventions: small class (13 to 17 students per teacher),\n regular class (22 to 25 students per teacher), and regular-with-aide class\n (22 to 25 students with a full-time teacher’s aide). Teachers were also randomly\n assigned to classes. The subjects were followed from kindergarten to grade 3 \n (K,1, 2, 3 suffixes in variable names).\n \n\n::: {.cell}\n\n```{.r .cell-code}\ndata(\"STAR\", package = \"AER\")\nskimr::skim(STAR)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Couldn't find skimmers for class: yearqtr; No user-defined `sfl`\nprovided. Falling back to `character`.\n```\n\n\n:::\n\n::: {.cell-output-display}\n\nTable: Data summary\n\n|                         |      |\n|:------------------------|:-----|\n|Name                     |STAR  |\n|Number of rows           |11598 |\n|Number of columns        |47    |\n|_______________________  |      |\n|Column type frequency:   |      |\n|character                |1     |\n|factor                   |34    |\n|numeric                  |12    |\n|________________________ |      |\n|Group variables          |None  |\n\n\n**Variable type: character**\n\n|skim_variable | n_missing| complete_rate| min| max| empty| n_unique| whitespace|\n|:-------------|---------:|-------------:|---:|---:|-----:|--------:|----------:|\n|birth         |        70|          0.99|   4|   7|     0|       21|          0|\n\n\n**Variable type: factor**\n\n|skim_variable | n_missing| complete_rate|ordered | n_unique|top_counts                                |\n|:-------------|---------:|-------------:|:-------|--------:|:-----------------------------------------|\n|gender        |        20|          1.00|FALSE   |        2|mal: 6122, fem: 5456                      |\n|ethnicity     |       145|          0.99|FALSE   |        6|cau: 7193, afa: 4173, asi: 32, his: 21    |\n|stark         |      5273|          0.55|FALSE   |        3|reg: 2231, reg: 2194, sma: 1900           |\n|star1         |      4769|          0.59|FALSE   |        3|reg: 2584, reg: 2320, sma: 1925           |\n|star2         |      4758|          0.59|FALSE   |        3|reg: 2495, reg: 2329, sma: 2016           |\n|star3         |      4796|          0.59|FALSE   |        3|reg: 2543, sma: 2174, reg: 2085           |\n|lunchk        |      5296|          0.54|FALSE   |        2|non: 3250, fre: 3052                      |\n|lunch1        |      4947|          0.57|FALSE   |        2|fre: 3430, non: 3221                      |\n|lunch2        |      5102|          0.56|FALSE   |        2|fre: 3336, non: 3160                      |\n|lunch3        |      5078|          0.56|FALSE   |        2|fre: 3293, non: 3227                      |\n|schoolk       |      5273|          0.55|FALSE   |        4|rur: 2917, inn: 1428, sub: 1412, urb: 568 |\n|school1       |      4769|          0.59|FALSE   |        4|rur: 3237, sub: 1586, inn: 1380, urb: 626 |\n|school2       |      4758|          0.59|FALSE   |        4|rur: 3167, sub: 1710, inn: 1481, urb: 482 |\n|school3       |      4796|          0.59|FALSE   |        4|rur: 3240, sub: 1720, inn: 1335, urb: 507 |\n|degreek       |      5294|          0.54|FALSE   |        4|bac: 4119, mas: 1981, mas: 161, spe: 43   |\n|degree1       |      4788|          0.59|FALSE   |        4|bac: 4456, mas: 2294, spe: 38, phd: 22    |\n|degree2       |      4819|          0.58|FALSE   |        4|bac: 4249, mas: 2427, spe: 67, phd: 36    |\n|degree3       |      4862|          0.58|FALSE   |        3|bac: 3762, mas: 2885, spe: 89, phd: 0     |\n|ladderk       |      5869|          0.49|FALSE   |        6|lev: 4671, app: 514, pro: 334, lev: 119   |\n|ladder1       |      4811|          0.59|FALSE   |        6|lev: 4492, app: 718, pro: 666, not: 506   |\n|ladder2       |      4878|          0.58|FALSE   |        6|lev: 4703, not: 754, app: 482, pro: 411   |\n|ladder3       |      4847|          0.58|FALSE   |        6|lev: 4437, pro: 550, not: 497, lev: 484   |\n|tethnicityk   |      5335|          0.54|FALSE   |        2|cau: 5232, afa: 1031                      |\n|tethnicity1   |      4822|          0.58|FALSE   |        2|cau: 5592, afa: 1184                      |\n|tethnicity2   |      4819|          0.58|FALSE   |        2|cau: 5398, afa: 1381                      |\n|tethnicity3   |      4847|          0.58|FALSE   |        3|cau: 5328, afa: 1409, asi: 14             |\n|systemk       |      5273|          0.55|FALSE   |       42|11: 1788, 18: 360, 22: 319, 6: 228        |\n|system1       |      4769|          0.59|FALSE   |       42|11: 1757, 22: 508, 18: 269, 12: 240       |\n|system2       |      4758|          0.59|FALSE   |       41|11: 1908, 22: 495, 18: 312, 12: 263       |\n|system3       |      4796|          0.59|FALSE   |       41|11: 1792, 22: 473, 18: 302, 12: 246       |\n|schoolidk     |      5273|          0.55|FALSE   |       79|27: 156, 28: 154, 51: 146, 22: 137        |\n|schoolid1     |      4769|          0.59|FALSE   |       76|51: 238, 63: 149, 27: 142, 9: 134         |\n|schoolid2     |      4758|          0.59|FALSE   |       75|51: 235, 27: 146, 22: 141, 9: 140         |\n|schoolid3     |      4796|          0.59|FALSE   |       75|51: 207, 58: 147, 9: 146, 66: 139         |\n\n\n**Variable type: numeric**\n\n|skim_variable | n_missing| complete_rate|   mean|    sd|  p0| p25| p50| p75| p100|hist  |\n|:-------------|---------:|-------------:|------:|-----:|---:|---:|---:|---:|----:|:-----|\n|readk         |      5809|          0.50| 436.73| 31.71| 315| 414| 433| 453|  627|▁▇▅▁▁ |\n|read1         |      5202|          0.55| 520.78| 55.19| 404| 478| 514| 558|  651|▂▇▇▅▃ |\n|read2         |      5521|          0.52| 583.93| 46.04| 468| 552| 582| 614|  732|▂▇▇▃▁ |\n|read3         |      5598|          0.52| 615.41| 38.57| 499| 588| 614| 641|  775|▁▇▇▂▁ |\n|mathk         |      5727|          0.51| 485.38| 47.70| 288| 454| 484| 513|  626|▁▁▇▅▂ |\n|math1         |      4998|          0.57| 530.53| 43.10| 404| 500| 529| 557|  676|▁▆▇▃▁ |\n|math2         |      5533|          0.52| 580.61| 44.57| 441| 550| 579| 611|  721|▁▃▇▃▁ |\n|math3         |      5521|          0.52| 617.97| 39.84| 487| 591| 616| 645|  774|▁▅▇▂▁ |\n|experiencek   |      5294|          0.54|   9.26|  5.81|   0|   5|   9|  13|   27|▇▇▇▂▁ |\n|experience1   |      4788|          0.59|  11.63|  8.94|   0|   4|  10|  17|   42|▇▆▃▁▁ |\n|experience2   |      4860|          0.58|  13.15|  8.65|   0|   7|  12|  18|   40|▇▇▅▂▁ |\n|experience3   |      4847|          0.58|  13.93|  8.61|   0|   7|  14|  19|   38|▆▇▆▂▁ |\n\n\n:::\n:::\n\n \n In essence, there were 2 treatments in each grade (small class with 13 - 17\n students, and a regular class with 22 - 25 students and a teaching aide). We\n introduce two binary variables, each being an indicator for the respective treatment\n group for the difference estimator. This is to capture the treatment effect for each treatment \n group separately yielding the population regression model for the test score as\n \n $$\n \\begin{equation}\n Y_i = \\beta_0 + \\beta_1 smallClass_i + \\beta2RegAide_i + \\epsilon_i\n \\end{equation}\n $${\\#eq-pop-model}\n \n\n::: {#tbl-popmod1 .cell .tbl-cap-location-bottom tbl-cap='Project STAR: Differences estimate. Class size reduction improves study performance excpt for grade 1'}\n\n```{.r .cell-code}\ngrades <- c(\"k\",1:3)\n\n# map over grades to create a list of models\n\nstar_models <- grades |>\n  set_names(paste0(\"grade_\", grades)) |>\n  map(\n    \\(y){\n#       construct the formula dynamically: I(ready + mathy) ~ starY\n      form <- as.formula(paste0(\"I(read\", y, \"+ math\", y, \") ~ star\", y))\n      lm(form, data = STAR)\n    }\n  )\n\n# compute robust standard error\nrob_se <- star_models |>\n map(\\(m) sqrt(diag(vcovHC(m, type = \"HC1\"))))\n\n# Define which Goodness-of-Fit stats to show and what to call them\ngm1 <- list(\n  list(\"raw\" = \"nobs\", \"clean\" = \"Observations\", \"fmt\" = 0),\n  list(\"raw\" = \"r.squared\", \"clean\" = \"R2\", \"fmt\" = 3),\n  list(\"raw\" = \"adj.r.squared\", \"clean\" = \"Adj. R2\", \"fmt\" = 3),\n  # Added Residual Standard Error\n  list(\"raw\" = \"sigma\", \"clean\" = \"Residual Std. Error\", \"fmt\" = 3),\n  # Added F-statistic\n  list(\"raw\" = \"statistic\", \"clean\" = \"F-statistic\", \"fmt\" = 3)\n)\n\n# render table\n\nmodel_tables(models = star_models, robust_se = rob_se)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-6b4ba4e6{}.cl-6b391e2a{font-family:'DejaVu Sans';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-6b391e48{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-6b40aa28{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-6b40f726{width:1.683in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6b40f744{width:1.166in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6b40f74e{width:1.683in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6b40f758{width:1.166in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6b40f762{width:1.683in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6b40f76c{width:1.166in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6b40f776{width:1.683in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6b40f780{width:1.166in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6b40f78a{width:1.683in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6b40f794{width:1.166in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6b40f79e{width:1.683in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6b40f7a8{width:1.166in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6b40f7b2{width:1.683in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6b40f7bc{width:1.166in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-6b4ba4e6'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-6b40f726\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e2a\"> </span></p></th><th class=\"cl-6b40f744\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e2a\">grade_k</span></p></th><th class=\"cl-6b40f744\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e2a\">grade_1</span></p></th><th class=\"cl-6b40f744\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e2a\">grade_2</span></p></th><th class=\"cl-6b40f744\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e2a\">grade_3</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6b40f74e\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">starksmall</span></p></td><td class=\"cl-6b40f758\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">13.899***</span></p></td><td class=\"cl-6b40f758\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f758\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f758\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6b40f762\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f76c\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">(2.454)</span></p></td><td class=\"cl-6b40f76c\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f76c\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f76c\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6b40f776\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">starkregular+aide</span></p></td><td class=\"cl-6b40f780\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">0.314</span></p></td><td class=\"cl-6b40f780\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f780\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f780\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6b40f762\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f76c\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">(2.271)</span></p></td><td class=\"cl-6b40f76c\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f76c\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f76c\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6b40f74e\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">star1small</span></p></td><td class=\"cl-6b40f758\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f758\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">29.781***</span></p></td><td class=\"cl-6b40f758\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f758\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6b40f762\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f76c\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f76c\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">(2.831)</span></p></td><td class=\"cl-6b40f76c\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f76c\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6b40f776\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">star1regular+aide</span></p></td><td class=\"cl-6b40f780\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f780\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">11.959***</span></p></td><td class=\"cl-6b40f780\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f780\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6b40f762\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f76c\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f76c\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">(2.652)</span></p></td><td class=\"cl-6b40f76c\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f76c\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6b40f74e\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">star2small</span></p></td><td class=\"cl-6b40f758\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f758\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f758\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">19.394***</span></p></td><td class=\"cl-6b40f758\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6b40f762\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f76c\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f76c\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f76c\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">(2.712)</span></p></td><td class=\"cl-6b40f76c\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6b40f776\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">star2regular+aide</span></p></td><td class=\"cl-6b40f780\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f780\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f780\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">3.479</span></p></td><td class=\"cl-6b40f780\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6b40f762\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f76c\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f76c\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f76c\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">(2.545)</span></p></td><td class=\"cl-6b40f76c\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6b40f74e\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">star3small</span></p></td><td class=\"cl-6b40f758\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f758\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f758\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f758\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">15.587***</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6b40f762\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f76c\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f76c\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f76c\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f76c\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">(2.396)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6b40f776\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">star3regular+aide</span></p></td><td class=\"cl-6b40f780\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f780\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f780\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f780\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">-0.291</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6b40f762\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f76c\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f76c\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f76c\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\"></span></p></td><td class=\"cl-6b40f76c\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">(2.273)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6b40f74e\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">Num.Obs.</span></p></td><td class=\"cl-6b40f758\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">5786</span></p></td><td class=\"cl-6b40f758\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">6379</span></p></td><td class=\"cl-6b40f758\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">6049</span></p></td><td class=\"cl-6b40f758\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">5967</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6b40f78a\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">R2</span></p></td><td class=\"cl-6b40f794\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">0.007</span></p></td><td class=\"cl-6b40f794\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">0.017</span></p></td><td class=\"cl-6b40f794\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">0.009</span></p></td><td class=\"cl-6b40f794\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">0.010</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6b40f776\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">R2 Adj.</span></p></td><td class=\"cl-6b40f780\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">0.007</span></p></td><td class=\"cl-6b40f780\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">0.017</span></p></td><td class=\"cl-6b40f780\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">0.009</span></p></td><td class=\"cl-6b40f780\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">0.010</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6b40f78a\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">AIC</span></p></td><td class=\"cl-6b40f794\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">66151.5</span></p></td><td class=\"cl-6b40f794\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">75587.2</span></p></td><td class=\"cl-6b40f794\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">70731.2</span></p></td><td class=\"cl-6b40f794\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">68126.3</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6b40f78a\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">BIC</span></p></td><td class=\"cl-6b40f794\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">66178.2</span></p></td><td class=\"cl-6b40f794\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">75614.2</span></p></td><td class=\"cl-6b40f794\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">70758.1</span></p></td><td class=\"cl-6b40f794\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">68153.1</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6b40f776\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">Log.Lik.</span></p></td><td class=\"cl-6b40f780\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">-33071.755</span></p></td><td class=\"cl-6b40f780\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">-37789.595</span></p></td><td class=\"cl-6b40f780\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">-35361.613</span></p></td><td class=\"cl-6b40f780\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">-34059.138</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6b40f78a\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">RMSE</span></p></td><td class=\"cl-6b40f794\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">73.47</span></p></td><td class=\"cl-6b40f794\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">90.48</span></p></td><td class=\"cl-6b40f794\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">83.67</span></p></td><td class=\"cl-6b40f794\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">72.89</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6b40f79e\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">Std.Errors</span></p></td><td class=\"cl-6b40f7a8\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">grade_k</span></p></td><td class=\"cl-6b40f7a8\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">grade_1</span></p></td><td class=\"cl-6b40f7a8\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">grade_2</span></p></td><td class=\"cl-6b40f7a8\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">grade_3</span></p></td></tr></tbody><tfoot><tr style=\"overflow-wrap:break-word;\"><td  colspan=\"5\"class=\"cl-6b40f7b2\"><p class=\"cl-6b40aa28\"><span class=\"cl-6b391e48\">+ p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001</span></p></td></tr></tfoot></table></div>\n```\n\n:::\n:::\n\n \nWe can augment the model in (@eq-pop-model) with extra variables under 2 \ncircumstances: \n\n1. Adding the regressors explain some of the observed variations in the outcome\nmaking the estimates more efficient\n2. If treatment assignment is not random, the estimates obtained in (@eq-pop-model)\nare possibly biased. The additional regressors could mitigate this challenge.\n\nFor our setting we could consider 6 additional variables (in a staggered manner):\n\n* *experience* - Teacher's years of experience\n* *boy* - A dummy (student is a boy)\n* *lunch* - Free lunch eligibility (dummy)\n* *black* - Student is black (dummy)\n* *race* - Student's race is other than black or white (dummy)\n* *schoolid* - School indicator variables\n\n**Note**: For randomized controlled experiments, we can make causal claims only \nfor variables that subjects were randomly assigned into.\n\n## Quasi experiments\n\nQuasi experiments exploit \"as if\" randomness to use methods considered under \nrandomized controlled experiments. They come in two forms:\n\n1. Random variations in individual circumstances allow to view the treatment \n\"as if\" it was randomly determined.\n2. The treatment is only partly determined by \"as if\" random variation.\n\nThe former allows the use of either model (@eq-ae-dear), i.e.,\n**the difference estimator with additional regressors**, or, using \n**difference-in-difference (DID)** if the \"as if\" randomness\ndoes not guarantee the non-existence of systematic differences in the control\nand treatment groups. The latter case invites the use of an IV approach for a\ncase like model (@eq-ae-dear), utilizing the source of \"as if\" randomness in \ntreatment assignment as the instrument. Other methods include \n**sharp regression discontinuity design (RDD)** and \n**fuzzy regression discontinuity design (FRDD)**. We use simulated data\nto explore these methods\n\n### The difference-in-difference (DID) estimator\n\nThe source of \"as if\" randomness in treatment assignment in quasi-experiments does\nnot always rule out systematic differences between control and treatment groups.\nDID involves data in organised in the before and after treatment. \n\n$$\n\\begin{align}\n  \\widehat{\\beta}_1^{\\text{diffs-in-diffs}} =& \\, (\\overline{Y}^{\\text{treatment,after}} - \\overline{Y}^{\\text{treatment,before}}) - (\\overline{Y}^{\\text{control,after}} - \\overline{Y}^{\\text{control,before}}) \\\\\n  =& \\Delta \\overline{Y}^{\\text{treatment}} - \\Delta \\overline{Y}^{\\text{control}}, \n\\end{align}\n$${\\#eq-DID}\n\nwith\n\n+ $\\overline{Y}^{\\text{treatment,before}}$ - the sample average in the treatment group before the treatment\n\n+ $\\overline{Y}^{\\text{treatment,after}}$ - the sample average in the treatment group after the treatment\n\n+ $\\overline{Y}^{\\text{treatment,before}}$ - the sample average in the control group before the treatment\n\n+ $\\overline{Y}^{\\text{treatment,after}}$ - the sample average in the control group after the treatment.\n\nWe now use R to plot a DID setting.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# initialize plot and add control group\nplot(c(0, 1), c(6, 8), \n     type = \"p\",\n     ylim = c(5, 12),\n     xlim = c(-0.3, 1.3),\n     # main = \"The Differences-in-Differences Estimator\",\n     xlab = \"Period\",\n     ylab = \"Y\",\n     col = \"steelblue\",\n     pch = 20,\n     xaxt = \"n\",\n     yaxt = \"n\")\n\naxis(1, at = c(0, 1), labels = c(\"before\", \"after\"))\naxis(2, at = c(0, 13))\n\n# add treatment group\npoints(c(0, 1, 1), c(7, 9, 11), \n       col = \"darkred\",\n       pch = 20)\n\n# add line segments\nlines(c(0, 1), c(7, 11), col = \"darkred\")\nlines(c(0, 1), c(6, 8), col = \"steelblue\")\nlines(c(0, 1), c(7, 9), col = \"darkred\", lty = 2)\nlines(c(1, 1), c(9, 11), col = \"black\", lty = 2, lwd = 2)\n\n# add annotations\ntext(1, 10, expression(hat(beta)[1]^{DID}), cex = 0.8, pos = 4)\ntext(0, 5.5, \"s. mean control\", cex = 0.8 , pos = 4)\ntext(0, 6.8, \"s. mean treatment\", cex = 0.8 , pos = 4)\ntext(1, 7.9, \"s. mean control\", cex = 0.8 , pos = 4)\ntext(1, 11.1, \"s. mean treatment\", cex = 0.8 , pos = 4)\n```\n\n::: {.cell-output-display}\n![Difference-in-differnce plot](index_files/figure-html/fig-did-1.png){#fig-did width=672}\n:::\n:::\n\n\nThe DID estimator (@eq-DID) can take a regression notation: $\\hat{\\beta_1}^{DID}$\nis the OLS estimator of $\\beta_1$ in \n\n$$\n\\begin{equation}\n\\Delta Y_i = \\beta_0 + \\beta_1X_i + \\epsilon_i\n\\end{equation}\n$${\\#eq-DID-1}\n\nwith $\\Delta Y_i$ denoting the difference in pre and post-treatment outcomes of \nsubject $i$, $X_i$ is the treatment indicator. We can add additional regressors measuring\npretreatment characteristics to (@eq-DID-1) to get the \n**difference-in-difference estimator with additional regressors**.\n\n\n$$\n\\begin{equation}\n\\Delta Y_i = \\beta_0 + \\beta_1X_i + \\beta_2W_{1i} + \\dots + \\beta_{1+r}W_{ri} +  \\epsilon_i\n\\end{equation}\n$${\\#eq-DID-2}\n\nSimulate data:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(as.numeric(Sys.Date()))\n# set sample size\nn <- 200\n\n# define treatment effect\nTEffect <- 4\n\n# generate treatment dummy\nTDummy <- c(rep(0, n/2), rep(1, n/2))\n\n# simulate pre- and post-treatment values of the dependent variable\ny_pre <- 7 + rnorm(n)\ny_pre[1:n/2] <- y_pre[1:n/2] - 1\ny_post <- 7 + 2 + TEffect * TDummy + rnorm(n)\ny_post[1:n/2] <- y_post[1:n/2] - 1 \n```\n:::\n\n\nPlot data:\n\n\n::: {.cell}\n\n```{.r .cell-code}\npre <- rep(0, length(y_pre[TDummy==0]))\npost <- rep(1, length(y_pre[TDummy==0]))\n\n# plot control group in t=1\nplot(jitter(pre, 0.6), \n     y_pre[TDummy == 0], \n     ylim = c(0, 16), \n     col = alpha(\"steelblue\", 0.3),\n     pch = 20, \n     xlim = c(-0.5, 1.5),\n     ylab = \"Y\",\n     xlab = \"Period\",\n     xaxt = \"n\"\n     # ,main = \"Artificial Data for DID Estimation\"\n     )\n\naxis(1, at = c(0, 1), labels = c(\"before\", \"after\"))\n\n# add treatment group in t=1\npoints(jitter(pre, 0.6), \n       y_pre[TDummy == 1], \n       col = alpha(\"darkred\", 0.3), \n       pch = 20)\n\n# add control group in t=2\npoints(jitter(post, 0.6),\n       y_post[TDummy == 0], \n       col = alpha(\"steelblue\", 0.5),\n       pch = 20)\n\n# add treatment group in t=2\npoints(jitter(post, 0.6), \n       y_post[TDummy == 1], \n       col = alpha(\"darkred\", 0.5),\n       pch = 20)\n```\n\n::: {.cell-output-display}\n![Artificial data for DID estimation](index_files/figure-html/fig-did-1-1.png){#fig-did-1 width=672}\n:::\n:::\n\n\nCompute DID estimate by hand:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# compute the DID estimator for the treatment effect 'by hand'\nmean(y_post[TDummy == 1]) - mean(y_pre[TDummy == 1]) - \n(mean(y_post[TDummy == 0]) - mean(y_pre[TDummy == 0]))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 4.085678\n```\n\n\n:::\n:::\n\n\nCompute DID using a linear model:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# compute the DID estimator using a linear model\nlm(I(y_post - y_pre) ~ TDummy) %>% render_summary()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-6c1d04e6{}.cl-6c0e0126{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-6c1495c2{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-6c1495d6{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-6c14d7da{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6c14d7ee{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6c14d7f8{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6c14d802{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6c14d803{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6c14d80c{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-6c1d04e6'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-6c14d7da\"><p class=\"cl-6c1495c2\"><span class=\"cl-6c0e0126\">term</span></p></th><th class=\"cl-6c14d7ee\"><p class=\"cl-6c1495d6\"><span class=\"cl-6c0e0126\">estimate</span></p></th><th class=\"cl-6c14d7ee\"><p class=\"cl-6c1495d6\"><span class=\"cl-6c0e0126\">std.error</span></p></th><th class=\"cl-6c14d7ee\"><p class=\"cl-6c1495d6\"><span class=\"cl-6c0e0126\">statistic</span></p></th><th class=\"cl-6c14d7da\"><p class=\"cl-6c1495c2\"><span class=\"cl-6c0e0126\">p.value</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6c14d7f8\"><p class=\"cl-6c1495c2\"><span class=\"cl-6c0e0126\">(Intercept)</span></p></td><td class=\"cl-6c14d802\"><p class=\"cl-6c1495d6\"><span class=\"cl-6c0e0126\">1.964</span></p></td><td class=\"cl-6c14d802\"><p class=\"cl-6c1495d6\"><span class=\"cl-6c0e0126\">0.129</span></p></td><td class=\"cl-6c14d802\"><p class=\"cl-6c1495d6\"><span class=\"cl-6c0e0126\">15.220</span></p></td><td class=\"cl-6c14d7f8\"><p class=\"cl-6c1495c2\"><span class=\"cl-6c0e0126\">&lt;0.0001</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6c14d803\"><p class=\"cl-6c1495c2\"><span class=\"cl-6c0e0126\">TDummy</span></p></td><td class=\"cl-6c14d80c\"><p class=\"cl-6c1495d6\"><span class=\"cl-6c0e0126\">4.086</span></p></td><td class=\"cl-6c14d80c\"><p class=\"cl-6c1495d6\"><span class=\"cl-6c0e0126\">0.182</span></p></td><td class=\"cl-6c14d80c\"><p class=\"cl-6c1495d6\"><span class=\"cl-6c0e0126\">22.392</span></p></td><td class=\"cl-6c14d803\"><p class=\"cl-6c1495c2\"><span class=\"cl-6c0e0126\">&lt;0.0001</span></p></td></tr></tbody></table></div>\n```\n\n:::\n:::\n\n\n### Regression discontinuity estimators\n\nConsider the model\n\n$$\n\\begin{align}\n  Y_i =& \\beta_0 + \\beta_1 X_i + \\beta_2 W_i + u_i\n\\end{align}\n$${\\#eq-SRDDsetting}\n\nand let\n\n$$\n\\begin{align*}\nX_i =& \n  \\begin{cases}\n    1, & W_i \\geq c \\\\\n    0, & W_i < c,\n  \\end{cases}\n\\end{align*}\n$$\nso that the receipt of treatment, $X_i$, is determined by some threshold $c$ of a continuous variable $W_i$, the so called running variable. The idea of *regression discontinuity design* is to use observations with a $W_i$ close to $c$ for estimation of $\\beta_1$. $\\beta_1$ is the average treatment effect for individuals with $W_i = c$ which is assumed to be a good approximation to the treatment effect in the population. (@eq-SRDDsetting) is called a *sharp regression discontinuity design* because treatment assignment is deterministic and discontinuous at the cutoff: all observations with $W_i < c$ do not receive treatment and all observations where $W_i \\geq c$ are treated.  \n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(as.numeric(Sys.Date()))\n\n# generate some sample data\nW <- runif(1000, -1, 1)\ny <- 3 + 2 * W + 10 * (W>=0) + rnorm(1000)\n\n# construct rdd_data \ndata <- rdd_data(y, W, cutpoint = 0)\n\n# plot the sample data\nplot(data,\n     col = \"steelblue\",\n     cex = 0.35, \n     xlab = \"W\", \n     ylab = \"Y\")\n```\n\n::: {.cell-output-display}\n![Regression discontinuity plot](index_files/figure-html/fig-rdd-1.png){#fig-rdd width=672}\n:::\n:::\n\n\nThe argument `nbins` sets the number of bins the running variable is divided \ninto for aggregation. The dots represent bin averages of the outcome variable.\n\nWe use the function `rdd_reg_lm()` to estimate the treatment effect using model\n(@eq-SRDDsetting). `slope = \"same\"` restricts the slopes of the estimated regression\nfunction to be the same on both sides of the jump at cutpoint $W = 0$.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrdd_mod <- rdd_reg_lm(rdd_object = data, \n                      slope = \"same\")\nrender_summary(rdd_mod)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: The `tidy()` method for objects of class `rdd_reg_lm` is not maintained by the broom team, and is only supported through the `lm` tidier method. Please be cautious in interpreting and reporting broom output.\n\nThis warning is displayed once per session.\n```\n\n\n:::\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-6c944114{}.cl-6c7baf14{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-6c84a538{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-6c84a560{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-6c850a00{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6c850a1e{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6c850a28{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6c850a32{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6c850a3c{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6c850a46{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-6c944114'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-6c850a00\"><p class=\"cl-6c84a538\"><span class=\"cl-6c7baf14\">term</span></p></th><th class=\"cl-6c850a1e\"><p class=\"cl-6c84a560\"><span class=\"cl-6c7baf14\">estimate</span></p></th><th class=\"cl-6c850a1e\"><p class=\"cl-6c84a560\"><span class=\"cl-6c7baf14\">std.error</span></p></th><th class=\"cl-6c850a1e\"><p class=\"cl-6c84a560\"><span class=\"cl-6c7baf14\">statistic</span></p></th><th class=\"cl-6c850a00\"><p class=\"cl-6c84a538\"><span class=\"cl-6c7baf14\">p.value</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6c850a28\"><p class=\"cl-6c84a538\"><span class=\"cl-6c7baf14\">(Intercept)</span></p></td><td class=\"cl-6c850a32\"><p class=\"cl-6c84a560\"><span class=\"cl-6c7baf14\">3.065</span></p></td><td class=\"cl-6c850a32\"><p class=\"cl-6c84a560\"><span class=\"cl-6c7baf14\">0.073</span></p></td><td class=\"cl-6c850a32\"><p class=\"cl-6c84a560\"><span class=\"cl-6c7baf14\">42.135</span></p></td><td class=\"cl-6c850a28\"><p class=\"cl-6c84a538\"><span class=\"cl-6c7baf14\">&lt;0.0001</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6c850a28\"><p class=\"cl-6c84a538\"><span class=\"cl-6c7baf14\">D</span></p></td><td class=\"cl-6c850a32\"><p class=\"cl-6c84a560\"><span class=\"cl-6c7baf14\">9.873</span></p></td><td class=\"cl-6c850a32\"><p class=\"cl-6c84a560\"><span class=\"cl-6c7baf14\">0.129</span></p></td><td class=\"cl-6c850a32\"><p class=\"cl-6c84a560\"><span class=\"cl-6c7baf14\">76.751</span></p></td><td class=\"cl-6c850a28\"><p class=\"cl-6c84a538\"><span class=\"cl-6c7baf14\">&lt;0.0001</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6c850a3c\"><p class=\"cl-6c84a538\"><span class=\"cl-6c7baf14\">x</span></p></td><td class=\"cl-6c850a46\"><p class=\"cl-6c84a560\"><span class=\"cl-6c7baf14\">2.172</span></p></td><td class=\"cl-6c850a46\"><p class=\"cl-6c84a560\"><span class=\"cl-6c7baf14\">0.113</span></p></td><td class=\"cl-6c850a46\"><p class=\"cl-6c84a560\"><span class=\"cl-6c7baf14\">19.244</span></p></td><td class=\"cl-6c850a3c\"><p class=\"cl-6c84a538\"><span class=\"cl-6c7baf14\">&lt;0.0001</span></p></td></tr></tbody></table></div>\n```\n\n:::\n:::\n\n\nYou can visualize by calling plot\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# plot the RDD model along with binned observations\nplot(rdd_mod,\n     cex = 0.35, \n     col = \"steelblue\", \n     xlab = \"W\", \n     ylab = \"Y\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\nSo far we assumed that crossing of the threshold determines receipt of treatment so that the jump of the population regression functions at the threshold can be regarded as the causal effect of the treatment.\n\nWhen crossing the threshold $c$ is not the only cause for receipt of the treatment, treatment is no a deterministic function of $W_i$. Instead, it is useful to think of $c$ as a threshold where the *probability* of receiving the treatment jumps.\n\nThis jump may be due to unobservable variables that have impact on the probability of being treated. Thus, $X_i$ in (@eq-SRDDsetting) will be correlated with the error $u_i$ and it becomes more difficult to consistently estimate the treatment effect. In this setting, using a *fuzzy regression discontinuity design* which is based an IV approach may be a remedy: take the binary variable $Z_i$ as an indicator for crossing of the threshold,\n\n$$\n\\begin{align*}\n  Z_i = \\begin{cases}\n    1, & W_i \\geq c \\\\\n    0, & W_i < c,\n  \\end{cases}\n\\end{align*}\n$$\nand assume that $Z_i$ relates to $Y_i$ only through the treatment indicator $X_i$. Then $Z_i$ and $u_i$ are uncorrelated but $Z_i$ influences receipt of treatment so it is correlated with $X_i$. Thus, $Z_i$ is a valid instrument for $X_i$ and (@eq-SRDDsetting) can be estimated using TSLS.  \n\nThe following code chunk generates sample data where observations with a value of the running variable $W_i$ below the cutoff $c=0$ do not receive treatment and observations with $W_i \\geq 0$ do receive treatment with a probability of $80\\%$ so that treatment status is only partially determined by the running variable and the cutoff. Treatment leads to an increase in $Y$ by $2$ units. Observations with $W_i \\geq 0$ that do not receive treatment are called *no-shows*: think of an individual that was assigned to receive the treatment but somehow manages to avoid it.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# generate sample data\nset.seed(as.numeric(Sys.Date()))\nmu <- c(0, 0)\nsigma <- matrix(c(1, 0.7, 0.7, 1), ncol = 2)\n\nset.seed(1234)\nd <- as.data.frame(mvrnorm(2000, mu, sigma))\ncolnames(d) <- c(\"W\", \"Y\")\n\n# introduce fuzziness\nd$treatProb <- ifelse(d$W < 0, 0, 0.8)\n\nfuzz <- sapply(X = d$treatProb, FUN = function(x) rbinom(1, 1, prob = x))\n\n# treatment effect\nd$Y <- d$Y + fuzz * 2\n```\n:::\n\n\nPlot:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# generate a colored plot of treatment and control group\nplot(d$W, d$Y,\n     col = c(\"steelblue\", \"darkred\")[factor(fuzz)], \n     pch= 20, \n     cex = 0.5,\n     xlim = c(-3, 3),\n     ylim = c(-3.5, 5),\n     xlab = \"W\",\n     ylab = \"Y\")\n\n# add a dashed vertical line at cutoff\nabline(v = 0, lty = 2)\n#add legend\nlegend(\"topleft\",pch=20,col=c(\"steelblue\",\"darkred\"),\n       legend=c(\"Do not receive treatment\",\"Receive treatment\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\nObviously, receipt of treatment is no longer a deterministic function of the running variable $W$. Some observations with $W\\geq0$ *did not* receive the treatment. We may estimate a FRDD by additionally setting `treatProb` as the assignment variable `z` in `rdd_data`. Then `rdd_reg_lm()` applies the following TSLS procedure: treatment is predicted using $W_i$ and the cutoff dummy $Z_i$, the instrumental variable, in the first stage regression. The fitted values from the first stage regression are used to obtain a consistent estimate of the treatment effect using the second stage where the outcome $Y$ is regressed on the fitted values and the running variable $W$.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# estimate the Fuzzy RDD\ndata <- rdd_data(d$Y, d$W, \n                 cutpoint = 0, \n                 z = d$treatProb)\n\nfrdd_mod <- rdd_reg_lm(rdd_object = data, \n                       slope = \"same\")\nfrdd_mod %>% render_summary()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-6dc412d0{}.cl-6daf9530{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-6db80d14{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-6db80d32{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-6db862b4{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db862c8{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db862dc{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db862e6{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db862f0{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6db862fa{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-6dc412d0'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-6db862b4\"><p class=\"cl-6db80d14\"><span class=\"cl-6daf9530\">term</span></p></th><th class=\"cl-6db862c8\"><p class=\"cl-6db80d32\"><span class=\"cl-6daf9530\">estimate</span></p></th><th class=\"cl-6db862c8\"><p class=\"cl-6db80d32\"><span class=\"cl-6daf9530\">std.error</span></p></th><th class=\"cl-6db862c8\"><p class=\"cl-6db80d32\"><span class=\"cl-6daf9530\">statistic</span></p></th><th class=\"cl-6db862b4\"><p class=\"cl-6db80d14\"><span class=\"cl-6daf9530\">p.value</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6db862dc\"><p class=\"cl-6db80d14\"><span class=\"cl-6daf9530\">(Intercept)</span></p></td><td class=\"cl-6db862e6\"><p class=\"cl-6db80d32\"><span class=\"cl-6daf9530\">0.014</span></p></td><td class=\"cl-6db862e6\"><p class=\"cl-6db80d32\"><span class=\"cl-6daf9530\">0.040</span></p></td><td class=\"cl-6db862e6\"><p class=\"cl-6db80d32\"><span class=\"cl-6daf9530\">0.362</span></p></td><td class=\"cl-6db862dc\"><p class=\"cl-6db80d14\"><span class=\"cl-6daf9530\">0.7171</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6db862dc\"><p class=\"cl-6db80d14\"><span class=\"cl-6daf9530\">D</span></p></td><td class=\"cl-6db862e6\"><p class=\"cl-6db80d32\"><span class=\"cl-6daf9530\">1.981</span></p></td><td class=\"cl-6db862e6\"><p class=\"cl-6db80d32\"><span class=\"cl-6daf9530\">0.085</span></p></td><td class=\"cl-6db862e6\"><p class=\"cl-6db80d32\"><span class=\"cl-6daf9530\">23.393</span></p></td><td class=\"cl-6db862dc\"><p class=\"cl-6db80d14\"><span class=\"cl-6daf9530\">&lt;0.0001</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6db862f0\"><p class=\"cl-6db80d14\"><span class=\"cl-6daf9530\">x</span></p></td><td class=\"cl-6db862fa\"><p class=\"cl-6db80d32\"><span class=\"cl-6daf9530\">0.709</span></p></td><td class=\"cl-6db862fa\"><p class=\"cl-6db80d32\"><span class=\"cl-6daf9530\">0.034</span></p></td><td class=\"cl-6db862fa\"><p class=\"cl-6db80d32\"><span class=\"cl-6daf9530\">20.685</span></p></td><td class=\"cl-6db862f0\"><p class=\"cl-6db80d14\"><span class=\"cl-6daf9530\">&lt;0.0001</span></p></td></tr></tbody></table></div>\n```\n\n:::\n:::\n\n\nThe estimate is close to $2$, the population treatment effect. We may call `plot()` on the model object to obtain a figure consisting of binned data and the estimated regression function. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# plot estimated FRDD function\nplot(frdd_mod, \n     cex = 0.5, \n     lwd = 0.4,\n     xlim = c(-4, 4),\n     ylim = c(-3.5, 5),\n     xlab = \"W\",\n     ylab = \"Y\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n\nWhat if we used a SRDD instead, thereby ignoring the fact that treatment is not perfectly determined by the cutoff in  $W$? We may get an impression of the consequences by estimating an SRDD using the previously simulated data.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# estimate SRDD\ndata <- rdd_data(d$Y, \n                 d$W, \n                 cutpoint = 0)\n\nsrdd_mod <- rdd_reg_lm(rdd_object = data, \n                       slope = \"same\")\nsrdd_mod %>% render_summary()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-6e5a8f4e{}.cl-6e493e06{font-family:'DejaVu Sans';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-6e50919c{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-6e5091ba{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-6e50de86{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6e50dea4{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6e50dec2{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6e50decc{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6e50ded6{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-6e50dee0{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-6e5a8f4e'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-6e50de86\"><p class=\"cl-6e50919c\"><span class=\"cl-6e493e06\">term</span></p></th><th class=\"cl-6e50dea4\"><p class=\"cl-6e5091ba\"><span class=\"cl-6e493e06\">estimate</span></p></th><th class=\"cl-6e50dea4\"><p class=\"cl-6e5091ba\"><span class=\"cl-6e493e06\">std.error</span></p></th><th class=\"cl-6e50dea4\"><p class=\"cl-6e5091ba\"><span class=\"cl-6e493e06\">statistic</span></p></th><th class=\"cl-6e50de86\"><p class=\"cl-6e50919c\"><span class=\"cl-6e493e06\">p.value</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6e50dec2\"><p class=\"cl-6e50919c\"><span class=\"cl-6e493e06\">(Intercept)</span></p></td><td class=\"cl-6e50decc\"><p class=\"cl-6e5091ba\"><span class=\"cl-6e493e06\">0.014</span></p></td><td class=\"cl-6e50decc\"><p class=\"cl-6e5091ba\"><span class=\"cl-6e493e06\">0.040</span></p></td><td class=\"cl-6e50decc\"><p class=\"cl-6e5091ba\"><span class=\"cl-6e493e06\">0.362</span></p></td><td class=\"cl-6e50dec2\"><p class=\"cl-6e50919c\"><span class=\"cl-6e493e06\">0.7171</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6e50dec2\"><p class=\"cl-6e50919c\"><span class=\"cl-6e493e06\">D</span></p></td><td class=\"cl-6e50decc\"><p class=\"cl-6e5091ba\"><span class=\"cl-6e493e06\">1.585</span></p></td><td class=\"cl-6e50decc\"><p class=\"cl-6e5091ba\"><span class=\"cl-6e493e06\">0.068</span></p></td><td class=\"cl-6e50decc\"><p class=\"cl-6e5091ba\"><span class=\"cl-6e493e06\">23.393</span></p></td><td class=\"cl-6e50dec2\"><p class=\"cl-6e50919c\"><span class=\"cl-6e493e06\">&lt;0.0001</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-6e50ded6\"><p class=\"cl-6e50919c\"><span class=\"cl-6e493e06\">x</span></p></td><td class=\"cl-6e50dee0\"><p class=\"cl-6e5091ba\"><span class=\"cl-6e493e06\">0.709</span></p></td><td class=\"cl-6e50dee0\"><p class=\"cl-6e5091ba\"><span class=\"cl-6e493e06\">0.034</span></p></td><td class=\"cl-6e50dee0\"><p class=\"cl-6e5091ba\"><span class=\"cl-6e493e06\">20.685</span></p></td><td class=\"cl-6e50ded6\"><p class=\"cl-6e50919c\"><span class=\"cl-6e493e06\">&lt;0.0001</span></p></td></tr></tbody></table></div>\n```\n\n:::\n:::\n\n\nThe estimate obtained using a SRDD is suggestive of a substantial downward bias. In fact, this procedure is inconsistent for the true causal effect so increasing the sample would not alleviate the bias.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/tabwid-1.1.3/tabwid.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/tabwid-1.1.3/tabwid.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}